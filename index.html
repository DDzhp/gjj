<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>üåàÊñ∞Êñ∞Â∞èÊúãÂèãÁöÑÂ∑•ÂÖ∑ÈõÜ‚ö°Ô∏è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        /* ===== ÂÖ®Â±ÄÊ†∑Âºè ===== */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* ===== ÂÆπÂô®Ê†∑Âºè ===== */
        .container {
            max-width: 1300px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        /* ===== ‰∏ªÊ†áÈ¢òÊ†∑Âºè ===== */
        h1 {
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin: 0 0 30px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* ===== Â∑•ÂÖ∑ÂØºËà™Ê†èÊ†∑Âºè ===== */
        .tool-switcher {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0 30px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .tool-switcher button {
            padding: 12px 20px;
            border: 2px solid transparent;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            cursor: pointer;
            border-radius: 25px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .tool-switcher button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }
        
        .tool-switcher button:hover::before {
            left: 100%;
        }
        
        .tool-switcher button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
            border-color: #007bff;
        }
        
        .tool-switcher button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #5a67d8;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }
        
        /* ===== ËÆ°ÁÆóÂô®Ê®°ÂùóÊ†∑Âºè ===== */
        .calculator {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calculator h2 {
            color: #333;
            margin: 0 0 25px 0;
            font-size: 1.8em;
            text-align: center;
            position: relative;
        }
        
        .calculator h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        /* ===== Ë°®ÂçïÂÖÉÁ¥†Ê†∑Âºè ===== */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        input[readonly] {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #666;
            cursor: not-allowed;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        /* ===== ÊåâÈíÆÊ†∑Âºè ===== */
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:active::before {
            width: 300px;
            height: 300px;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ‰∏ªË¶ÅÊåâÈíÆÊ†∑Âºè */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        /* ÊàêÂäüÊåâÈíÆÊ†∑Âºè */
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }
        
        /* Ë≠¶ÂëäÊåâÈíÆÊ†∑Âºè */
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }
        
        /* Âç±Èô©ÊåâÈíÆÊ†∑Âºè */
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4);
        }
        
        /* ===== ÁªìÊûúÊòæÁ§∫Âå∫ÂüüÊ†∑Âºè ===== */
        .result-area {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.6;
        }
        
        /* ===== ÂèÇÊï∞Ëß£ÊûêÂ∑•ÂÖ∑ÁâπÊÆäÊ†∑Âºè ===== */
        .param-results {
            margin-top: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
        }
        
        .param-group {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .param-column {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .param-column h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        /* ===== ÊåâÈíÆÁªÑÊ†∑Âºè ===== */
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        /* ===== ÊèêÁ§∫‰ø°ÊÅØÊ†∑Âºè ===== */
        .info-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffeaa7;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .info-box .title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .info-box .content {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* ===== Ë°®Ê†ºÊ†∑Âºè ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 12px;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }
        
        .data-table tr:nth-child(even) {
            background: rgba(102, 126, 234, 0.05);
        }
        

        /* ===== ÂìçÂ∫îÂºèËÆæËÆ° ===== */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .tool-switcher {
                gap: 5px;
            }
            
            .tool-switcher button {
                padding: 10px 15px;
                font-size: 12px;
            }
            
            .calculator {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .param-group {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2em;
            }
        }
        
        /* ===== ÊªöÂä®Êù°Ê†∑Âºè ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß®Â∑•ÂÖ∑ÈõÜüß®</h1>
        
        <nav class="tool-switcher">
            <button onclick="showTool('pulseTool')">üîÑ ËÑâÂÜ≤ËÆ°ÁÆóÂô®</button>
            <button onclick="showTool('conversionTool')">üî¢ ËøõÂà∂ËΩ¨Êç¢Âô®</button>
            <button onclick="showTool('paramParser')">üìã ÂèÇÊï∞Ëß£Êûê</button>
            <button onclick="showTool('iccidTool')">üì± ICCIDËØ¶ÊÉÖ</button>
            <button onclick="showTool('waterValueTool')">üíß Ê¥óÊµ¥Âçï‰ª∑</button>
            <button onclick="showTool('waterPriceTool')">üö∞ Ê∞¥ÊéßÂçï‰ª∑</button>
            <button onclick="showTool('csv89860Tool')">üìä CSViccid‰π±Á†Å</button>
            <button onclick="showTool('excelTemplateTool')">üìã ExcelÊ®°ÊùøÂ§ÑÁêÜ</button>
            <button onclick="showTool('qrGeneratorTool')">üî≤ ‰∫åÁª¥Á†ÅÁîüÊàêÂô®</button>
            <button onclick="showTool('logAnalysisTool')">üìä Êó•ÂøóËß£ÊûêÂô®</button>
        </nav>
        
        <!-- ExcelÊ®°ÊùøÂ§ÑÁêÜÂ∑•ÂÖ∑Ê®°Âùó -->
        <section id="excelTemplateTool" class="calculator">
            <h2>üìã ExcelÊ®°ÊùøÂ§ÑÁêÜÂ∑•ÂÖ∑</h2>
            <div class="form-group">
                <label>‰∏ä‰º†ExcelÊñá‰ª∂Ôºö</label>
                <input type="file" id="excelFileInput" accept=".xlsx,.xls">
            </div>
            <div class="form-group">
                <label>‰ΩøÁî®Ê®°ÊùøÔºö</label>
                <select id="templateSelect">
                    <option value="icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls" selected>icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls</option>
                </select>
                <div id="templateStatus" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 14px;">üîÑ Ê≠£Âú®Âä†ËΩΩËøúÁ®ãÊ®°Êùø...</div>
            </div>
            <div class="button-group">
                <button onclick="processExcelFile()" class="btn-primary" disabled>üìä Â§ÑÁêÜExcelÊñá‰ª∂</button>
                <button onclick="clearExcelData()" class="btn-warning">üóëÔ∏è Ê∏ÖÁ©∫Êï∞ÊçÆ</button>
            </div>
            <div class="form-group">
                <label>Â§ÑÁêÜÁä∂ÊÄÅÔºö</label>
                <div id="excelProcessStatus" class="result-area">ËØ∑‰∏ä‰º†ExcelÊñá‰ª∂Âπ∂ÈÄâÊã©Ê®°Êùø</div>
            </div>
            <div class="form-group">
                <label>Êï∞ÊçÆÈ¢ÑËßàÔºö</label>
                <div id="excelDataPreview" class="result-area" style="max-height: 300px; overflow-y: auto;">Á≠âÂæÖÊñá‰ª∂‰∏ä‰º†...</div>
            </div>
            <div class="info-box">
                <div class="title">üí° ‰ΩøÁî®ËØ¥ÊòéÔºö</div>
                <div class="content">
                    ‚Ä¢ ÊîØÊåÅ.xlsxÂíå.xlsÊ†ºÂºèÁöÑExcelÊñá‰ª∂<br>
                    ‚Ä¢ ‰ΩøÁî®GitHub Pages/Gitee PagesÊâòÁÆ°Ê®°ÊùøÊñá‰ª∂ÔºåÁ®≥ÂÆöÂèØÈù†<br>
                    ‚Ä¢ Ëá™Âä®ËØÜÂà´A„ÄÅBÂàó‰∏≠ÁöÑÊ∞¥Âç°Âè∑ÔºàÂåÖÂê´Â≠óÊØçÔºâÂíåÊµÅÊ∞¥Âè∑ÔºàÁ∫ØÊï∞Â≠óÔºâ<br>
                    ‚Ä¢ Â¶ÇÊûúÈ¶ñË°åÂåÖÂê´"ÊµÅÊ∞¥Âè∑"„ÄÅ"Ê∞¥Âç°Âè∑"Á≠â‰∏≠ÊñáÂ≠óÁ¨¶ÔºåÂ∞ÜË∑≥ËøáÈ¶ñË°å<br>
                    ‚Ä¢ Â§ÑÁêÜÂêéÁöÑÊï∞ÊçÆÂ∞ÜÂ°´ÂÖ•ËøúÁ®ãÊ®°ÊùøÊñá‰ª∂‰∏≠<br>
                    ‚Ä¢ Ê∞¥Âç°Âè∑Â°´ÂÖ•Ê®°ÊùøAÂàóÔºà‰ªéA2ÂºÄÂßãÔºâÔºåÊµÅÊ∞¥Âè∑Â°´ÂÖ•BÂàóÔºà‰ªéB2ÂºÄÂßãÔºâ<br><br>
                    üîß <strong>ÈÖçÁΩÆÊ®°ÊùøÊñá‰ª∂Ê≠•È™§Ôºö</strong><br>
                    1Ô∏è‚É£ Âú®GitHub‰∏äÂàõÂª∫‰∏Ä‰∏™ÂÖ¨ÂºÄ‰ªìÂ∫ì<br>
                    2Ô∏è‚É£ ‰∏ä‰º†`icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls`Êñá‰ª∂Âà∞‰ªìÂ∫ìÊ†πÁõÆÂΩï<br>
                    3Ô∏è‚É£ Âú®‰ªìÂ∫ìSettings‰∏≠ÂêØÁî®GitHub Pages<br>
                    4Ô∏è‚É£ Ëé∑ÂèñÊ®°ÊùøÊñá‰ª∂ÁöÑÂÖ¨ÂºÄURLÔºàÂ¶ÇÔºöhttps://username.github.io/repo/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xlsÔºâ<br>
                    5Ô∏è‚É£ ‰øÆÊîπ‰ª£Á†Å‰∏≠ÁöÑtemplateUrl‰∏∫ÂÆûÈôÖURL<br><br>
                    üéÜ <strong>Gitee PagesÂ§áÁî®ÊñπÊ°àÔºàÂõΩÂÜÖËÆøÈóÆÊõ¥Âø´ÔºâÔºö</strong><br>
                    1Ô∏è‚É£ Âú®Gitee‰∏äÂàõÂª∫‰∏Ä‰∏™ÂÖ¨ÂºÄ‰ªìÂ∫ì<br>
                    2Ô∏è‚É£ ‰∏ä‰º†`icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls`Êñá‰ª∂Âà∞‰ªìÂ∫ìÊ†πÁõÆÂΩï<br>
                    3Ô∏è‚É£ Âú®‰ªìÂ∫ìÁöÑ"ÊúçÂä°"‰∏≠ÈÄâÊã©"Gitee Pages"<br>
                    4Ô∏è‚É£ ÈÄâÊã©ÈÉ®ÁΩ≤ÂàÜÊîØÔºàÈÄöÂ∏∏‰∏∫masterÔºâÔºåÁÇπÂáª"ÂêØÂä®"<br>
                    5Ô∏è‚É£ ÊàêÂäüÂêéËé∑ÂèñURLÔºàÂ¶ÇÔºöhttps://username.gitee.io/repo/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xlsÔºâ<br>
                    6Ô∏è‚É£ Â∞ÜÊ≠§URLËÆæÁΩÆ‰∏∫fallbackUrls[0]<br><br>
                    üåç <strong>Â¶ÇÊûúGitee Pages‰∏çÂèØÁî®ÔºåÊõø‰ª£ÊñπÊ°àÔºö</strong><br>
                    ‚Ä¢ <strong>jsDelivr CDN</strong>: https://cdn.jsdelivr.net/gh/Áî®Êà∑Âêç/‰ªìÂ∫ìÂêç/Êñá‰ª∂Âêç<br>
                    ‚Ä¢ <strong>GitHub Raw</strong>: https://raw.githubusercontent.com/Áî®Êà∑Âêç/‰ªìÂ∫ìÂêç/main/Êñá‰ª∂Âêç<br>
                    ‚Ä¢ <strong>Coding.net</strong>: https://Áî®Êà∑Âêç.coding.net/p/È°πÁõÆÂêç/d/‰ªìÂ∫ìÂêç/git/raw/master/Êñá‰ª∂Âêç
                </div>
            </div>
            <div class="info-box" style="border-color: #007bff; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                <div class="title" style="color: #1565c0;">üåê ÂΩìÂâçÂ§öÈáçÂ§áÁî®ÈÖçÁΩÆÔºö</div>
                <div class="content" style="color: #1565c0; font-size: 12px;">
                    ‚Ä¢ ‰∏ªURLÔºö<code>GitHub Raw</code><br>
                    ‚Ä¢ Â§áÁî®URL 1Ôºö<code>GitHub Pages</code><br>
                    ‚Ä¢ Â§áÁî®URL 2Ôºö<code>Gitee Pages</code><br>
                    ‚Ä¢ Â§áÁî®URL 3Ôºö<code>jsDelivr CDN</code><br>
                    ‚Ä¢ Â§áÁî®URL 4Ôºö<code>Coding.net</code><br>
                    ‚Ä¢ Áä∂ÊÄÅÔºö‚úÖ Â§öÈáç‰øùÈöúÔºåÈ´òÂèØÁî®ÊÄß
                </div>
            </div>
        </section>
        
        <section id="pulseTool" class="calculator" style="display:none;">
            <h2>üîÑ ËÑâÂÜ≤ÂèÇÊï∞ËÆ°ÁÆóÂô®</h2>
            <div class="form-group">
                <label>Á≥ªÁªüËÆæÁΩÆËÑâÂÜ≤Êï∞Ôºö</label>
                <input type="number" id="systemPulses" min="0" step="1" placeholder="ËØ∑ËæìÂÖ•Ê≠£Êï¥Êï∞">
            </div>
            
            <div class="form-group">
                <label>Á≥ªÁªüÊòæÁ§∫Âá∫Ê∞¥Èáè(ml)Ôºö</label>
                <input type="number" id="systemWater" min="0" step="0.01" placeholder="ËØ∑ËæìÂÖ•Ê≠£Êï∞">
            </div>
            
            <div class="form-group">
                <label>ÂÆûÈôÖÂá∫Ê∞¥Èáè(ml)Ôºö</label>
                <input type="number" id="actualWater" placeholder="ËØ∑ËæìÂÖ•Ê≠£Êï∞">
            </div>
            
            <div class="form-group">
                <label>ÂÆûÈôÖËÑâÂÜ≤Êï∞Ôºö</label>
                <input type="number" id="actualPulses" readonly placeholder="Ëá™Âä®ËÆ°ÁÆóÁªìÊûú">
            </div>
        </section>

        <section id="conversionTool" class="calculator" style="display:none;">
            <h2>üî¢ ËøõÂà∂ËΩ¨Êç¢Â∑•ÂÖ∑</h2>
            <div class="form-group">
                <label>ÂçÅËøõÂà∂Ôºö</label>
                <input type="text" id="decimalInput" placeholder="ËæìÂÖ•0-9Êï∞Â≠ó">
            </div>
            
            <div class="form-group">
                <label>ÂçÅÂÖ≠ËøõÂà∂Ôºö</label>
                <input type="text" id="hexInput" placeholder="ËæìÂÖ•0-9/A-F">
            </div>
        </section>
        
        <section id="paramParser" class="calculator" style="display:none;">
            <h2>üìã ÂèÇÊï∞Ëß£ÊûêÂ∑•ÂÖ∑</h2>
            <div class="form-group">
                <label>ÂèÇÊï∞ÊñáÊú¨Ôºö</label>
                <textarea id="paramInput" placeholder="Á≤òË¥¥ÂèÇÊï∞ÊñáÊú¨... Á§∫‰æãÔºö
1ËÑâÂÜ≤1250ÔºåÊ£Ä‰øÆ720ÔºåÂ§ß/1ÈÄöÈÅì/ÁÉ≠Ê∞¥Ë¥πÁéá[ÂÖÉ/Âçá]0.5"></textarea>
            </div>
            <div class="button-group">
                <button onclick="parseParams()" class="btn-primary">üîç Ëß£ÊûêÂèÇÊï∞</button>
            </div>
            
            <div class="param-results">
                <div class="param-group">
                    <div class="param-column">
                        <h4>Ê†áÂáÜÊ†ºÂºèÔºö</h4>
                        <div id="formattedParams"></div>
                    </div>
                </div>
            </div>
        </section>
        

        
        <!-- ICCIDËØ¶ÊÉÖÂ∑•ÂÖ∑Ê®°Âùó -->
        <section id="iccidTool" class="calculator" style="display:none;">
            <h2>ICCIDËØ¶ÊÉÖÂ∑•ÂÖ∑</h2>
            <div class="form-group">
                <textarea id="iccidInput" placeholder="Á≤òË¥¥ICCIDËåÉÂõ¥ÊñáÊú¨... Á§∫‰æãÔºö
898604C6062290468489Âà∞898604C6062290468491(3Âº†)
898604C6062290469305Âà∞898604C6062290469309Ôºà5Âº†Ôºâ
898604D00623D0047511'
898604D00623D0047313'
898604D00623D0046269'

ÊîØÊåÅÂêåÊó∂Ëß£Êûê‰∏§ÁßçÊ†ºÂºèÁöÑICCID
ÊåâCtrl+EnterÂèØ‰ª•Êç¢Ë°å
" style="width:100%; height:100px; padding:8px; margin-bottom:10px;"></textarea>
            </div>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button onclick="parseIccids()" style="background: #007bff; color: white; padding: 8px 20px;">Ëß£ÊûêÊï∞ÊçÆ</button>
                <button onclick="formatIccids()" style="background: #28a745; color: white; padding: 8px 20px;">‰øÆÊîπÊ†ºÂºè</button>
                <button onclick="addQuotesToIccids()" style="background: #ffc107; color: black; padding: 8px 20px;">ÊÅ¢Â§çÊ†ºÂºè</button>
            </div>
            
            <div class="form-group">
                <label>Ëß£ÊûêÁªìÊûúÔºö</label>
                <textarea id="iccidResult" style="width:100%; height:200px; padding:8px;"></textarea>
            </div>
        </section>

        <section id="waterValueTool" class="calculator" style="display:none;">
            <h2>üíß Ê¥óÊµ¥Ê∞¥Êéß ÈáëÈ¢ùÊ∞¥ÈáèÊç¢ÁÆó</h2>
            <div class="form-group">
                <label>ÈáëÈ¢ù (ÂÖÉ):</label>
                <input type="number" id="amount" step="0.01" placeholder="ËæìÂÖ•ÈáëÈ¢ù" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>Ê∞¥Èáè (ÊØ´Âçá):</label>
                <input type="number" id="waterVolume" placeholder="ËæìÂÖ•Ê∞¥Èáè" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>1ÂàÜÈí±ÂØπÂ∫îÊ∞¥Èáè (ÊØ´Âçá):</label>
                <input type="number" id="pricePerMl" step="0.01" placeholder="ËæìÂÖ•1ÂàÜÈí±ÂØπÂ∫îÁöÑÊØ´ÂçáÊï∞" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>Êç¢ÁÆóÁªìÊûúÔºö</label>
                <div id="waterValueResult" class="result-area">
                    <div id="waterCalculations">ËØ∑ËæìÂÖ•‰ªªÊÑè‰∏§‰∏™ÂèÇÊï∞ËøõË°åËÆ°ÁÆó</div>
                </div>
            </div>
        </section>

        <section id="waterPriceTool" class="calculator" style="display:none;">
            <h2>üö∞ ÂÖ±‰∫´Âçï‰ª∑ËÆ°ÁÆóÂô®</h2>
            <div class="form-group">
                <label>Ê∞¥Èáè (ÊØ´Âçá):</label>
                <input type="number" id="waterVolume2" step="0.01" placeholder="‰æãÂ¶ÇÔºö787" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>Ê∂àË¥πÈáëÈ¢ù (ÂÖÉ):</label>
                <input type="number" id="amount2" step="0.0001" placeholder="‰æãÂ¶ÇÔºö0.2385" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>1ÂçáÊ∞¥Âçï‰ª∑ (ÂÖÉ/Âçá):</label>
                <input type="number" id="pricePerLiter" step="0.0001" placeholder="‰æãÂ¶ÇÔºö0.3030" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>ËÆ°ÁÆóÁªìÊûúÔºö</label>
                <div id="waterPriceResult" class="result-area">
                    <div id="waterPriceCalculations">ËØ∑ËæìÂÖ•‰ªªÊÑè‰∏§‰∏™ÂèÇÊï∞ËøõË°åËÆ°ÁÆó</div>
                </div>
            </div>
        </section>
        
        <!-- CSV 89860 Â§ÑÁêÜÂ∑•ÂÖ∑Ê®°Âùó -->
        <section id="csv89860Tool" class="calculator" style="display:none;">
                <h2>üìä CSV 89860 Â§ÑÁêÜÂ∑•ÂÖ∑</h2>
                <div class="form-group">
                    <label>‰∏ä‰º†CSVÊñá‰ª∂Ôºö</label>
                    <input type="file" id="csvFileInput" accept=".csv">
                </div>
                <button onclick="processCSVFile()" disabled>Â§ÑÁêÜÊñá‰ª∂</button>
                <div class="form-group">
                    <label>Â§ÑÁêÜÁä∂ÊÄÅÔºö</label>
                    <div id="csvProcessStatus" style="min-height: 40px;">ËØ∑ÈÄâÊã©CSVÊñá‰ª∂ËøõË°åÂ§ÑÁêÜ</div>
                </div>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">üí° ‰ΩøÁî®ËØ¥ÊòéÔºö</div>
                    <div style="color: #856404; font-size: 14px;">
                        ‚Ä¢ ‰∏ä‰º†CSVÊñá‰ª∂ÂêéËá™Âä®Âú®ÊâÄÊúâ"89860"ÂâçÊ∑ªÂä†Ëã±ÊñáÂçïÂºïÂè∑<br>
                        ‚Ä¢ Â§ÑÁêÜÂÆåÊàêÂêéÂèØ‰∏ãËΩΩ‰øÆÊîπÂêéÁöÑÊñá‰ª∂<br>
                        ‚Ä¢ Èò≤Ê≠¢ExcelËá™Âä®Â∞Ü"89860"ËΩ¨Êç¢‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ï
                    </div>
                </div>
        </section>

    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let excelData = null;
        let parsedData = { waterCardNumbers: [], serialNumbers: [] };
        let uploadedFileName = '';
        let templateWorkbook = null;
        let loadedTemplates = new Map(); // Â≠òÂÇ®Â∑≤Âä†ËΩΩÁöÑÊ®°ÊùøÊñá‰ª∂
        
        // ËøúÁ®ãÊ®°ÊùøÈÖçÁΩÆÔºàÂ§öÈáçÂ§áÁî®ÊñπÊ°àÔºâ
        const remoteTemplateConfig = {
            // üîó ‰∏ªÊñπÊ°à‰ΩøÁî®GitHub RawÔºåÊõ¥Á®≥ÂÆöÂèØÈù†
            templateUrl: 'https://raw.githubusercontent.com/DDzhp/ICkamuban/main/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls',
            templateName: 'icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls',
            // Â§ö‰∏™Â§áÁî®URLÔºàÊåâ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºâ
            fallbackUrls: [
                'https://DDzhp.github.io/ICkamuban/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls',  // GitHub Pages
                'https://raw.githubusercontent.com/DDzhp/ICkamuban/main/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls',  // Gitee Pages
                'https://cdn.jsdelivr.net/gh/DDzhp/ICkamuban/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls',  // jsDelivr CDN
                'https://your-username.coding.net/p/your-project/d/your-repo/git/raw/master/icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls'  // Coding.net
            ]
        };
        
        // ‰ªéËøúÁ®ãURLÂä†ËΩΩÊ®°ÊùøÊñá‰ª∂ÔºàÊîØÊåÅÂ§öÈáçÂ§áÁî®Ôºâ
        async function loadRemoteTemplate() {
            const statusDiv = document.getElementById('templateStatus');
            const { templateUrl, templateName, fallbackUrls } = remoteTemplateConfig;
            
            statusDiv.innerHTML = 'üîÑ Ê≠£Âú®‰ªéËøúÁ®ãÊúçÂä°Âô®Âä†ËΩΩÊ®°Êùø...';
            
            // ÊâÄÊúâË¶ÅÂ∞ùËØïÁöÑURLÂàóË°®
            const urlsToTry = [templateUrl, ...fallbackUrls];
            let lastError = null;
            
            for (let i = 0; i < urlsToTry.length; i++) {
                const currentUrl = urlsToTry[i];
                if (!currentUrl || currentUrl.includes('your-username')) {
                    continue; // Ë∑≥ËøáÊú™ÈÖçÁΩÆÁöÑURL
                }
                
                try {
                    statusDiv.innerHTML = `üîÑ Ê≠£Âú®Â∞ùËØïÁ¨¨${i + 1}‰∏™ÊúçÂä°Âô®: ${getServerName(currentUrl)}...`;
                    
                    const response = await fetch(currentUrl, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'default'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    // Ëé∑ÂèñÊñá‰ª∂Êï∞ÊçÆ
                    const arrayBuffer = await response.arrayBuffer();
                    const data = new Uint8Array(arrayBuffer);
                    
                    // ‰ΩøÁî®XLSXËØªÂèñÊ®°Êùø
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // È™åËØÅÂ∑•‰ΩúÁ∞ø
                    if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) {
                        throw new Error('Ê®°ÊùøÊñá‰ª∂Ê†ºÂºèÊó†Êïà');
                    }
                    
                    // Â≠òÂÇ®Ê®°ÊùøÂ∑•‰ΩúÁ∞øÂíåÊù•Ê∫ê‰ø°ÊÅØ
                    loadedTemplates.set(templateName, {
                        workbook: workbook,
                        fileName: templateName,
                        fileData: data,
                        source: `${getServerName(currentUrl)} - ${currentUrl}`,
                        loadedAt: new Date().toISOString()
                    });
                    
                    statusDiv.innerHTML = `‚úÖ ËøúÁ®ãÊ®°ÊùøÂä†ËΩΩÊàêÂäü: ${templateName}<br>` +
                        `üìä ÂåÖÂê´ ${workbook.SheetNames.length} ‰∏™Â∑•‰ΩúË°®<br>` +
                        `üåê Êù•Ê∫ê: ${getServerName(currentUrl)} (Á¨¨${i + 1}‰∏™ÊúçÂä°Âô®)<br>` +
                        `üîó ÂΩìÂâçURL: <code style="font-size:11px;color:#666;">${currentUrl}</code>`;
                    
                    console.log('ËøúÁ®ãÊ®°ÊùøÂä†ËΩΩÊàêÂäü:', {
                        name: templateName,
                        sheets: workbook.SheetNames,
                        size: `${(data.length / 1024).toFixed(2)}KB`,
                        source: currentUrl
                    });
                    
                    // ÂêØÁî®Â§ÑÁêÜÊåâÈíÆ
                    updateProcessButton();
                    
                    return; // ÊàêÂäüÂêéÈÄÄÂá∫
                    
                } catch (error) {
                    lastError = error;
                    console.warn(`Á¨¨${i + 1}‰∏™ÊúçÂä°Âô®Â§±Ë¥•:`, currentUrl, error.message);
                    
                    if (i < urlsToTry.length - 1) {
                        statusDiv.innerHTML = `‚ö†Ô∏è ${getServerName(currentUrl)}Â§±Ë¥•ÔºåÊ≠£Âú®Â∞ùËØï‰∏ã‰∏Ä‰∏™ÊúçÂä°Âô®...`;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Á≠âÂæÖ1Áßí
                    }
                }
            }
            
            // ÊâÄÊúâURLÈÉΩÂ§±Ë¥•
            console.error('ÊâÄÊúâËøúÁ®ãÊ®°ÊùøÂä†ËΩΩÂ§±Ë¥•:', lastError);
            statusDiv.innerHTML = `‚ùå ÊâÄÊúâËøúÁ®ãÊ®°ÊùøÈÉΩÂä†ËΩΩÂ§±Ë¥•<br>` +
                `üìù ËØ∑Ê£ÄÊü•‰ª•‰∏ã‰∫ãÈ°πÔºö<br>` +
                `‚Ä¢ Á°Æ‰øùÊ®°ÊùøÊñá‰ª∂Â∑≤Ê≠£Á°Æ‰∏ä‰º†<br>` +
                `‚Ä¢ Ê£ÄÊü•URLÈÖçÁΩÆÊòØÂê¶Ê≠£Á°Æ<br>` +
                `‚Ä¢ Á°Æ‰øùÁΩëÁªúËøûÊé•Ê≠£Â∏∏<br>` +
                `‚Ä¢ Â∞ùËØï‰ΩøÁî®‰∏ãÈù¢ÁöÑÊõø‰ª£ÊñπÊ°à<br>` +
                `üîó Â∞ùËØïÁöÑURLÂàóË°®: <details><summary>ÁÇπÂáªÊü•Áúã</summary><pre style="font-size:10px;">${urlsToTry.filter(url => url && !url.includes('your-username')).join('\n')}</pre></details>`;
            
            // Á¶ÅÁî®Â§ÑÁêÜÊåâÈíÆ
            updateProcessButton();
        }
        
        // Ëé∑ÂèñÊúçÂä°Âô®ÂêçÁß∞
        function getServerName(url) {
            if (url.includes('github.io')) return 'GitHub Pages';
            if (url.includes('gitee.io')) return 'Gitee Pages';
            if (url.includes('coding.net')) return 'Coding.net';
            if (url.includes('jsdelivr.net')) return 'jsDelivr CDN';
            if (url.includes('githubusercontent.com')) return 'GitHub Raw';
            return 'Êú™Áü•ÊúçÂä°Âô®';
        }
        
        // Â∑•ÂÖ∑ÂàáÊç¢ÂáΩÊï∞
        function showTool(toolId) {
            document.querySelectorAll('.calculator').forEach(tool => {
                tool.style.display = 'none';
            });
            
            document.getElementById(toolId).style.display = 'block';
            
            document.querySelectorAll('.tool-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            // ÊâæÂà∞ÂØπÂ∫îÁöÑÊåâÈíÆÂπ∂Ê∑ªÂä†activeÁ±ª
            const activeButton = document.querySelector(`.tool-switcher button[onclick="showTool('${toolId}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // ===== ExcelÊ®°ÊùøÂ§ÑÁêÜÁõ∏ÂÖ≥ÂáΩÊï∞ =====
        
        // Âä†ËΩΩÊ®°ÊùøÊñá‰ª∂ÂàóË°®
        const templatePath = 'icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls';
        // Âä†ËΩΩÊåáÂÆöË∑ØÂæÑÁöÑÊ®°Êùø
        async function loadSpecificTemplate() {
            const templateName = 'icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls';
            const statusDiv = document.getElementById('templateStatus');
            
            try {
                // È¶ñÂÖàÂ∞ùËØï‰ªéÊåáÂÆöÁªùÂØπË∑ØÂæÑÂä†ËΩΩÊ®°ÊùøÊñá‰ª∂
                let response;
                let usedPath;
                
                try {
                    response = await fetch(templatePath);
                    usedPath = templatePath;
                } catch (error) {
                    // ÁªùÂØπË∑ØÂæÑÂ§±Ë¥•ÔºåÂ∞ùËØïÁõ∏ÂØπË∑ØÂæÑ
                    response = await fetch(templateName);
                    usedPath = templateName;
                }
                
                if (!response.ok) {
                    throw new Error(`Êó†Ê≥ïÂä†ËΩΩÊ®°ÊùøÊñá‰ª∂: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // Â≠òÂÇ®Ê®°ÊùøÂ∑•‰ΩúÁ∞ø
                loadedTemplates.set(templateName, {
                    workbook: workbook,
                    fileName: templateName,
                    fileData: data
                });
                
                statusDiv.innerHTML = `‚úÖ Â∑≤ÊàêÂäüÂä†ËΩΩÊ®°Êùø: ${usedPath}`;
                
            } catch (error) {
                console.error('Âä†ËΩΩÊ®°ÊùøÂ§±Ë¥•:', error);
                statusDiv.innerHTML = `‚ö†Ô∏è Âä†ËΩΩÊ®°ÊùøÂ§±Ë¥•: ${error.message}<br>ËØ∑Á°Æ‰øùÊú¨Âú∞ÊúçÂä°Âô®ËøêË°å‰∏îÊ®°ÊùøÊñá‰ª∂ÂèØËÆøÈóÆ: ${templatePath}`;
            }
        }
        async function loadTemplateList() {
            // Â¶ÇÊûúÂ∑≤ÁªèÊúâÂä†ËΩΩÁöÑÊ®°ÊùøÔºåÊòæÁ§∫ÂÆÉ‰ª¨
            if (loadedTemplates.size > 0) {
                renderTemplateOptions();
            } else {
                // ÊèêÁ§∫Áî®Êà∑Âä†ËΩΩÊ®°Êùø
                const statusDiv = document.getElementById('excelProcessStatus');
                statusDiv.innerHTML = 'ËØ∑ÁÇπÂáª‚ÄúÂä†ËΩΩÊ®°ÊùøÊñá‰ª∂Â§π‚ÄùÊåâÈíÆÊù•ÈÄâÊã©Ê®°ÊùøÊñá‰ª∂';
            }
        }
        
        // Â§ÑÁêÜÊ®°ÊùøÊñá‰ª∂‰∏ä‰º†
        function handleTemplateUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('excelProcessStatus');
            statusDiv.innerHTML = 'Ê≠£Âú®Âä†ËΩΩÊ®°ÊùøÊñá‰ª∂...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    templateWorkbook = XLSX.read(data, { type: 'array' });
                    
                    // Êõ¥Êñ∞ÈÄâÊã©Ê°ÜÊòæÁ§∫Â∑≤‰∏ä‰º†ÁöÑÊ®°Êùø
                    const select = document.getElementById('templateSelect');
                    const uploadedOption = document.createElement('option');
                    uploadedOption.value = 'uploaded';
                    uploadedOption.textContent = `üìÑ ${file.name} (Â∑≤‰∏ä‰º†)`;
                    uploadedOption.selected = true;
                    
                    // ÁßªÈô§‰πãÂâçÁöÑ‰∏ä‰º†ÈÄâÈ°π
                    const existingUploaded = select.querySelector('option[value="uploaded"]');
                    if (existingUploaded) {
                        existingUploaded.remove();
                    }
                    
                    select.appendChild(uploadedOption);
                    
                    statusDiv.innerHTML = `Ê®°ÊùøÊñá‰ª∂ "${file.name}" Âä†ËΩΩÊàêÂäü`;
                    updateProcessButton();
                    
                } catch (error) {
                    statusDiv.innerHTML = `Ê®°ÊùøÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•: ${error.message}`;
                    templateWorkbook = null;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // ËØªÂèñExcelÊñá‰ª∂
        function readExcelFile(file) {
            const statusDiv = document.getElementById('excelProcessStatus');
            const previewDiv = document.getElementById('excelDataPreview');
            
            // ‰øùÂ≠ò‰∏ä‰º†Êñá‰ª∂Âêç
            uploadedFileName = file.name;
            
            statusDiv.innerHTML = 'Ê≠£Âú®ËØªÂèñExcelÊñá‰ª∂...';
            previewDiv.innerHTML = 'Ê≠£Âú®Ëß£ÊûêÊñá‰ª∂ÂÜÖÂÆπ...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™Â∑•‰ΩúË°®
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // ËΩ¨Êç¢‰∏∫JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    excelData = jsonData;
                    analyzeExcelData(jsonData);
                    
                } catch (error) {
                    statusDiv.innerHTML = `ËØªÂèñÊñá‰ª∂Â§±Ë¥•: ${error.message}`;
                    previewDiv.innerHTML = 'Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•';
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // ÂàÜÊûêExcelÊï∞ÊçÆ
        function analyzeExcelData(data) {
            const statusDiv = document.getElementById('excelProcessStatus');
            const previewDiv = document.getElementById('excelDataPreview');
            
            try {
                if (!data || data.length === 0) {
                    statusDiv.innerHTML = 'Êñá‰ª∂‰∏∫Á©∫ÊàñÊó†ÊúâÊïàÊï∞ÊçÆ';
                    return;
                }
                
                let startRow = 0;
                let waterCardCol = -1;
                let serialCol = -1;
                
                // Ê£ÄÊü•È¶ñË°åÊòØÂê¶ÂåÖÂê´‰∏≠ÊñáÂ≠óÁ¨¶
                const firstRow = data[0] || [];
                const hasChineseInFirstRow = firstRow.some(cell => 
                    cell && /[\u4e00-\u9fa5]/.test(cell.toString())
                );
                
                if (hasChineseInFirstRow) {
                    startRow = 1;
                    statusDiv.innerHTML = 'Ê£ÄÊµãÂà∞È¶ñË°åÂåÖÂê´‰∏≠ÊñáÔºåÂ∞Ü‰ªéÁ¨¨‰∫åË°åÂºÄÂßãÂ§ÑÁêÜ';
                } else {
                    startRow = 0;
                    statusDiv.innerHTML = 'È¶ñË°å‰∏çÂåÖÂê´‰∏≠ÊñáÔºå‰ªéÁ¨¨‰∏ÄË°åÂºÄÂßãÂ§ÑÁêÜ';
                }
                
                // ÂàÜÊûêA„ÄÅBÂàóÊï∞ÊçÆÁ±ªÂûã
                const sampleSize = Math.min(10, data.length - startRow);
                let colAHasLetters = false;
                let colBHasLetters = false;
                
                for (let i = startRow; i < startRow + sampleSize && i < data.length; i++) {
                    const row = data[i];
                    if (row && row.length >= 2) {
                        const cellA = row[0] ? row[0].toString() : '';
                        const cellB = row[1] ? row[1].toString() : '';
                        
                        if (/[a-zA-Z]/.test(cellA)) colAHasLetters = true;
                        if (/[a-zA-Z]/.test(cellB)) colBHasLetters = true;
                    }
                }
                
                // Ê†πÊçÆËßÑÂàôÁ°ÆÂÆöÂàóÁ±ªÂûã
                if (colAHasLetters && !colBHasLetters) {
                    waterCardCol = 0;
                    serialCol = 1;
                } else if (colBHasLetters && !colAHasLetters) {
                    waterCardCol = 1;
                    serialCol = 0;
                } else if (colAHasLetters && colBHasLetters) {
                    // ‰∏§ÂàóÈÉΩÊúâÂ≠óÊØçÔºåÈªòËÆ§AÂàó‰∏∫Ê∞¥Âç°Âè∑
                    waterCardCol = 0;
                    serialCol = 1;
                } else {
                    // ÈÉΩÊòØÁ∫ØÊï∞Â≠óÔºåÈªòËÆ§AÂàó‰∏∫ÊµÅÊ∞¥Âè∑ÔºåBÂàó‰∏∫Ê∞¥Âç°Âè∑
                    serialCol = 0;
                    waterCardCol = 1;
                }
                
                // ÊèêÂèñÊï∞ÊçÆ
                const waterCards = [];
                const serials = [];
                
                for (let i = startRow; i < data.length; i++) {
                    const row = data[i];
                    if (row && row.length >= 2) {
                        if (waterCardCol >= 0 && row[waterCardCol]) {
                            waterCards.push(row[waterCardCol].toString());
                        }
                        if (serialCol >= 0 && row[serialCol]) {
                            serials.push(row[serialCol].toString());
                        }
                    }
                }
                
                parsedData = {
                    waterCardNumbers: waterCards,
                    serialNumbers: serials
                };
                
                // ÊòæÁ§∫È¢ÑËßà
                let preview = `<h4>Êï∞ÊçÆËß£ÊûêÁªìÊûúÔºö</h4>`;
                preview += `<p>ÂºÄÂßãË°åÔºöÁ¨¨${startRow + 1}Ë°å</p>`;
                preview += `<p>Ê∞¥Âç°Âè∑ÂàóÔºö${String.fromCharCode(65 + waterCardCol)}Âàó (${waterCards.length}Êù°)</p>`;
                preview += `<p>ÊµÅÊ∞¥Âè∑ÂàóÔºö${String.fromCharCode(65 + serialCol)}Âàó (${serials.length}Êù°)</p>`;
                
                preview += `<table class="data-table">`;
                preview += `<tr><th>Â∫èÂè∑</th><th>Ê∞¥Âç°Âè∑</th><th>ÊµÅÊ∞¥Âè∑</th></tr>`;
                
                const maxRows = Math.min(10, Math.max(waterCards.length, serials.length));
                for (let i = 0; i < maxRows; i++) {
                    preview += `<tr>`;
                    preview += `<td>${i + 1}</td>`;
                    preview += `<td>${waterCards[i] || ''}</td>`;
                    preview += `<td>${serials[i] || ''}</td>`;
                    preview += `</tr>`;
                }
                
                if (Math.max(waterCards.length, serials.length) > 10) {
                    preview += `<tr><td colspan="3">... ËøòÊúâ ${Math.max(waterCards.length, serials.length) - 10} Ë°åÊï∞ÊçÆ</td></tr>`;
                }
                
                preview += `</table>`;
                
                previewDiv.innerHTML = preview;
                statusDiv.innerHTML = `Êï∞ÊçÆËß£ÊûêÂÆåÊàêÔºÅÂÖ±ËØÜÂà´Âà∞ ${waterCards.length} ‰∏™Ê∞¥Âç°Âè∑Âíå ${serials.length} ‰∏™ÊµÅÊ∞¥Âè∑`;
                
                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                updateProcessButton();
                
            } catch (error) {
                statusDiv.innerHTML = `Êï∞ÊçÆÂàÜÊûêÂ§±Ë¥•: ${error.message}`;
                previewDiv.innerHTML = 'Êï∞ÊçÆÂàÜÊûêÂ§±Ë¥•';
            }
        }
        
        // Â§ÑÁêÜExcelÊñá‰ª∂
        async function processExcelFile() {
            const statusDiv = document.getElementById('excelProcessStatus');
            const templateName = document.getElementById('templateSelect').value;
            
            if (!excelData || !templateName) {
                statusDiv.innerHTML = 'ËØ∑Á°Æ‰øùÂ∑≤‰∏ä‰º†Êñá‰ª∂Âπ∂ÈÄâÊã©Ê®°Êùø';
                return;
            }
            
            if (!loadedTemplates.has(templateName)) {
                statusDiv.innerHTML = 'ÈÄâ‰∏≠ÁöÑÊ®°ÊùøÊñá‰ª∂‰∏çÂ≠òÂú®ÔºåËØ∑ÈáçÊñ∞Âä†ËΩΩÊ®°Êùø';
                return;
            }
            
            try {
                statusDiv.innerHTML = 'üîÑ Ê≠£Âú®‰ΩøÁî®Ê®°ÊùøÂ§ÑÁêÜÊï∞ÊçÆ...';
                
                // Ëé∑ÂèñÊ®°ÊùøÂ∑•‰ΩúÁ∞øÂíåÊù•Ê∫ê‰ø°ÊÅØ
                const templateInfo = loadedTemplates.get(templateName);
                const templateWorkbook = templateInfo.workbook;
                const templateSource = templateInfo.source || 'Êú¨Âú∞ÁºìÂ≠ò';
                
                // ‰ΩøÁî®Ê®°ÊùøÂ§ÑÁêÜÊï∞ÊçÆ
                const result = await processWithTemplate(templateWorkbook, templateName, templateSource);
                
                if (result.success) {
                    statusDiv.innerHTML = `‚úÖ Êñá‰ª∂Â§ÑÁêÜÂÆåÊàêÔºÅ<br>` +
                        `‚Ä¢ ‰ΩøÁî®Ê®°ÊùøÔºö${templateName}<br>` +
                        `‚Ä¢ Ê®°ÊùøÊù•Ê∫êÔºö${templateSource}<br>` +
                        `‚Ä¢ Â∑≤‰∏ãËΩΩÊñá‰ª∂Ôºö${result.filename}<br>` +
                        `‚Ä¢ Ê∞¥Âç°Âè∑Ôºö${parsedData.waterCardNumbers.length}Êù°ÔºåÊµÅÊ∞¥Âè∑Ôºö${parsedData.serialNumbers.length}Êù°<br>` +
                        `‚Ä¢ Êï∞ÊçÆÂ∑≤Â°´ÂÖ•Ê®°ÊùøAÂàóÂíåBÂàóÔºà‰ªéA2„ÄÅB2ÂºÄÂßãÔºâ`;
                } else {
                    statusDiv.innerHTML = `‚ùå Â§ÑÁêÜÂ§±Ë¥•Ôºö${result.error}`;
                }
                
            } catch (error) {
                statusDiv.innerHTML = `‚ùå Â§ÑÁêÜÂ§±Ë¥•: ${error.message}`;
                console.error('Â§ÑÁêÜExcelÊñá‰ª∂Â§±Ë¥•:', error);
            }
        }
        
        // ‰ΩøÁî®Ê®°ÊùøÂ§ÑÁêÜÊï∞ÊçÆ
        async function processWithTemplate(templateWorkbook, templateName, templateSource) {
            try {
                // ÂÖãÈöÜÊ®°ÊùøÂ∑•‰ΩúÁ∞ø
                const newWorkbook = XLSX.utils.book_new();
                
                // Â§çÂà∂Ê®°ÊùøÁöÑÊâÄÊúâÂ∑•‰ΩúË°®
                templateWorkbook.SheetNames.forEach(sheetName => {
                    const originalSheet = templateWorkbook.Sheets[sheetName];
                    
                    // Â§çÂà∂ÂéüÂ∑•‰ΩúË°®ÁöÑÊï∞ÊçÆ
                    const sheetData = XLSX.utils.sheet_to_json(originalSheet, { header: 1, defval: '' });
                    
                    // Âú®A2ÂíåB2‰ΩçÁΩÆÂºÄÂßãÂ°´ÂÖ•Êï∞ÊçÆ
                    const maxRows = Math.max(parsedData.waterCardNumbers.length, parsedData.serialNumbers.length);
                    
                    // Á°Æ‰øùÊúâË∂≥Â§üÁöÑË°åÊï∞
                    while (sheetData.length < maxRows + 1) {
                        sheetData.push([]);
                    }
                    
                    // Â°´ÂÖ•Êï∞ÊçÆÂà∞AÂàóÂíåBÂàóÔºà‰ªéA2„ÄÅB2ÂºÄÂßãÔºâ
                    for (let i = 0; i < maxRows; i++) {
                        const rowIndex = i + 1; // ‰ªéÁ¨¨2Ë°åÂºÄÂßãÔºà0-basedÁ¥¢ÂºïÔºâ
                        
                        // Á°Æ‰øùË°åÂ≠òÂú®
                        if (!sheetData[rowIndex]) {
                            sheetData[rowIndex] = [];
                        }
                        
                        // Â°´ÂÖ•AÂàóÔºàÊ∞¥Âç°Âè∑Ôºâ
                        if (parsedData.waterCardNumbers[i]) {
                            sheetData[rowIndex][0] = parsedData.waterCardNumbers[i];
                        }
                        
                        // Â°´ÂÖ•BÂàóÔºàÊµÅÊ∞¥Âè∑Ôºâ
                        if (parsedData.serialNumbers[i]) {
                            sheetData[rowIndex][1] = parsedData.serialNumbers[i];
                        }
                    }
                    
                    // ÂàõÂª∫Êñ∞ÁöÑÂ∑•‰ΩúË°®
                    const newSheet = XLSX.utils.aoa_to_sheet(sheetData);
                    
                    // Â§çÂà∂ÂéüÂßãÂ∑•‰ΩúË°®ÁöÑÂÖ∂‰ªñÂ±ûÊÄßÔºàÂ¶ÇÂàóÂÆΩ„ÄÅÊ†ºÂºèÁ≠âÔºâ
                    if (originalSheet['!cols']) {
                        newSheet['!cols'] = originalSheet['!cols'];
                    }
                    if (originalSheet['!rows']) {
                        newSheet['!rows'] = originalSheet['!rows'];
                    }
                    if (originalSheet['!merges']) {
                        newSheet['!merges'] = originalSheet['!merges'];
                    }
                    
                    XLSX.utils.book_append_sheet(newWorkbook, newSheet, sheetName);
                });
                
                // ÁîüÊàêÊñá‰ª∂Âπ∂‰∏ãËΩΩ
                const originalName = uploadedFileName;
                const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.xlsx';
                const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                const filename = `${baseName}_Â∑≤Â§ÑÁêÜ${extension}`;
                XLSX.writeFile(newWorkbook, filename);
                
                return {
                    success: true,
                    filename: filename,
                    templateSource: templateSource
                };
                
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        // ‰ΩøÁî®ÈªòËÆ§Ê®°ÊùøÂ§ÑÁêÜ
        function processWithDefaultTemplate() {
            const statusDiv = document.getElementById('excelProcessStatus');
            
            try {
                // ÂàõÂª∫Êñ∞ÁöÑÂ∑•‰ΩúÁ∞ø
                const newWorkbook = XLSX.utils.book_new();
                
                // ÂàõÂª∫Â∑•‰ΩúË°®Êï∞ÊçÆ
                const wsData = [];
                
                // Ê∑ªÂä†Ê†áÈ¢òË°å
                wsData.push(['Ê∞¥Âç°Âè∑', 'ÊµÅÊ∞¥Âè∑']);
                
                // Ê∑ªÂä†Êï∞ÊçÆË°å
                const maxRows = Math.max(parsedData.waterCardNumbers.length, parsedData.serialNumbers.length);
                for (let i = 0; i < maxRows; i++) {
                    wsData.push([
                        parsedData.waterCardNumbers[i] || '',
                        parsedData.serialNumbers[i] || ''
                    ]);
                }
                
                // ÂàõÂª∫Â∑•‰ΩúË°®
                const worksheet = XLSX.utils.aoa_to_sheet(wsData);
                
                // Ê∑ªÂä†Â∑•‰ΩúË°®Âà∞Â∑•‰ΩúÁ∞ø
                XLSX.utils.book_append_sheet(newWorkbook, worksheet, 'Sheet1');
                
                // ÁîüÊàêÊñá‰ª∂Âπ∂‰∏ãËΩΩ
                const originalName = uploadedFileName;
                const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.xlsx';
                const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                const filename = `${baseName}Â∑≤Â§ÑÁêÜ${extension}`;
                XLSX.writeFile(newWorkbook, filename);
                
                statusDiv.innerHTML = `Êñá‰ª∂Â§ÑÁêÜÂÆåÊàêÔºÅ<br>` +
                    `‚Ä¢ ‰ΩøÁî®ÈªòËÆ§Ê®°Êùø<br>` +
                    `‚Ä¢ Â∑≤‰∏ãËΩΩÊñá‰ª∂Ôºö${filename}<br>` +
                    `‚Ä¢ Ê∞¥Âç°Âè∑Ôºö${parsedData.waterCardNumbers.length}Êù°ÔºåÊµÅÊ∞¥Âè∑Ôºö${parsedData.serialNumbers.length}Êù°`;
                
            } catch (error) {
                statusDiv.innerHTML = `ÈªòËÆ§Ê®°ÊùøÂ§ÑÁêÜÂ§±Ë¥•: ${error.message}`;
            }
        }
        
        // Ê∏ÖÁ©∫Êï∞ÊçÆ
        function clearExcelData() {
            excelData = null;
            parsedData = { waterCardNumbers: [], serialNumbers: [] };
            uploadedFileName = '';
            templateWorkbook = null;
            document.getElementById('excelFileInput').value = '';
            document.getElementById('templateSelect').value = '';
            document.getElementById('templateFileInput').value = '';
            
            // ÁßªÈô§‰∏ä‰º†ÁöÑÊ®°ÊùøÈÄâÈ°π
            const select = document.getElementById('templateSelect');
            const uploadedOption = select.querySelector('option[value="uploaded"]');
            if (uploadedOption) {
                uploadedOption.remove();
            }
            
            document.getElementById('excelProcessStatus').innerHTML = 'ËØ∑‰∏ä‰º†ExcelÊñá‰ª∂Âπ∂ÈÄâÊã©Ê®°Êùø';
            document.getElementById('excelDataPreview').innerHTML = 'Á≠âÂæÖÊñá‰ª∂‰∏ä‰º†...';
            updateProcessButton();
        }
        
        // Êõ¥Êñ∞Â§ÑÁêÜÊåâÈíÆÁä∂ÊÄÅ
        function updateProcessButton() {
            const hasFile = excelData !== null;
            const hasTemplate = document.getElementById('templateSelect').value !== '' && loadedTemplates.has('icÂç°ÂÖ•Â∫ìÊ®°Êùø.xls');
            const processButton = document.querySelector('#excelTemplateTool .btn-primary');
            processButton.disabled = !(hasFile && hasTemplate);
            
            // Êõ¥Êñ∞ÊåâÈíÆÊñáÊú¨ÊòæÁ§∫ÂΩìÂâçÁä∂ÊÄÅ
            if (processButton.disabled) {
                if (!hasFile) {
                    processButton.textContent = 'üìä ËØ∑ÂÖà‰∏ä‰º†ExcelÊñá‰ª∂';
                } else if (!hasTemplate) {
                    processButton.textContent = 'üìä Ê≠£Âú®Âä†ËΩΩÊ®°Êùø...';
                }
            } else {
                processButton.textContent = 'üìä Â§ÑÁêÜExcelÊñá‰ª∂';
            }
        }

        // ÂçÅËøõÂà∂ËΩ¨ÂçÅÂÖ≠ËøõÂà∂ÂáΩÊï∞
        function convertDecToHex() {
            const decimalValue = document.getElementById('decimalInput').value;
            if (/^\d+$/.test(decimalValue)) {
                const hex = parseInt(decimalValue).toString(16).toUpperCase();
                document.getElementById('hexInput').value = hex;
            } else {
                document.getElementById('hexInput').value = '';
            }
        }

        // ÂçÅÂÖ≠ËøõÂà∂ËΩ¨ÂçÅËøõÂà∂ÂáΩÊï∞
        function convertHexToDec() {
            const hexValue = document.getElementById('hexInput').value;
            if (/^[0-9A-Fa-f]+$/.test(hexValue)) {
                const decimal = parseInt(hexValue, 16);
                document.getElementById('decimalInput').value = decimal;
            } else {
                document.getElementById('decimalInput').value = '';
            }
        }

        // ËÑâÂÜ≤ËÆ°ÁÆó‰∏ªÂáΩÊï∞
        function calculateActualPulses() {
            const systemPulses = parseFloat(document.getElementById('systemPulses').value);
            const systemWater = parseFloat(document.getElementById('systemWater').value);
            const actualWater = parseFloat(document.getElementById('actualWater').value);
            
            if (systemPulses > 0 && systemWater > 0 && actualWater > 0) {
                const actualPulses = (systemPulses * systemWater) / actualWater;
                document.getElementById('actualPulses').value = actualPulses.toFixed(2);
            } else {
                document.getElementById('actualPulses').value = '';
            }
        }


        // ÂèÇÊï∞Ëß£ÊûêÂáΩÊï∞ÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
        function parseParams() {
            const inputText = document.getElementById('paramInput').value;
            
            // Êñ∞Â¢ûÂÖ¨Âè∏ÂêçÁß∞ÂåπÈÖçËßÑÂàô
            const companyMatch = inputText.match(/^([\s\S]*?)\s*Ë∑ÉÈæô/);
            let processedText = inputText;
            const rawItems = [];
            const formattedItems = [];
        
            // ÊèêÂèñÂÖ¨Âè∏ÂêçÁß∞
            if (companyMatch) {
                const company = companyMatch[1].trim().replace(/\s+/g, ' ');
                rawItems.push(`ÂÖ¨Âè∏=${company}`);
                formattedItems.push(`ÂÖ¨Âè∏Ôºö${company}`);  // ‰øùÊåÅÈªëËâ≤
                processedText = processedText.replace(companyMatch[0], '');
            }
        
            // ‰ºòÂåñË∑ÉÈæôÁ±ªÂûãÂà§Êñ≠ÈÄªËæëÔºàÂú®Á¨¨214-223Ë°åÔºâ
            const yuelongTypes = [
                { pattern: 'Ë∑ÉÈæôÊñ∞ÁßÅÊúâ', value: 'Êñ∞ÁßÅÊúâ' },
                { pattern: 'Ë∑ÉÈæôÂÖ¨ÊúâÂîÆÊ∞¥Êú∫', value: 'ÂÖ¨ÊúâÂîÆÊ∞¥Êú∫' },
                { pattern: 'Ë∑ÉÈæôÊñ∞ÂÖ¨Êúâ', value: 'Êñ∞ÂÖ¨Êúâ' },
                { pattern: 'Ë∑ÉÈæôÂÖ¨Êúâ', value: 'ÂÖ¨Êúâ' },
                { pattern: 'Ë∑ÉÈæôÁßÅÊúâ', value: 'ÁßÅÊúâ' }
            ];
            
            // ‰øÆÊîπ‰∏∫‰ΩøÁî®ÂéüÂßãËæìÂÖ•ÊñáÊú¨Âà§Êñ≠
            yuelongTypes.forEach(type => {
                if (inputText.includes(type.pattern)) {
                    rawItems.push(`Ë∑ÉÈæôÁ±ªÂûã=${type.value}`);
                    formattedItems.push(`Ë∑ÉÈæôÁ±ªÂûãÔºö${type.value}`);  // ‰øùÊåÅÈªëËâ≤
                }
            });

            // ‰ºòÂåñICCIDÂåπÈÖçÔºàÁ¨¨225-231Ë°åÔºâ
            const iccidMatches = [...processedText.matchAll(/(89860[\dA-Za-z]{14,18})/g)];
            const iccids = iccidMatches.map(m => m[0]);
            
            // Âè™Â§ÑÁêÜÁ¨¨‰∏Ä‰∏™ICCID
            if (iccids.length > 0) {
                rawItems.push(`ICCIDÂºÄÂßã=${iccids[0]}`);
                formattedItems.push(`ICCIDÂºÄÂßãÔºö${iccids[0]}`);  // ‰øùÊåÅÈªëËâ≤
            }
            // ÁßªÈô§ÊâÄÊúâICCID
            iccids.forEach(iccid => {
                processedText = processedText.replace(iccid, '');
            });

            // ‰ºòÂåñÂêéÁöÑÊï∞ÈáèÊèêÂèñËßÑÂàôÔºàÊîØÊåÅ‰∏≠ÊñáÁ¨¶Âè∑Èó¥ÈöîÔºâ
            const quantityMatch = processedText.match(/(\d+)\s*Âº†(?=\D*$)/);
            if (quantityMatch) {
                rawItems.push(`Êï∞Èáè=${quantityMatch[1]}`);
                formattedItems.push(`Êï∞ÈáèÔºö${quantityMatch[1]}`);
                processedText = processedText.replace(quantityMatch[0], '');
            }
        
            // Êñ∞Â¢ûÈ¢ÑÂ§ÑÁêÜÔºöËøáÊª§"ÂÖ∂‰∏≠"Áõ∏ÂÖ≥ÂÜÖÂÆπ
            processedText = processedText.replace(/ÂÖ∂‰∏≠\D*(\d+)[\u4e00-\u9fa5]+/g, '');
        
            // Êñ∞Â¢ûÊª§ËäØÂØøÂëΩÁ±ªÂûãÂà§Êñ≠
            let filterType = 'Á©∫';
            if (/Êó∂Èó¥/.test(processedText)) {
                filterType = '0Êó∂Èó¥';
            } else if (/ÊµÅÈáè/.test(processedText)) {
                filterType = '1ÊµÅÈáè';
            }
            rawItems.push(`Êª§ËäØÂØøÂëΩÁ±ªÂûã=${filterType}`);
            formattedItems.push(`Êª§ËäØÂØøÂëΩÁ±ªÂûãÔºö${filterType}`);

            // ‰ºòÂåñÂêéÁöÑÂèÇÊï∞Ëß£ÊûêÈÄªËæëÔºàÂÖºÂÆπË∑ØÂæÑÂíåÊôÆÈÄöÂèÇÊï∞Ôºâ
            const pattern = /((?:[\u4e00-\u9fa5]+(?:\/[\u4e00-\u9fa5\/\[\]]+)*|[\u4e00-\u9fa5]+))(\d+\.?\d*)/g;
            const matches = [...processedText.matchAll(pattern)];
            
            matches.forEach(match => {
                let title = match[1]
                    .replace(/\[.*?\]/g, '')  // ÁßªÈô§Âçï‰ΩçËØ¥Êòé
                    .replace(/\/+/g, '/')     // ÂêàÂπ∂ËøûÁª≠ÊñúÊù†
                    .replace(/\/$/, '');     // ÂéªÈô§ÁªìÂ∞æÊñúÊù†
                const value = match[2];
        
                // Êñ∞Â¢û‰∏≠ÊñáÂèÇÊï∞ÂêçÁß∞ËøáÊª§
                if(title && value && !/^[\u4e00-\u9fa5]+$/.test(value)) {
                    rawItems.push(`${title}=${value}`);
                    formattedItems.push(`${title}Ôºö${value}`);
                }
            });
        
            // ÊòæÁ§∫ÁªìÊûú
            // Ê≥®ÈáäÊéâÂéüÂßãÂèÇÊï∞ÊòæÁ§∫
            // document.getElementById('rawParams').innerHTML = rawItems.join('<br>');
            
            // Ê†ºÂºèÂåñÊòæÁ§∫ÁªìÊûúÔºåÁâπÊÆäÈ°π‰øùÊåÅÈªëËâ≤ÔºåÂÖ∂‰ªñÈ°πÂÄºÊòæÁ§∫‰∏∫Á∫¢Ëâ≤
            const formattedHTML = formattedItems.map(item => {
                const [key, value] = item.split('Ôºö');
                if (key === 'ÂÖ¨Âè∏' || key === 'Ë∑ÉÈæôÁ±ªÂûã' || key === 'ICCIDÂºÄÂßã') {
                    return item;  // ‰øùÊåÅÂéüÊ†∑
                }
                return `${key}Ôºö<span style="color:red">${value}</span>`;
            }).join('<br>');
            
            document.getElementById('formattedParams').innerHTML = formattedHTML;
        }

        // ICCIDËß£ÊûêÂáΩÊï∞
        function parseIccids() {
            const inputText = document.getElementById('iccidInput').value;
            const resultArray = [];
            
            // Â§ÑÁêÜËåÉÂõ¥Ê†ºÂºèÔºöICCIDÂà∞ICCID(Êï∞ÈáèÂº†)
            const rangePattern = /(\d+[A-Za-z0-9]+)Âà∞(\d+[A-Za-z0-9]+)(?:\s*[\(Ôºà](\d+)Âº†[\)Ôºâ])?/g;
            let match;
            
            // Â§ÑÁêÜËåÉÂõ¥Ê†ºÂºè
            while ((match = rangePattern.exec(inputText)) !== null) {
                const startIccid = match[1];
                const endIccid = match[2];
                const count = match[3] ? parseInt(match[3]) : null;
                
                // ÊèêÂèñÊï∞Â≠óÈÉ®ÂàÜ
                const numericStart = extractNumericSuffix(startIccid);
                const numericEnd = extractNumericSuffix(endIccid);
                
                if (numericStart && numericEnd) {
                    const prefix = startIccid.substring(0, startIccid.length - numericStart.length);
                    const startNum = parseInt(numericStart);
                    const endNum = parseInt(numericEnd);
                    
                    // È™åËØÅËåÉÂõ¥ÊòØÂê¶‰∏éÊåáÂÆöÊï∞ÈáèÂåπÈÖç
                    const actualCount = endNum - startNum + 1;
                    if (count !== null && actualCount !== count) {
                        console.warn(`Ë≠¶ÂëäÔºöÊåáÂÆöÊï∞Èáè ${count} ‰∏éÂÆûÈôÖËåÉÂõ¥ ${actualCount} ‰∏çÂåπÈÖç`);
                    }
                    
                    // ÁîüÊàêËåÉÂõ¥ÂÜÖÁöÑÊâÄÊúâICCID
                    for (let i = startNum; i <= endNum; i++) {
                        const paddedNum = i.toString().padStart(numericStart.length, '0');
                        resultArray.push(prefix + paddedNum);
                    }
                } else {
                    console.error('Êó†Ê≥ïÊèêÂèñÊï∞Â≠óÈÉ®ÂàÜ:', startIccid, endIccid);
                }
            }
            
            // ÂêåÊó∂Â§ÑÁêÜÂçïË°åICCIDÊ†ºÂºèÔºàÊó†ËÆ∫ÊòØÂê¶Â∑≤Â§ÑÁêÜËåÉÂõ¥Ê†ºÂºèÔºâ
            // ÂàÜÂâ≤ËæìÂÖ•ÊñáÊú¨ÔºåÂ§ÑÁêÜÊØè‰∏ÄË°å
            const lines = inputText.split(/[\n\r]+/);
            
            lines.forEach(line => {
                // Ë∑≥ËøáÂåÖÂê´"Âà∞"ÁöÑË°åÔºåÂõ†‰∏∫Ëøô‰∫õË°åÂ∑≤ÁªèÂú®ËåÉÂõ¥Â§ÑÁêÜ‰∏≠Â§ÑÁêÜËøá‰∫Ü
                if (line.includes('Âà∞')) {
                    return;
                }
                
                // Ê∏ÖÁêÜÊØèË°åÔºåÁßªÈô§ÂèØËÉΩÁöÑÂºïÂè∑ÂíåÁ©∫Ê†º
                const cleanedLine = line.trim().replace(/['""`]/g, '');
                
                // Â¶ÇÊûúÊòØÊúâÊïàÁöÑICCIDÔºàËá≥Â∞ëÂåÖÂê´Êï∞Â≠óÂíåÂèØËÉΩÁöÑÂ≠óÊØçÔºåÈïøÂ∫¶Â§ß‰∫é10Ôºâ
                if (/^\d+[A-Za-z0-9]*$/.test(cleanedLine) && cleanedLine.length > 10) {
                    resultArray.push(cleanedLine);
                }
            });
            
            // ÊòæÁ§∫ÁªìÊûúÔºåÊØèË°å‰∏Ä‰∏™ICCID
            document.getElementById('iccidResult').value = resultArray.join('\n');
        }
        
        // ÊèêÂèñICCIDÊú´Â∞æÁöÑÊï∞Â≠óÈÉ®ÂàÜ
        function extractNumericSuffix(iccid) {
            const match = iccid.match(/(\d+)$/);
            return match ? match[1] : null;
        }
        
        // ‰øÆÊîπICCIDÊ†ºÂºèÂáΩÊï∞
        function formatIccids() {
            const resultText = document.getElementById('iccidResult').value;
            if (!resultText.trim()) {
                alert('ËØ∑ÂÖàËß£ÊûêICCIDÊï∞ÊçÆ');
                return;
            }
            
            // Â∞ÜÊç¢Ë°åÂàÜÈöîÁöÑICCIDËΩ¨Êç¢‰∏∫ÈÄóÂè∑ÂàÜÈöî
            const iccids = resultText.split('\n').filter(line => line.trim());
            document.getElementById('iccidResult').value = iccids.join(',');
        }
        
        // ÊÅ¢Â§çICCIDÊ†ºÂºèÂáΩÊï∞ - Âú®ÊØè‰∏™ICCIDÂêéÊ∑ªÂä†ÂçïÂºïÂè∑
        function addQuotesToIccids() {
            const resultText = document.getElementById('iccidResult').value;
            if (!resultText.trim()) {
                alert('ËØ∑ÂÖàËß£ÊûêICCIDÊï∞ÊçÆ');
                return;
            }
            
            // Â§ÑÁêÜ‰∏çÂêåÊ†ºÂºèÁöÑICCID
            let iccids;
            if (resultText.includes(',')) {
                // ÈÄóÂè∑ÂàÜÈöîÁöÑÊ†ºÂºè
                iccids = resultText.split(',').filter(item => item.trim());
                // Ê∑ªÂä†ÂçïÂºïÂè∑Âπ∂ÈáçÊñ∞Áî®ÈÄóÂè∑ËøûÊé•
                document.getElementById('iccidResult').value = iccids.map(iccid => 
                    iccid.trim().endsWith("'") ? iccid.trim() : iccid.trim() + "'"
                ).join(',');
            } else {
                // Êç¢Ë°åÂàÜÈöîÁöÑÊ†ºÂºè
                iccids = resultText.split('\n').filter(line => line.trim());
                // Ê∑ªÂä†ÂçïÂºïÂè∑Âπ∂‰øùÊåÅÊç¢Ë°åÊ†ºÂºè
                document.getElementById('iccidResult').value = iccids.map(iccid => 
                    iccid.trim().endsWith("'") ? iccid.trim() : iccid.trim() + "'"
                ).join('\n');
            }
        }

        // ÈáëÈ¢ùÊ∞¥ÈáèÊç¢ÁÆóÂáΩÊï∞
        function calculateWaterValue() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const waterVolume = parseFloat(document.getElementById('waterVolume').value) || 0;
            const mlPerCent = parseFloat(document.getElementById('pricePerMl').value) || 0;
            
            let results = [];
            
            if (amount > 0 && waterVolume > 0) {
                const calculatedMlPerCent = waterVolume / (amount * 100);
                document.getElementById('pricePerMl').value = calculatedMlPerCent.toFixed(4);
                results.push(`üßÆ 1ÂàÜÈí±ÂØπÂ∫îÔºö<span style="color:red">${calculatedMlPerCent.toFixed(4)}ÊØ´Âçá</span>`);
                results.push(`üíß ${waterVolume}ÊØ´Âçá = <span style="color:red">${amount}ÂÖÉ</span>`);
            } else if (amount > 0 && mlPerCent > 0) {
                const calculatedVolume = (amount * 100) * mlPerCent;
                document.getElementById('waterVolume').value = calculatedVolume.toFixed(2);
                results.push(`üíß Ê∞¥ÈáèÔºö<span style="color:red">${calculatedVolume.toFixed(2)}ÊØ´Âçá</span>`);
            } else if (waterVolume > 0 && mlPerCent > 0) {
                const calculatedAmount = waterVolume / mlPerCent / 100;
                document.getElementById('amount').value = calculatedAmount.toFixed(2);
                results.push(`üí∞ ÈáëÈ¢ùÔºö<span style="color:red">${calculatedAmount.toFixed(2)}ÂÖÉ</span>`);
            } else {
                results.push(`üìù ËØ∑ËæìÂÖ•‰ªªÊÑè‰∏§‰∏™ÂèÇÊï∞ËøõË°åËÆ°ÁÆó`);
            }
            
            document.getElementById('waterCalculations').innerHTML = results.join('<br>');
        }

        // Ê∞¥Âçï‰ª∑ËÆ°ÁÆóÂáΩÊï∞
        function calculateWaterPrice() {
            const waterVolume = parseFloat(document.getElementById('waterVolume2').value) || 0;
            const amount = parseFloat(document.getElementById('amount2').value) || 0;
            const pricePerLiter = parseFloat(document.getElementById('pricePerLiter').value) || 0;
            
            let results = [];
            
            if (waterVolume > 0 && amount > 0) {
                const calculatedPricePerLiter = (amount / waterVolume) * 1000;
                document.getElementById('pricePerLiter').value = calculatedPricePerLiter.toFixed(4);
                results.push(`üö∞ <strong>ËÆ°ÁÆóÁªìÊûúÔºö1ÂçáÊ∞¥Âçï‰ª∑ = <span style="color:red;font-size:18px">${calculatedPricePerLiter.toFixed(4)}ÂÖÉ/Âçá</span></strong>`);
                results.push(`üìä ËÆ°ÁÆóËøáÁ®ãÔºö${amount}ÂÖÉ √∑ ${waterVolume}ÊØ´Âçá √ó 1000 = ${calculatedPricePerLiter.toFixed(4)}ÂÖÉ/Âçá`);
            } else if (waterVolume > 0 && pricePerLiter > 0) {
                const calculatedAmount = (waterVolume / 1000) * pricePerLiter;
                document.getElementById('amount2').value = calculatedAmount.toFixed(4);
                results.push(`üí∞ <strong>Â∫î‰ªòÈáëÈ¢ùÔºö<span style="color:red;font-size:18px">${calculatedAmount.toFixed(4)}ÂÖÉ</span></strong>`);
            } else if (amount > 0 && pricePerLiter > 0) {
                const calculatedVolume = (amount / pricePerLiter) * 1000;
                document.getElementById('waterVolume2').value = calculatedVolume.toFixed(2);
                results.push(`üíß <strong>ÂèØË¥≠‰π∞Ê∞¥ÈáèÔºö<span style="color:red;font-size:18px">${calculatedVolume.toFixed(2)}ÊØ´Âçá</span></strong>`);
            } else {
                results.push(`üìù ËØ∑ËæìÂÖ•‰ªªÊÑè‰∏§‰∏™ÂèÇÊï∞ËøõË°åËÆ°ÁÆó`);
                results.push(`üí° Á§∫‰æãÔºöËæìÂÖ•787ÊØ´ÂçáÂíå0.2385ÂÖÉÔºåËá™Âä®ËÆ°ÁÆó1ÂçáÊ∞¥Âçï‰ª∑`);
            }
            
            document.getElementById('waterPriceCalculations').innerHTML = results.join('<br>');
        }

        // CSVÊñá‰ª∂Â§ÑÁêÜÁõ∏ÂÖ≥
        document.getElementById('csvFileInput').addEventListener('change', function() {
            const processButton = document.querySelector('#csv89860Tool button');
            if (this.files.length > 0) {
                processButton.disabled = false;
                document.getElementById('csvProcessStatus').textContent = `Â∑≤ÈÄâÊã©Êñá‰ª∂: ${this.files[0].name}`;
            } else {
                processButton.disabled = true;
                document.getElementById('csvProcessStatus').textContent = 'ËØ∑ÈÄâÊã©CSVÊñá‰ª∂ËøõË°åÂ§ÑÁêÜ';
            }
        });
        
        function processCSVFile() {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('csvProcessStatus').textContent = 'ËØ∑ÂÖàÈÄâÊã©CSVÊñá‰ª∂';
                return;
            }
            
            document.getElementById('csvProcessStatus').textContent = 'Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    // Âú®ÊâÄÊúâ"89860"ÂâçÊ∑ªÂä†Ëã±ÊñáÂçïÂºïÂè∑
                    const pattern = /"89860/g;
                    const modifiedContent = content.replace(pattern, '"\'89860');
                    
                    // ÁªüËÆ°Â§ÑÁêÜÁöÑÊï∞Èáè
                    const matchCount = (content.match(pattern) || []).length;
                    
                    // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                    const blob = new Blob(['\ufeff' + modifiedContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    
                    // ËÆæÁΩÆ‰∏ãËΩΩÊñá‰ª∂Âêç
                    const originalName = file.name;
                    const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.csv';
                    const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                    const downloadName = `${baseName}_processed${extension}`;
                    
                    link.setAttribute('href', url);
                    link.setAttribute('download', downloadName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    document.getElementById('csvProcessStatus').textContent = `Â§ÑÁêÜÂÆåÊàêÔºÅÂÖ±Â§ÑÁêÜ‰∫Ü ${matchCount} ‰∏™89860ÂÄºÔºåÊñá‰ª∂Â∑≤‰∏ãËΩΩ`;
                    
                    // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•ÔºåÂÖÅËÆ∏ÂÜçÊ¨°ÈÄâÊã©Âêå‰∏ÄÊñá‰ª∂
                    fileInput.value = '';
                    document.querySelector('#csv89860Tool button').disabled = true;
                } catch (error) {
                    document.getElementById('csvProcessStatus').textContent = `Â§ÑÁêÜÂ§±Ë¥•: ${error.message}`;
                }
            };
            
            reader.onerror = function() {
                document.getElementById('csvProcessStatus').textContent = 'ËØªÂèñÊñá‰ª∂Â§±Ë¥•';
            };
            
            // ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ
            reader.readAsText(file, 'utf-8');
        }
        
        // ÂçÅËøõÂà∂ËΩ¨ÂçÅÂÖ≠ËøõÂà∂ÂáΩÊï∞
        function convertDecToHex() {
            const decimalValue = document.getElementById('decimalInput').value;
            // Ê≠£ÂàôÈ™åËØÅÂçÅËøõÂà∂Ê†ºÂºè
            if (/^\d+$/.test(decimalValue)) {
                const hex = parseInt(decimalValue)
                          .toString(16)
                          .toUpperCase();
                document.getElementById('hexInput').value = hex;
            } else {
                document.getElementById('hexInput').value = '';
            }
        }
        
        // ÂçÅÂÖ≠ËøõÂà∂ËΩ¨ÂçÅËøõÂà∂ÂáΩÊï∞
        function convertHexToDec() {
            const hexValue = document.getElementById('hexInput').value;
            // Ê≠£ÂàôÈ™åËØÅÂçÅÂÖ≠ËøõÂà∂Ê†ºÂºèÔºà‰∏çÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºâ
            if (/^[0-9A-Fa-f]+$/.test(hexValue)) {
                const decimal = parseInt(hexValue, 16);
                document.getElementById('decimalInput').value = decimal;
            } else {
                document.getElementById('decimalInput').value = '';
            }
        }
        
        // ‰∫ã‰ª∂ÁªëÂÆö
        document.addEventListener('DOMContentLoaded', function() {
            // ËÑâÂÜ≤ËÆ°ÁÆóÂô®‰∫ã‰ª∂
            document.getElementById('systemPulses').addEventListener('input', calculateActualPulses);
            document.getElementById('systemWater').addEventListener('input', calculateActualPulses);
            document.getElementById('actualWater').addEventListener('input', calculateActualPulses);
            
            // ËøõÂà∂ËΩ¨Êç¢‰∫ã‰ª∂
            document.getElementById('decimalInput').addEventListener('input', convertDecToHex);
            document.getElementById('hexInput').addEventListener('input', convertHexToDec);
        
            // ÂèÇÊï∞Ëß£ÊûêÂô®ÂõûËΩ¶‰∫ã‰ª∂
            document.getElementById('paramInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    parseParams();
                    this.blur();
                }
            });

            
            // ExcelÊñá‰ª∂‰∏ä‰º†‰∫ã‰ª∂
            const fileInput = document.getElementById('excelFileInput');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    readExcelFile(file);
                } else {
                    clearExcelData();
                }
            });
            
            // Ê®°ÊùøÈÄâÊã©‰∫ã‰ª∂
            document.getElementById('templateSelect').addEventListener('change', function(e) {
                if (e.target.value === 'upload') {
                    // Ëß¶ÂèëÊ®°ÊùøÊñá‰ª∂‰∏ä‰º†
                    document.getElementById('templateFileInput').click();
                    // ÈáçÁΩÆÈÄâÊã©Ê°Ü
                    e.target.value = '';
                } else {
                    updateProcessButton();
                }
            });
            
            // ÂàùÂßãÂåñÔºöÂä†ËΩΩËøúÁ®ãÊ®°Êùø
            loadRemoteTemplate().then(() => {
                console.log('ËøúÁ®ãÊ®°ÊùøÂàùÂßãÂåñÂÆåÊàê');
                // Á°Æ‰øùÊåâÈíÆÁä∂ÊÄÅÊ≠£Á°ÆÊõ¥Êñ∞
                updateProcessButton();
            }).catch(error => {
                console.error('ËøúÁ®ãÊ®°ÊùøÂàùÂßãÂåñÂ§±Ë¥•:', error);
                // Âç≥‰ΩøÂä†ËΩΩÂ§±Ë¥•‰πüË¶ÅÊõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                updateProcessButton();
            });

            // ÈªòËÆ§ÊòæÁ§∫ExcelÊ®°ÊùøÂ§ÑÁêÜÂ∑•ÂÖ∑
            showTool('pulseTool');
        });
        


    </script>

    <!-- ‰∫åÁª¥Á†ÅÁîüÊàêÂô®Â∑•ÂÖ∑Ê®°Âùó -->
    <section id="qrGeneratorTool" class="calculator" style="display: none;">
        <h2>üî≤ ‰∫åÁª¥Á†ÅÊâπÈáèÁîüÊàêÂô®</h2>
        
        <div class="info-box">
            <strong>üìã ÂäüËÉΩËØ¥ÊòéÔºö</strong><br>
            1. ‰ΩøÁî®Á®≥ÂÆöÁöÑ‰∫åÁª¥Á†ÅAPIÔºåÊó†Ë∑®ÂüüÈôêÂà∂<br>
            2. Ëá™Âä®Âú®‰∫åÁª¥Á†Å‰∏ãÊñπÊ∑ªÂä†IMEIÊñáÂ≠óÔºåÊñáÂ≠óÂ§ßÂ∞èËá™ÈÄÇÂ∫î‰∫åÁª¥Á†ÅÂÆΩÂ∫¶<br>
            3. ËæìÂá∫‰∏∫360x360pxÊ≠£ÊñπÂΩ¢PNGÂõæÁâáÔºå‰æø‰∫éÊâìÂç∞Âíå‰ΩøÁî®<br>
            4. ÊîØÊåÅÊâπÈáèÁîüÊàêÂíåZIPÊâìÂåÖ‰∏ãËΩΩÔºåÁ®≥ÂÆöÂèØÈù†
        </div>
        
        <div class="form-group">
            <label for="qrPrefix">‰∫åÁª¥Á†ÅÂâçÁºÄÔºö</label>
            <input type="text" id="qrPrefix" placeholder="‰æãÔºöhttp://cloud.yuelongxinxi.com/qr/" value="http://cloud.yuelongxinxi.com/qr/">
        </div>
        
        <div class="form-group">
            <label for="qrImeiList">IMEIÂàóË°®Ôºà‰∏ÄË°å‰∏Ä‰∏™ÔºâÔºö</label>
            <textarea id="qrImeiList" placeholder="ËØ∑ËæìÂÖ•IMEIÔºå‰∏ÄË°å‰∏Ä‰∏™Ôºå‰æãÂ¶ÇÔºö&#10;860256072911545&#10;860256072911546&#10;860256072911547"></textarea>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" id="qrGenerateBtn">
                <span id="qrGenerateBtnText">üî≤ ÁîüÊàê‰∫åÁª¥Á†Å</span>
                <span id="qrGenerateBtnLoading" class="loading" style="display: none;"></span>
            </button>
            <button class="btn btn-success" id="qrDownloadBtn" disabled>
                üì¶ ÊâìÂåÖ‰∏ãËΩΩ (PNGÊ†ºÂºè)
            </button>
        </div>
        
        <div class="api-status" id="qrApiStatus">
            <span class="api-icon">üì°</span>
            <span id="qrApiStatusText">ÂáÜÂ§áÁîüÊàê‰∫åÁª¥Á†Å...</span>
        </div>
        
        <div class="progress-container" id="qrProgressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="qrProgressFill"></div>
            </div>
            <div class="progress-text" id="qrProgressText">ÂáÜÂ§áÁîüÊàê...</div>
        </div>
        
        <div class="error-message" id="qrErrorMessage"></div>
        <div class="success-message" id="qrSuccessMessage"></div>
        
        <div class="qr-grid" id="qrGrid"></div>
    </section>
    <!-- Êó•ÂøóËß£ÊûêÂô®Â∑•ÂÖ∑Ê®°Âùó -->
    <section id="logAnalysisTool" class="calculator" style="display: none;">
        <h2>üìä Êó•ÂøóËß£ÊûêÂô®</h2>
        
        <div style="display: flex; gap: 20px; margin-top: 20px;">
            <!-- Â∑¶‰æßÔºöÂéüÂßãÊó•ÂøóËæìÂÖ• -->
            <div style="flex: 1;">
                <div class="form-group">
                    <label for="logInput">üìù ÂéüÂßãÊó•ÂøóÊï∞ÊçÆÔºö</label>
                    <textarea id="logInput" placeholder="ËØ∑ËæìÂÖ•ÂéüÂßãÊó•ÂøóÊï∞ÊçÆÔºå‰æãÂ¶ÇÔºö&#10;&#10;116‰ΩçÊ†ºÂºèÔºö&#10;861122F20000FF550006005208E8004F003E000F00270005000A000A000A000A000A00000000000000000000005E5D86B4007B&#10;&#10;104‰ΩçÊ†ºÂºèÔºö&#10;861122F20000FF550006005208E8004F003E000F00270005000A000A000A000A000A000000000000005E5D86B4007B
üìÑÂäüËÉΩËØ¥ÊòéÔºö
1. ÊîØÊåÅ116‰ΩçÂíå104‰Ωç‰∏§ÁßçÊ†ºÂºèÁöÑÊó•ÂøóÊï∞ÊçÆËß£Êûê
2. Ëá™Âä®ËØÜÂà´ËÆæÂ§áID„ÄÅËÆ°Ë¥πÊ®°Âºè„ÄÅÊåá‰ª§Á±ªÂûãÁ≠â‰ø°ÊÅØ
3. Ëß£ÊûêËÆæÂ§áÁä∂ÊÄÅ„ÄÅÊµÅÈáè‰ø°ÊÅØ„ÄÅÊª§ËäØÂØøÂëΩÁ≠âÂèÇÊï∞
4. ÊîØÊåÅÂ§öÁßçÊåá‰ª§Á±ªÂûãÔºàÂøÉË∑≥„ÄÅÂÖÖÂÄº„ÄÅÊü•ËØ¢Á≠âÔºâ
5. ÂéüÂßãÊó•ÂøóÂíåËß£ÊûêÁªìÊûúÂπ∂ÊéíÊòæÁ§∫ÔºåÊñπ‰æøÂØπÊØî
üí° ‰ΩøÁî®ÊèêÁ§∫Ôºö
‚Ä¢ 116‰ΩçÊó•ÂøóÔºöÂÆåÊï¥Ê†ºÂºèÔºåÂåÖÂê´ÊâÄÊúâÊª§ËäØ‰ø°ÊÅØÂíåËØ¶ÁªÜÂèÇÊï∞
‚Ä¢ 104‰ΩçÊó•ÂøóÔºöÁÆÄÂåñÊ†ºÂºèÔºåÈÉ®ÂàÜÂèÇÊï∞‰ΩçÁΩÆÂíåÂÄº‰∏çÂêå
‚Ä¢ ÊîØÊåÅÊåá‰ª§ÔºöÂøÉË∑≥(00)„ÄÅÂÖÖÂÄº(05)„ÄÅÊü•ËØ¢(0D)„ÄÅÊøÄÊ¥ª(09)Á≠â40+ÁßçÊåá‰ª§
‚Ä¢ Ëß£ÊûêÂÜÖÂÆπÔºöËÆæÂ§áÁä∂ÊÄÅ„ÄÅÊµÅÈáè‰ΩôÈ¢ù„ÄÅÊª§ËäØÂØøÂëΩ„ÄÅTDSÂÄº„ÄÅÊó∂Èó¥Êà≥„ÄÅICÂç°‰ø°ÊÅØÁ≠â
‚Ä¢ Âπ∂ÊéíÊòæÁ§∫ÔºöÂ∑¶Âè≥Âπ∂ÊéíËÆæËÆ°ÔºåÂéüÂßãÊï∞ÊçÆÂíåËß£ÊûêÁªìÊûúÂØπÊØîÊòæÁ§∫Ôºå‰æø‰∫éÈ™åËØÅÂíåÂ≠¶‰π†
‚Ä¢ ÊîØÊåÅÊ†ºÂºèÔºöËá™Âä®ËøáÊª§Á©∫Ê†ºÂíåËøûÂ≠óÁ¨¶ÔºåÁÅµÊ¥ªËæìÂÖ•ÂéüÂßãÊï∞ÊçÆ
‚ö° Âø´Êç∑Êìç‰ΩúÔºöÊåâÂõûËΩ¶ÈîÆËá™Âä®ÂºÄÂßãËß£Êûê" rows="15" style="font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; resize: vertical;" onkeydown="handleLogInputKeydown(event)"></textarea>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="analyzeLog()">
                        üîç Ëß£ÊûêÊó•Âøó
                    </button>
                    <button class="btn btn-secondary" onclick="clearLogData()">
                        üóëÔ∏è Ê∏ÖÁ©∫Êï∞ÊçÆ
                    </button>
                </div>
            </div>
            
            <!-- Âè≥‰æßÔºöËß£ÊûêÁªìÊûú -->
            <div style="flex: 1;">
                <div class="form-group">
                    <label>üìä Ëß£ÊûêÁªìÊûúÔºö</label>
                    <div id="logResult" class="result-area" style="min-height: 380px; white-space: pre-wrap; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.5; overflow-y: auto; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px; background: #f8f9fa; resize: vertical;">Á≠âÂæÖËæìÂÖ•Êó•ÂøóÊï∞ÊçÆ...</div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // ===== Êó•ÂøóËß£ÊûêÂäüËÉΩ logDecode.js =====
        var replaceMsg; // ÂÖ®Â±ÄÂèòÈáèÔºåÁî®‰∫éÂ§ÑÁêÜÂêéÁöÑÊ∂àÊÅØ
        
        function analysis(msg){
            console.log(msg,'logDecode ->>> msg');
            console.log(msg.length,'msg.length');

            replaceMsg = msg.replace(/\s*/g,'').replace(/\-/g,'');

            console.log(replaceMsg,'replace ->>> replaceMsg');
            console.log(replaceMsg.length,'replaceMsg.length');

            switch(replaceMsg.length){
                case 116:{
                    var mode = parseInt(replaceMsg.substring(8,10),16);
                    var decodeList = {
                        deviceid:'ËÆæÂ§áIDÔºö'+parseInt(replaceMsg.substring(0,8),16),
                        mode:'ËÆ°Ë¥πÊ®°ÂºèÔºö' + (mode==0?'Êó∂Èïø':mode==1?'ÊµÅÈáè':mode==2?'Êª§ËäØ':mode==3?'‰π∞Êñ≠':mode==4?'Â•óÈ§ê':'ÂÖ±‰∫´'),
                        instructions:'Êåá‰ª§Ôºö' + instructions(replaceMsg.substring(10,12)),
                        deviceid_state:'ËÆæÂ§áÁä∂ÊÄÅÔºö' + deviceid_state(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(12,14),16)),
                        current_flow:current_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(14,18),16)),
                        recharge_flow:recharge_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(18,26),16),replaceMsg.substring(12,14)),
                        recharge_days:recharge_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(26,30),16)),
                        residual_flow:residual_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(30,38),16)),
                        residual_days:residual_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(38,42),16)),
                        used_flow:used_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(42,50),16)),
                        used_days:used_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(50,54),16)),
                        pure_tds:pure_tds(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(54,58),16)),
                        raw_tds:raw_tds(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(58,62),16)),
                        one_actual:one_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(62,66),16)),
                        two_actual:two_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(66,70),16)),
                        three_actual:three_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(70,74),16)),
                        four_actual:four_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(74,78),16)),
                        five_actual:five_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(78,82),16)),
                        one_maximum:one_maximum(replaceMsg.substring(10,12),replaceMsg.substring(82,86)),
                        two_maximum:two_maximum(replaceMsg.substring(10,12),replaceMsg.substring(86,90)),
                        three_maximum:three_maximum(replaceMsg.substring(10,12),replaceMsg.substring(90,94)),
                        four_maximum:four_maximum(replaceMsg.substring(10,12),replaceMsg.substring(94,98)),
                        five_maximum:five_maximum(replaceMsg.substring(10,12),replaceMsg.substring(98,102)),
                        time:time(parseInt(replaceMsg.substring(102,110),16)),
                        tap:tap(parseInt(replaceMsg.substring(110,112),16)),
                    };
                    return decodeList;
                }
                case 104:{
                    var mode = parseInt(replaceMsg.substring(8,10),16);
                    var decodeList = {
                        deviceid:'ËÆæÂ§áIDÔºö'+parseInt(replaceMsg.substring(0,8),16),
                        mode:'ËÆ°Ë¥πÊ®°ÂºèÔºö' + (mode==0?'Êó∂Èïø':mode==1?'ÊµÅÈáè':mode==2?'Êª§ËäØ':mode==3?'‰π∞Êñ≠':mode==4?'Â•óÈ§ê':'ÂÖ±‰∫´'),
                        instructions:'Êåá‰ª§Ôºö' + instructions(replaceMsg.substring(10,12)),
                        deviceid_state:'ËÆæÂ§áÁä∂ÊÄÅÔºö' + deviceid_state(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(12,14),16)),
                        current_flow:current_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(14,18),16)),
                        recharge_flow:recharge_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(18,22),16),replaceMsg.substring(12,14)),
                        recharge_days:recharge_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(22,26),16)),
                        residual_flow:residual_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(26,30),16)),
                        residual_days:residual_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(30,34),16)),
                        used_flow:used_flow(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(34,38),16)),
                        used_days:used_days(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(38,42),16)),
                        pure_tds:pure_tds(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(42,46),16)),
                        raw_tds:raw_tds(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(46,50),16)),
                        one_actual:one_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(50,54),16)),
                        two_actual:two_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(54,58),16)),
                        three_actual:three_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(58,62),16)),
                        four_actual:four_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(62,66),16)),
                        five_actual:five_actual(replaceMsg.substring(10,12),parseInt(replaceMsg.substring(66,70),16)),
                        one_maximum:one_maximum(replaceMsg.substring(10,12),replaceMsg.substring(70,74)),
                        two_maximum:two_maximum(replaceMsg.substring(10,12),replaceMsg.substring(74,78)),
                        three_maximum:three_maximum(replaceMsg.substring(10,12),replaceMsg.substring(78,82)),
                        four_maximum:four_maximum(replaceMsg.substring(10,12),replaceMsg.substring(82,86)),
                        five_maximum:five_maximum(replaceMsg.substring(10,12),replaceMsg.substring(86,90)),
                        time:time(parseInt(replaceMsg.substring(90,98),16)),
                        tap:tap(parseInt(replaceMsg.substring(98,100),16)),
                    };
                    return decodeList;
                }
                default:{
                    return { error: 'Êï∞ÊçÆÊ†ºÂºèÊöÇ‰∏çÊîØÊåÅËß£ÊûêÔºàÈïøÂ∫¶: ' + replaceMsg.length + 'Ôºâ' };
                }
            }
        }
        
        function instructions(string){
            switch(string.toLowerCase()){
                case '00':{return 'ÂøÉË∑≥Êï∞ÊçÆ';}
                case '01':{return 'ÂÖ≥Êú∫ÂëΩ‰ª§';}
                case '11':{return 'ÂÖ≥Êú∫ÂëΩ‰ª§ÂõûÊâß';}
                case '02':{return 'ÂºÄÊú∫ÂëΩ‰ª§';}
                case '22':{return 'ÂºÄÊú∫ÂëΩ‰ª§ÂõûÊâß';}
                case '03':{return 'Âº∫ÂÜ≤ÂëΩ‰ª§';}
                case '33':{return 'Âº∫ÂÜ≤ÂëΩ‰ª§ÂõûÊâß';}
                case '04':{return 'IDÁºñÁ†Å/ËÆæÁΩÆÊú∫Âô®ÂèÇÊï∞';}
                case '44':{return 'IDÁºñÁ†ÅÂõûÊâß';}
                case '05':{return 'ÂÖÖÂÄºÂëΩ‰ª§';}
                case '55':{return 'ÂÖÖÂÄºÂëΩ‰ª§ÂõûÊâß';}
                case '06':{return 'Áî®Ê∞¥ÂêåÊ≠•ÂëΩ‰ª§';}
                case '07':{return 'Êª§ËäØÂ§ç‰Ωç';}
                case '77':{return 'Êª§ËäØÂ§ç‰ΩçÂõûÊâß';}
                case '08':{return 'Ê®°ÂºèÂàáÊç¢';}
                case '88':{return 'Ê®°ÂºèÂàáÊç¢ÂõûÊâß';}
                case '09':{return 'ÊøÄÊ¥ª';}
                case '99':{return 'ÊøÄÊ¥ªÂõûÊâß';}
                case '0a':{return 'ÊÅ¢Â§çÂá∫ÂéÇËÆæÁΩÆ';}
                case 'aa':{return 'ÊÅ¢Â§çÂá∫ÂéÇËÆæÁΩÆÂõûÊâß';}
                case '0b':{return 'Áî®Êó∂ÂêåÊ≠•';}
                case 'bb':{return 'Áî®Êó∂ÂêåÊ≠•ÂõûÊâß';}
                case '0c':{return 'ËÆæÂ§áÁä∂ÊÄÅÂèòÊõ¥';}
                case '0d':{return 'Êü•ËØ¢ËÆæÂ§á‰ø°ÊÅØ';}
                case 'dd':{return 'Êü•ËØ¢ËÆæÂ§á‰ø°ÊÅØÂõûÊâß';}
                case '0e':{return 'Ëé∑Âèñ‰ø°Âè∑ÔºåICCIDÔºåÊú∫Âô®ÈÖçÁΩÆÂèÇÊï∞';}
                case 'ee':{return 'Ëé∑ÂèñËÆæÂ§á‰ø°ÊÅØÂõûÊâß';}
                case '0f':{return 'Êú∫Âô®ÈîÅÂÆöËß£ÈîÅÂëΩ‰ª§';}
                case 'ff':{return 'Êú∫Âô®ÈîÅÂÆöËß£ÈîÅÂõûÊâß';}
                case '80':{return 'Êú∫Âô®ÂèñÊ∞¥Êåá‰ª§';}
                case '90':{return 'Êú∫Âô®ÂèñÊ∞¥Êåá‰ª§ÂõûÊâß';}
                case 'cc':{return 'ÈîôËØØÂåÖ‰∏äÊä•';}
                case 'a0':{return 'IcÂç°ËØÜÂà´ËØ∑Ê±ÇÊåá‰ª§';}
                case 'b0':{return 'IcÂç°‰ΩôÈ¢ùÂêåÊ≠•Êåá‰ª§/Âç°Áä∂ÊÄÅÂàáÊç¢';}
                case 'b1':{return 'IcÂç°‰ΩôÈ¢ùÂêåÊ≠•Êåá‰ª§ÂõûÊâß';}
                case '2b':{return 'ÂπøÂëäÊú∫Âà∑Êñ∞ÂπøÂëäÊåá‰ª§';}
                case 'b2':{return 'ÂπøÂëäÊú∫Âà∑Êñ∞ÂπøÂëäÂõûÊâßÊåá‰ª§';}
                case '2a':{return 'ÂπøÂëäÊú∫‰∏ãËΩΩÊó•ÂøóÊåá‰ª§';}
                default:{
                    return 'ÊöÇÊú™Ëß£ÊûêËØ•Êåá‰ª§';
                }
            }
        }
        
        // ÁÆÄÂåñÁöÑËæÖÂä©ÂáΩÊï∞Ôºà‰∏ªË¶ÅÂäüËÉΩÔºâ
        function deviceid_state(string, number) {
            const states = {
                0: 'Âá∫ÂéÇ', 1: 'Ê≠£Â∏∏', 2: 'Ê¨†Ë¥π', 3: 'Âà∂Ê∞¥ÊïÖÈöú', 4: 'ÂÖ≥Êú∫', 5: 'ÊºèÊ∞¥',
                6: 'ÂæÖÊøÄÊ¥ª', 7: 'Ë°•ËÆ°', 8: 'È¢ëÂèëÊï∞ÊçÆ', 9: 'Âà∂Ê∞¥', 10: 'ÂÜ≤Ê¥ó',
                11: 'Áº∫Ê∞¥', 12: 'ÈîÅÂÆö', 14: 'Êú¨Ê¨°Ê∂àË¥πÁ∫ØÊ∞¥Ê∫¢Âá∫'
            };
            return states[number] || 'ÊöÇÊú™Ëß£ÊûêËØ•Áä∂ÊÄÅ';
        }
        
        // ÂÖ∂‰ªñËæÖÂä©ÂáΩÊï∞ÁöÑÂÆåÊï¥ÂÆûÁé∞
        function current_flow(string, number) {
            switch(string.toLowerCase()) {
                case '84': return 'Ëá™Âä®Ê†°ÂáÜÁöÑÊµÅÈáèÔºö' + number;
                case '80': return '';
                case '06': return 'Êú¨Ê¨°Ê∂àË¥πÊÄªÊµÅÈáèÔºö' + number + ' ml';
                case '0c': return 'Êú¨Ê¨°Ê∂àË¥πÊÄªÊµÅÈáèÔºö' + number + ' ml';
                case 'dd': return 'Êú¨Ê¨°Ê∂àË¥πÊÄªÊµÅÈáèÔºö' + number + ' ml';
                default: return '';
            }
        }
        
        function recharge_flow(string, number, device_state) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂÜ∑Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤Ôºö' + number;
                case '44': return 'ÂÜ∑Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤ÂõûÊâßÔºö' + number;
                case 'ee': return 'ÂÜ∑Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤Ôºö' + number;
                case '80': return 'Êú¨Ê¨°ÂÖÅËÆ∏ÊúÄÂ§ßÂèñÊ∞¥ÈáèÔºö' + number + ' ml';
                case '90': return 'Êú¨Ê¨°ÂÖÅËÆ∏ÊúÄÂ§ßÂèñÊ∞¥Èáè ÂõûÊâßÔºö' + number + ' ml';
                case '06': return 'Êú¨Ê¨°Âá∫ÁÉ≠Ê∞¥Ê∞¥ÈáèÔºö' + number + ' ml';
                case 'a0': return '';
                case '0c': return device_state == 1 ? ('ÊµÅÈÄüÔºö' + number + ' ml/ÂàÜ') : '';
                case '05': return 'ÂÖÖÂÄºÊµÅÈáèÔºö' + number + ' L';
                case '55': return 'Ââ©‰ΩôÊµÅÈáè ÂõûÊâßÔºö' + number + ' L';
                case '82': return 'ËäÇËÉΩÁöÑÊó∂Èó¥:' + number;
                case '92': return 'ËäÇËÉΩÁöÑÊó∂Èó¥ ÂõûÊâß:' + number;
                case '83': return 'ÂπøÂëäÁÅØÂºÄÂêØÊó∂Èó¥:' + number;
                case '93': return 'ÂπøÂëäÁÅØÂºÄÂêØÊó∂Èó¥: ÂõûÊâß' + number;
                case '5E': return 'Ëá™Âä®Ê†°ÂáÜÁöÑÂÜ∑Ê∞¥ÊµÅÈáèËÆ°:' + number;
                default: return '';
            }
        }
        
        function recharge_days(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂÜ∑Ê∞¥ÈòÄÊó∂Èó¥Ôºö' + number + 'Áßí/L';
                case '44': return 'ÂÜ∑Ê∞¥ÈòÄÊó∂Èó¥ ÂõûÊâßÔºö' + number + 'Áßí/L';
                case '80': return 'Êú¨Ê¨°ÂèñÊ∞¥Á≠âÂæÖÊó∂Èó¥Ôºö' + number + ' Áßí';
                case '90': return 'Êú¨Ê¨°ÂèñÊ∞¥Á≠âÂæÖÊó∂Èó¥ ÂõûÊâßÔºö' + number + ' Áßí';
                case '06': return 'Êú¨Ê¨°Âá∫ÂÜ∑Ê∞¥Ê∞¥ÈáèÔºö' + number + ' ml';
                case '05': return 'ÂÖÖÂÄºÂ§©Êï∞Ôºö' + number + ' Â§©';
                case '55': return 'Ââ©‰ΩôÂ§©Êï∞ ÂõûÊâßÔºö' + number + ' Â§©';
                case '82': return 'Âä†ÁÉ≠Á≥ªÁªüÂêØÂÅúÊ∏©Â∑ÆÔºö' + number;
                case '92': return 'Âä†ÁÉ≠Á≥ªÁªüÂêØÂÅúÊ∏©Â∑Æ ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        function residual_flow(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'Âà∂Ê∞¥Êó∂Èó¥Ôºö' + number + "ÂàÜÈíü/L";
                case '44': return 'Âà∂Ê∞¥Êó∂Èó¥ ÂõûÊâßÔºö' + number + "ÂàÜÈíü/L";
                case '80': return 'ËøûÁª≠Âá∫Ê∞¥ÊúÄÂ§ßÊó∂Èó¥Ôºö' + number;
                case '90': return 'ËøûÁª≠Âá∫Ê∞¥ÊúÄÂ§ßÊó∂Èó¥ ÂõûÊâßÔºö' + number;
                case '06': return 'Êú¨Ê¨°Ê∂àË¥πÈáëÈ¢ùÔºö' + number/100 + 'ÂÖÉ';
                case '55': return 'Ââ©‰ΩôÊµÅÈáèÔºö' + number + ' L';
                case '0c': return 'Ââ©‰ΩôÊµÅÈáèÔºö' + number + ' L';
                case 'dd': return 'Ââ©‰ΩôÊµÅÈáèÔºö' + number + ' L';
                case '09': return 'Ââ©‰ΩôÊµÅÈáèÔºö' + number + ' L';
                case '99': return 'Ââ©‰ΩôÊµÅÈáè ÂõûÊâßÔºö' + number + ' L';
                case '82': return 'Êµ¥Èú∏1ÂêØÂä®ÁöÑÊ∏©Â∫¶Ôºö' + number;
                case '92': return 'Êµ¥Èú∏1ÂêØÂä®ÁöÑÊ∏©Â∫¶ ÂõûÊâß:' + number;
                case 'a0': return 'Á¶ªÁ∫øÊ∂àË¥πÈáëÈ¢ùÔºö' + number/100 + 'ÂÖÉ';
                default: return '';
            }
        }
        
        function residual_days(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'Ê£Ä‰øÆÊó∂Èó¥Ôºö' + number;
                case '44': return 'Ê£Ä‰øÆÊó∂Èó¥ ÂõûÊâßÔºö' + number;
                case '80': return 'ÂèñÊ∞¥ÊöÇÂÅúÊó∂Èó¥Ôºö' + number;
                case '90': return 'ÂèñÊ∞¥ÊöÇÂÅúÊó∂Èó¥ ÂõûÊâßÔºö' + number;
                case '06': return '';
                case 'ee': return 'Ê£Ä‰øÆÊó∂Èó¥Ôºö' + number;
                case '55': return 'Ââ©‰ΩôÊó∂Èó¥Ôºö' + number + ' Â§©';
                case '0b': return 'Ââ©‰ΩôÊó∂Èó¥Ôºö' + number + ' Â§©';
                case 'bb': return 'Ââ©‰ΩôÊó∂Èó¥ ÂõûÊâßÔºö' + number + ' Â§©';
                case '09': return 'Ââ©‰ΩôÊó∂Èó¥Ôºö' + number + ' Â§©';
                case 'dd': return 'Ââ©‰ΩôÊó∂Èó¥Ôºö' + number + ' Â§©';
                case '99': return 'Ââ©‰ΩôÊó∂Èó¥ ÂõûÊâßÔºö' + number + ' Â§©';
                case '82': return 'Êµ¥Èú∏2ÂêØÂä®ÁöÑÊ∏©Â∫¶Ôºö' + number;
                case '92': return 'Êµ¥Èú∏2ÂêØÂä®ÁöÑÊ∏©Â∫¶ ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        function used_flow(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'Âä†ÁÉ≠ÊúÄÈ´òÊ∏©Â∫¶ÂÄºÔºö' + number;
                case '44': return 'Âä†ÁÉ≠ÊúÄÈ´òÊ∏©Â∫¶ÂÄº ÂõûÊâßÔºö' + number;
                case '80': return 'Âá∫Ê∞¥ÁÉ≠Ê∞¥Ê∏©Â∫¶ÂÄºÔºö' + number;
                case '90': return 'Âá∫Ê∞¥ÁÉ≠Ê∞¥Ê∏©Â∫¶ÂÄº ÂõûÊâßÔºö' + number;
                case '06': return 'Â∑≤Áî®ÊµÅÈáèÔºö' + number + ' L';
                case '09': return 'Â∑≤Áî®ÊµÅÈáèÔºö' + number + ' L';
                case '99': return 'Â∑≤Áî®ÊµÅÈáèÔºö ÂõûÊâßÔºö' + number + ' L';
                case '0c': return 'Â∑≤Áî®ÊµÅÈáèÔºö' + number + ' L';
                case 'dd': return 'Â∑≤Áî®ÊµÅÈáèÔºö' + number + ' L';
                case '82': return 'Êµ¥Èú∏1ÂÖ≥Èó≠ÁöÑÊ∏©Â∫¶Â∑ÆÔºö' + number;
                case '92': return 'Êµ¥Èú∏1ÂÖ≥Èó≠ÁöÑÊ∏©Â∫¶Â∑Æ ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        function used_days(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ËÆæÂ§áÂà∂ÂÜ∑ÊúÄ‰ΩéÊ∏©Â∫¶ÂÄºÔºö' + number;
                case '44': return 'ËÆæÂ§áÂà∂ÂÜ∑ÊúÄ‰ΩéÊ∏©Â∫¶ÂÄº ÂõûÊâßÔºö' + number;
                case '80': return '';
                case '06': return '';
                case '09': return 'Â∑≤Áî®Â§©Êï∞Ôºö' + number;
                case '99': return 'Â∑≤Áî®Â§©Êï∞ ÂõûÊâßÔºö' + number;
                case '0b': return 'Â∑≤Áî®Â§©Êï∞Ôºö' + number;
                case 'bb': return 'Â∑≤Áî®Â§©Êï∞ ÂõûÊâßÔºö' + number;
                case '82': return 'Êµ¥Èú∏2ÂÖ≥Èó≠ÁöÑÊ∏©Â∫¶Â∑ÆÔºö' + number;
                case '92': return 'Êµ¥Èú∏2ÂÖ≥Èó≠ÁöÑÊ∏©Â∫¶Â∑Æ ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        function pure_tds(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÁÉ≠Ê∞¥Ë¥πÁéáÔºö' + number*10 + 'Âçá/ÂÖÉ';
                case '44': return 'ÁÉ≠Ê∞¥Ë¥πÁéá ÂõûÊâßÔºö' + number*10 + 'Âçá/ÂÖÉ';
                case '80': return '';
                case '06': return '';
                case '0c': return 'Á∫ØÊ∞¥tdsÔºö' + number;
                case 'dd': return 'Á∫ØÊ∞¥tdsÔºö' + number;
                default: return '';
            }
        }
        
        function raw_tds(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂÜ∑Ê∞¥Ë¥πÁéáÔºö' + number*10 + 'Âçá/ÂÖÉ';
                case '44': return 'ÂÜ∑Ê∞¥Ë¥πÁéá ÂõûÊâßÔºö' + number*10 + 'Âçá/ÂÖÉ';
                case '80': return '';
                case '06': return '';
                case '0c': return 'ÂéüÊ∞¥tdsÔºö' + number;
                case 'dd': return 'ÂéüÊ∞¥tdsÔºö' + number;
                default: return '';
            }
        }
        
        function one_actual(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'Â±èËîΩÊ∞¥Ë∑ØÔºö' + number;
                case '44': return 'Â±èËîΩÊ∞¥Ë∑Ø ÂõûÊâßÔºö' + number;
                case '80': return '';
                case '06': return '';
                case 'a0': return '';
                case '07': return 'Êª§ËäØ1ÂÆûÊó∂Ôºö' + number;
                case '77': return 'Êª§ËäØ1ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '0c': return 'Êª§ËäØ1ÂÆûÊó∂Ôºö' + number;
                case 'dd': return 'Êª§ËäØ1ÂÆûÊó∂Ôºö' + number;
                case '09': return 'Êª§ËäØ1ÂÆûÊó∂Ôºö' + number;
                case '99': return 'Êª§ËäØ1ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '82': return 'Ëá≠Ê∞ßÂ∑•‰ΩúÂë®ÊúüÔºö' + number;
                case '92': return 'Ëá≠Ê∞ßÂ∑•‰ΩúÂë®ÊúüÔºö ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        function two_actual(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂçïÊ¨°ÊúÄÂ§ßÁî®Èáè:' + number + "/ml";
                case '44': return 'ÂçïÊ¨°ÊúÄÂ§ßÁî®Èáè ÂõûÊâß:' + number + "/ml";
                case '80': return 'Ââ©‰ΩôÈáëÈ¢ùÔºö' + parseInt(replaceMsg.length == 116 ? replaceMsg.substring(62,70) : replaceMsg.substring(50,58), 16)/100 + '/ÂÖÉ';
                case '90': return 'Ââ©‰ΩôÈáëÈ¢ù ÂõûÊâßÔºö' + parseInt(replaceMsg.length == 116 ? replaceMsg.substring(62,70) : replaceMsg.substring(50,58), 16)/100 + '/ÂÖÉ';
                case '06': return 'Ââ©‰ΩôÈáëÈ¢ùÔºö' + parseInt(replaceMsg.length == 116 ? replaceMsg.substring(62,70) : replaceMsg.substring(50,58), 16)/100 + '/ÂÖÉ';
                case 'a0': return 'Ââ©‰ΩôÈáëÈ¢ùÔºö' + parseInt(replaceMsg.length == 116 ? replaceMsg.substring(62,70) : replaceMsg.substring(50,58), 16)/100 + '/ÂÖÉ';
                case '07': return 'Êª§ËäØ2ÂÆûÊó∂Ôºö' + number;
                case '77': return 'Êª§ËäØ2ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '0c': return 'Êª§ËäØ2ÂÆûÊó∂Ôºö' + number;
                case 'dd': return 'Êª§ËäØ2ÂÆûÊó∂Ôºö' + number;
                case '09': return 'Êª§ËäØ2ÂÆûÊó∂' + number;
                case '99': return 'Êª§ËäØ2ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '82': return 'Ëá≠Ê∞ßÂ∑•‰ΩúÂë®ÊúüÂÜÖÁöÑÂêØÂä®Êó∂Èó¥Ôºö' + number;
                case '92': return 'Ëá≠Ê∞ßÂ∑•‰ΩúÂë®ÊúüÂÜÖÁöÑÂêØÂä®Êó∂Èó¥Ôºö ÂõûÊâß:' + number;
                default: return '';
            }
        }
        
        // Ê∑ªÂä†Ââ©‰ΩôÁöÑÂÆåÊï¥ÂáΩÊï∞
        function three_actual(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÁÉ≠Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤Êï∞Ôºö' + number;
                case '44': return 'ÁÉ≠Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤Êï∞ ÂõûÊâßÔºö' + number;
                case 'ee': return 'ÁÉ≠Ê∞¥ÊµÅÈáèËÆ°ËÑâÂÜ≤Êï∞Ôºö' + number;
                case '80': return '';
                case '06': return '';
                case '07': return 'Êª§ËäØ3ÂÆûÊó∂Ôºö' + number;
                case '77': return 'Êª§ËäØ3ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '0c': return 'Êª§ËäØ3ÂÆûÊó∂Ôºö' + number;
                case 'dd': return 'Êª§ËäØ3ÂÆûÊó∂Ôºö' + number;
                case '09': return 'Êª§ËäØ3ÂÆûÊó∂Ôºö' + number;
                case '99': return 'Êª§ËäØ3ÂÆûÊó∂Ôºö ÂõûÊâßÔºö' + number;
                default: return '';
            }
        }
        
        function four_actual(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÁÉ≠Ê∞¥Ë¥πÁéáÈáëÈ¢ùÔºö' + number + 'ÂàÜ';
                case '44': return 'ÁÉ≠Ê∞¥Ë¥πÁéáÈáëÈ¢ù(Êñ∞)Ôºö' + number + 'ÂàÜ';
                case '80': return '';
                case '06': return '';
                case '07': return 'Êª§ËäØ4ÂÆûÊó∂Ôºö' + number;
                case '77': return 'Êª§ËäØ4ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '0c': return 'Êª§ËäØ4ÂÆûÊó∂Ôºö' + number;
                case 'dd': return 'Êª§ËäØ4ÂÆûÊó∂Ôºö' + number;
                case '09': return 'Êª§ËäØ4ÂÆûÊó∂' + number;
                case '99': return 'Êª§ËäØ4ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                default: return '';
            }
        }
        
        function five_actual(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÁÉ≠Ê∞¥Ë¥πÁéáÊµÅÈáèÔºö' + number + 'ml';
                case '44': return 'ÁÉ≠Ê∞¥Ë¥πÁéáÊµÅÈáè(Êñ∞)Ôºö' + number + 'ml';
                case '80': return '';
                case '06': return '';
                case 'ee': return 'ÂΩìÂâç‰ø°Âè∑ÂÄº ÂõûÊâßÔºö' + number;
                case '07': return 'Êª§ËäØ5ÂÆûÊó∂Ôºö' + number;
                case '77': return 'Êª§ËäØ5ÂÆûÊó∂ ÂõûÊâßÔºö' + number;
                case '0c': return 'Êª§ËäØ5ÂÆûÊó∂Ôºö' + number;
                case 'dd': return 'Êª§ËäØ5ÂÆûÊó∂Ôºö' + number;
                case '09': return 'Êª§ËäØ5ÂÆûÊó∂Ôºö' + number;
                case '99': return 'Êª§ËäØ5ÂÆûÊó∂Ôºö ÂõûÊâßÔºö' + number;
                default: return '';
            }
        }
        
        function one_maximum(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'iccidÔºö' + number + 'ÔºàÊúÄÂ§ßÊîæÊ∞¥Êó∂Èó¥Ôºö' + parseInt(number,16) + 'Ôºâ';
                case '44': return 'iccidÔºö' + number + 'ÔºàÊúÄÂ§ßÊîæÊ∞¥Êó∂Èó¥ ÂõûÊâßÔºö' + parseInt(number,16) + 'Ôºâ';
                case '80': return '';
                case '06': return '';
                case 'a0': return '';
                case '07': return 'Êª§ËäØ1ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '77': return 'Êª§ËäØ1ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                case '09': return 'Êª§ËäØ1ÊúÄÂ§ß' + parseInt(number,16);
                case '99': return 'Êª§ËäØ1ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                default: return '';
            }
        }
        
        function two_maximum(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'iccidÔºö' + number + '(ÁÉ≠Ê∞¥ÈòÄÊó∂Èó¥:' + parseInt(number,16) + 'Áßí/LÔºâ';
                case '44': return 'iccidÔºö' + number + '(ÁÉ≠Ê∞¥ÈòÄÊó∂Èó¥ ÂõûÊâß:' + parseInt(number,16) + 'Áßí/LÔºâ';
                case '80': return 'ICÂç°Âè∑Ôºö' + (replaceMsg.length == 116 ? replaceMsg.substring(82,90) : replaceMsg.substring(70,78));
                case '90': return 'ICÂç°Âè∑ ÂõûÊâßÔºö' + (replaceMsg.length == 116 ? replaceMsg.substring(82,90) : replaceMsg.substring(70,78));
                case '06': return 'ICÂç°Âè∑Ôºö' + (replaceMsg.length == 116 ? replaceMsg.substring(82,90) : replaceMsg.substring(70,78));
                case 'a0': return 'ICÂç°Âè∑Ôºö' + (replaceMsg.length == 116 ? replaceMsg.substring(82,90) : replaceMsg.substring(70,78));
                case '07': return 'Êª§ËäØ2ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '77': return 'Êª§ËäØ2ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                case '09': return 'Êª§ËäØ2ÊúÄÂ§ß' + parseInt(number,16);
                case '99': return 'Êª§ËäØ2ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                default: return '';
            }
        }
        
        function three_maximum(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂÜ∑Ê∞¥Ë¥πÁéáÈáëÈ¢ù(Êñ∞)Ôºö' + parseInt(number,16) + 'ÂàÜ';
                case '44': return 'ÂÜ∑Ê∞¥Ë¥πÁéáÈáëÈ¢ù(Êñ∞)Ôºö' + parseInt(number,16) + 'ÂàÜ';
                case '80': return 'Ââ©‰ΩôÊµÅÈáèÔºö' + number;
                case '90': return 'Ââ©‰ΩôÊµÅÈáè ÂõûÊâßÔºö' + number;
                case '06': return '';
                case '07': return 'Êª§ËäØ3ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '77': return 'Êª§ËäØ3ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                case '09': return 'Êª§ËäØ3ÊúÄÂ§ß' + parseInt(number,16);
                case '99': return 'Êª§ËäØ3ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                default: return '';
            }
        }
        
        function four_maximum(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'iccidÔºö' + number;
                case '44': return '';
                case '80': return 'Ââ©‰ΩôÂ§©Êï∞Ôºö' + number;
                case '90': return 'Ââ©‰ΩôÂ§©Êï∞ ÂõûÊâßÔºö' + number;
                case '06': return '';
                case '07': return 'Êª§ËäØ4ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '77': return 'Êª§ËäØ4ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                case '09': return 'Êª§ËäØ4ÊúÄÂ§ß' + parseInt(number,16);
                case '99': return 'Êª§ËäØ4ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                default: return '';
            }
        }
        
        function five_maximum(string, number) {
            switch(string.toLowerCase()) {
                case '04': return 'ÂÜ∑Ê∞¥Ë¥πÁéáÊµÅÈáè(Êñ∞)Ôºö' + parseInt(number,16) + 'ml';
                case '44': return 'ÂÜ∑Ê∞¥Ë¥πÁéáÊµÅÈáè(Êñ∞)Ôºö' + parseInt(number,16) + 'ml';
                case '80': return '';
                case '06': return '';
                case 'ee': return 'ICCID Âè∑:' + (replaceMsg.length == 116 ? replaceMsg.substring(82,102) : replaceMsg.substring(70,90));
                case '07': return 'Êª§ËäØ5ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '77': return 'Êª§ËäØ5ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                case '09': return 'Êª§ËäØ5ÊúÄÂ§ßÔºö' + parseInt(number,16);
                case '99': return 'Êª§ËäØ5ÊúÄÂ§ß ÂõûÊâßÔºö' + parseInt(number,16);
                default: return '';
            }
        }

        function four_actual(s, n) { return ['07','77','0c','dd','09','99'].includes(s) ? 'Êª§ËäØ4ÂÆûÊó∂Ôºö' + n : ''; }
        function five_actual(s, n) { return s === 'ee' ? 'ÂΩìÂâç‰ø°Âè∑ÂÄº ÂõûÊâßÔºö' + n : ['07','77','0c','dd','09','99'].includes(s) ? 'Êª§ËäØ5ÂÆûÊó∂Ôºö' + n : ''; }
        function one_maximum(s, n) { return ['07','77','09','99'].includes(s) ? 'Êª§ËäØ1ÊúÄÂ§ßÔºö' + parseInt(n, 16) : ''; }
        function two_maximum(s, n) {
            if (['80','90','06','a0'].includes(s)) {
                const pos = replaceMsg.length == 116 ? [82,90] : [70,78];
                return 'ICÂç°Âè∑Ôºö' + replaceMsg.substring(pos[0], pos[1]);
            }
            return ['07','77','09','99'].includes(s) ? 'Êª§ËäØ2ÊúÄÂ§ßÔºö' + parseInt(n, 16) : '';
        }
        function three_maximum(s, n) { return ['07','77','09','99'].includes(s) ? 'Êª§ËäØ3ÊúÄÂ§ßÔºö' + parseInt(n, 16) : ''; }
        function four_maximum(s, n) { return ['07','77','09','99'].includes(s) ? 'Êª§ËäØ4ÊúÄÂ§ßÔºö' + parseInt(n, 16) : ''; }
        function five_maximum(s, n) {
            if (s === 'ee') {
                const pos = replaceMsg.length == 116 ? [82,102] : [70,90];
                return 'ICCID Âè∑:' + replaceMsg.substring(pos[0], pos[1]);
            }
            return ['07','77','09','99'].includes(s) ? 'Êª§ËäØ5ÊúÄÂ§ßÔºö' + parseInt(n, 16) : '';
        }
        function time(n) { return 'Âåó‰∫¨Êó∂Èó¥Ôºö' + new Date(n * 1000).toLocaleString(); }
        function tap(n) { 
            const types = ['ÂÆ∂Áî®Êú∫ÔºåÂïÜÂä°Êú∫', 'Âè∞Èù¢Êú∫', 'ÁÆ°Á∫øÊú∫', 'ÂîÆÊ∞¥Êú∫ÔºåÊ†°Âõ≠Êú∫ÔºåÂåªÈô¢Êú∫'];
            return 'Êú∫Âô®Á±ªÂûãÔºö' + (types[n] || '');
        }
        
        // Êó•ÂøóËß£ÊûêÁïåÈù¢ÂäüËÉΩ
        function analyzeLog() {
            const logInput = document.getElementById('logInput').value.trim();
            const logResult = document.getElementById('logResult');
            
            if (!logInput) {
                logResult.textContent = 'ËØ∑ËæìÂÖ•Êó•ÂøóÊï∞ÊçÆ';
                return;
            }
            
            try {
                console.log('ÂºÄÂßãËß£ÊûêÊó•Âøó:', logInput); // Ë∞ÉËØï‰ø°ÊÅØ
                
                const result = analysis(logInput);
                
                if (result && result.error) {
                    logResult.textContent = 'Ëß£ÊûêÂ§±Ë¥•Ôºö' + result.error;
                    return;
                }
                
                if (result) {
                    let output = 'üìä Êó•ÂøóËß£ÊûêÁªìÊûúÔºö\n';
                    output += '‚ïê'.repeat(50) + '\n\n';
                    
                    // Ê†ºÂºèÂåñËæìÂá∫ÁªìÊûú
                    for (const [key, value] of Object.entries(result)) {
                        if (value && value.toString().trim()) {
                            output += `${value}\n`;
                        }
                    }
                    
                    output += '\n' + '‚ïê'.repeat(50);
                    output += '\nËß£ÊûêÂÆåÊàê ‚úì';
                    
                    logResult.textContent = output;
                    console.log('Ëß£ÊûêÊàêÂäü:', result); // Ë∞ÉËØï‰ø°ÊÅØ
                } else {
                    logResult.textContent = 'Ëß£ÊûêÂ§±Ë¥•ÔºöÊó†Ê≥ïËØÜÂà´ÁöÑÊï∞ÊçÆÊ†ºÂºè';
                }
            } catch (error) {
                logResult.textContent = 'Ëß£ÊûêÂá∫ÈîôÔºö' + error.message;
                console.error('Êó•ÂøóËß£ÊûêÈîôËØØ:', error);
            }
        }
        
        function clearLogData() {
            document.getElementById('logInput').value = '';
            document.getElementById('logResult').textContent = 'Á≠âÂæÖËæìÂÖ•Êó•ÂøóÊï∞ÊçÆ...';
        }
        
        // Â§ÑÁêÜÂõûËΩ¶ÈîÆËá™Âä®Ëß£Êûê
        function handleLogInputKeydown(event) {
            // Ê£ÄÊµãÂõûËΩ¶ÈîÆÔºàEnterÈîÆÔºåkeyCode‰∏∫13Ôºâ
            if (event.key === 'Enter' || event.keyCode === 13) {
                // ÈòªÊ≠¢ÈªòËÆ§ÁöÑÊç¢Ë°åË°å‰∏∫
                event.preventDefault();
                
                // Ëé∑ÂèñËæìÂÖ•Ê°ÜÁöÑÂÄº
                const logInput = document.getElementById('logInput').value.trim();
                
                // Â¶ÇÊûúÊúâÂÜÖÂÆπÂàôËá™Âä®ÂºÄÂßãËß£Êûê
                if (logInput) {
                    console.log('üîç Ê£ÄÊµãÂà∞ÂõûËΩ¶ÈîÆÔºåËá™Âä®ÂºÄÂßãËß£ÊûêÊó•Âøó');
                    analyzeLog();
                } else {
                    console.log('‚ö†Ô∏è ËæìÂÖ•Ê°Ü‰∏∫Á©∫ÔºåÊó†Ê≥ïËß£Êûê');
                }
            }
        }
        class QRGenerator {
            constructor() {
                this.generatedBlobs = []; // Â≠òÂÇ®ÁîüÊàêÁöÑblobÂØπË±°
                this.initEventListeners();
            }

            initEventListeners() {
                document.getElementById('qrGenerateBtn').addEventListener('click', () => this.generateQRCodes());
                document.getElementById('qrDownloadBtn').addEventListener('click', () => this.downloadZip());
            }

            showError(message) {
                const errorDiv = document.getElementById('qrErrorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }

            showSuccess(message) {
                const successDiv = document.getElementById('qrSuccessMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            }

            updateProgress(current, total, text) {
                const progressContainer = document.getElementById('qrProgressContainer');
                const progressFill = document.getElementById('qrProgressFill');
                const progressText = document.getElementById('qrProgressText');
                
                progressContainer.style.display = 'block';
                const percentage = (current / total) * 100;
                progressFill.style.width = percentage + '%';
                progressText.textContent = text || `Ê≠£Âú®ÁîüÊàê ${current}/${total} (${Math.round(percentage)}%)`;
            }

            hideProgress() {
                document.getElementById('qrProgressContainer').style.display = 'none';
            }

            updateApiStatus(message, show = true) {
                const apiStatus = document.getElementById('qrApiStatus');
                const apiStatusText = document.getElementById('qrApiStatusText');
                
                if (show) {
                    apiStatus.style.display = 'block';
                    apiStatusText.textContent = message;
                } else {
                    apiStatus.style.display = 'none';
                }
            }

            setGenerateButtonState(loading) {
                const btn = document.getElementById('qrGenerateBtn');
                const btnText = document.getElementById('qrGenerateBtnText');
                const btnLoading = document.getElementById('qrGenerateBtnLoading');
                
                btn.disabled = loading;
                btnText.style.display = loading ? 'none' : 'inline';
                btnLoading.style.display = loading ? 'inline-block' : 'none';
            }

            // ÁîüÊàêÂ∏¶Ëá™ÈÄÇÂ∫îIMEIÊñáÂ≠óÁöÑ‰∫åÁª¥Á†ÅÔºàÂ∏¶ÈáçËØïÊú∫Âà∂Ôºâ
            async generateQRCode(text, imei, retryCount = 0) {
                const encodedText = encodeURIComponent(text);
                const maxRetries = 2;
                
                // Â§ö‰∏™Â§áÈÄâAPIÔºåÊèêÈ´òÊàêÂäüÁéá
                const apis = [
                    `https://api.qrserver.com/v1/create-qr-code/?size=280x280&format=png&data=${encodedText}`,
                    `https://chart.googleapis.com/chart?chs=280x280&cht=qr&chl=${encodedText}`,
                    `https://quickchart.io/qr?text=${encodedText}&size=280`
                ];
                
                const currentApi = apis[retryCount % apis.length];
                console.log(`üîÑ ${imei} Â∞ùËØïAPI ${retryCount + 1}/${maxRetries + 1}:`, currentApi);
                
                try {
                    // ÂàõÂª∫Â∏¶Ëá™ÈÄÇÂ∫îIMEIÊñáÂ≠óÁöÑ‰∫åÁª¥Á†ÅÂõæÁâá
                    return await this.addTextToQRCode(currentApi, imei);
                } catch (error) {
                    console.log(`‚ùå ${imei} APIÂ§±Ë¥• (${retryCount + 1}/${maxRetries + 1}):`, error.message);
                    
                    if (retryCount < maxRetries) {
                        console.log(`üîÑ ${imei} ÈáçËØï‰∏≠...`);
                        await new Promise(resolve => setTimeout(resolve, 200)); // Áü≠ÊöÇÂª∂Ëøü
                        return await this.generateQRCode(text, imei, retryCount + 1);
                    } else {
                        throw new Error(`ÊâÄÊúâAPIÈÉΩÂ§±Ë¥•: ${error.message}`);
                    }
                }
            }

            // Âú®‰∫åÁª¥Á†ÅÂõæÁâá‰∏äÊ∑ªÂä†Ëá™ÈÄÇÂ∫îIMEIÊñáÂ≠ó
            async addTextToQRCode(qrUrl, imei) {
                console.log(`üñºÔ∏è ÂºÄÂßãÂ§ÑÁêÜ: ${imei}`);
                
                // Â∞ùËØïÂ§öÁßçÊñπÊ≥ïËé∑ÂèñÂõæÁâá
                const methods = [
                    // ÊñπÊ≥ï1: ‰ΩøÁî®‰ª£ÁêÜÊúçÂä°Âô®
                    async () => {
                        const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(qrUrl)}`);
                        if (!response.ok) throw new Error(`‰ª£ÁêÜÊúçÂä°Âô®ÈîôËØØ: ${response.status}`);
                        return await response.blob();
                    },
                    // ÊñπÊ≥ï2: ‰ΩøÁî®Âè¶‰∏Ä‰∏™‰ª£ÁêÜ
                    async () => {
                        const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(qrUrl)}`);
                        if (!response.ok) throw new Error(`‰ª£ÁêÜÊúçÂä°Âô®ÈîôËØØ: ${response.status}`);
                        return await response.blob();
                    },
                    // ÊñπÊ≥ï3: Áõ¥Êé•Â∞ùËØïÔºàÂèØËÉΩ‰ºöÊúâË∑®ÂüüÈóÆÈ¢òÔºå‰ΩÜÊúâ‰∫õÊµèËßàÂô®ÂÖÅËÆ∏Ôºâ
                    async () => {
                        const response = await fetch(qrUrl);
                        if (!response.ok) throw new Error(`Áõ¥Êé•ËØ∑Ê±ÇÈîôËØØ: ${response.status}`);
                        return await response.blob();
                    }
                ];
                
                let imageBlob = null;
                let lastError = null;
                
                // Â∞ùËØïÊØèÁßçÊñπÊ≥ï
                for (let i = 0; i < methods.length; i++) {
                    try {
                        console.log(`üîÑ ${imei} Â∞ùËØïÊñπÊ≥ï ${i + 1}/${methods.length}`);
                        imageBlob = await methods[i]();
                        console.log(`‚úÖ ${imei} ÊñπÊ≥ï ${i + 1} ÊàêÂäüËé∑ÂèñÂõæÁâá`);
                        break;
                    } catch (error) {
                        console.log(`‚ùå ${imei} ÊñπÊ≥ï ${i + 1} Â§±Ë¥•:`, error.message);
                        lastError = error;
                        continue;
                    }
                }
                
                if (!imageBlob) {
                    throw new Error(`ÊâÄÊúâËé∑ÂèñÂõæÁâáÁöÑÊñπÊ≥ïÈÉΩÂ§±Ë¥•: ${lastError?.message}`);
                }
                
                const imageUrl = URL.createObjectURL(imageBlob);
                
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    
                    const timeout = setTimeout(() => {
                        console.log(`‚è∞ ${imei} Â§ÑÁêÜË∂ÖÊó∂`);
                        URL.revokeObjectURL(imageUrl);
                        reject(new Error('Â§ÑÁêÜË∂ÖÊó∂'));
                    }, 10000);
                    
                    img.onload = () => {
                        clearTimeout(timeout);
                        console.log(`‚úÖ ${imei} ÂõæÁâáÂä†ËΩΩÊàêÂäü`);
                        
                        try {
                            // ÂàõÂª∫canvas
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            if (!ctx) {
                                throw new Error('Êó†Ê≥ïÂàõÂª∫Canvas‰∏ä‰∏ãÊñá');
                            }
                            
                            // ËÆæÁΩÆÁîªÂ∏ÉÂ∞∫ÂØ∏‰∏∫Ê≠£ÊñπÂΩ¢
                            const qrSize = 280;
                            const textHeight = 80;
                            const totalSize = qrSize + textHeight;
                            
                            canvas.width = totalSize;
                            canvas.height = totalSize;
                            
                            // Â°´ÂÖÖÁôΩËâ≤ËÉåÊôØ
                            ctx.fillStyle = '#ffffff';
                            ctx.fillRect(0, 0, totalSize, totalSize);
                            
                            // ÁªòÂà∂‰∫åÁª¥Á†ÅÔºàÂ±Ö‰∏≠‰∏äÊñπÔºâ
                            const qrX = (totalSize - qrSize) / 2;
                            const qrY = 10;
                            ctx.drawImage(img, qrX, qrY, qrSize, qrSize);
                            
                            // Ëá™ÈÄÇÂ∫îÊñáÂ≠óÂ§ßÂ∞èÂà∞‰∫åÁª¥Á†ÅÂÆΩÂ∫¶
                            const maxWidth = qrSize - 20;
                            let fontSize = 50;
                            const minFontSize = 24;
                            
                            // ËÆæÁΩÆÊñáÂ≠óÊ†∑Âºè
                            ctx.fillStyle = '#333333';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            
                            // Âä®ÊÄÅË∞ÉÊï¥Â≠ó‰ΩìÂ§ßÂ∞è
                            do {
                                ctx.font = `bold ${fontSize}px Arial, sans-serif`;
                                const textWidth = ctx.measureText(imei).width;
                                
                                if (textWidth <= maxWidth || fontSize <= minFontSize) {
                                    break;
                                }
                                fontSize -= 1;
                            } while (fontSize > minFontSize);
                            
                            fontSize = Math.max(fontSize, minFontSize);
                            ctx.font = `bold ${fontSize}px Arial, sans-serif`;
                            
                            // ÁªòÂà∂IMEIÊñáÂ≠ó
                            const textY = qrY + qrSize + textHeight / 2;
                            ctx.fillText(imei, totalSize / 2, textY);
                            
                            console.log(`üìè ${imei} Â≠ó‰Ωì: ${fontSize}px`);
                            
                            // ËΩ¨Êç¢‰∏∫blob
                            canvas.toBlob((resultBlob) => {
                                if (resultBlob) {
                                    const url = URL.createObjectURL(resultBlob);
                                    this.generatedBlobs.push({ blob: resultBlob, filename: `${imei}.png` });
                                    console.log(`üéâ ${imei} Â§ÑÁêÜÂÆåÊàê`);
                                    
                                    // Ê∏ÖÁêÜ‰∏¥Êó∂URL
                                    URL.revokeObjectURL(imageUrl);
                                    resolve(url);
                                } else {
                                    URL.revokeObjectURL(imageUrl);
                                    reject(new Error('CanvasËΩ¨Êç¢Â§±Ë¥•'));
                                }
                            }, 'image/png');
                            
                        } catch (error) {
                            console.error(`‚ùå ${imei} CanvasÂ§ÑÁêÜÂ§±Ë¥•:`, error);
                            URL.revokeObjectURL(imageUrl);
                            reject(error);
                        }
                    };
                    
                    img.onerror = (error) => {
                        clearTimeout(timeout);
                        console.error(`‚ùå ${imei} ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•:`, error);
                        URL.revokeObjectURL(imageUrl);
                        reject(new Error('ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•'));
                    };
                    
                    img.src = imageUrl;
                });
            }

            async generateQRCodes() {
                const prefix = document.getElementById('qrPrefix').value.trim();
                const imeiText = document.getElementById('qrImeiList').value.trim();
                
                if (!prefix) {
                    this.showError('ËØ∑ËæìÂÖ•‰∫åÁª¥Á†ÅÂâçÁºÄ');
                    return;
                }
                
                if (!imeiText) {
                    this.showError('ËØ∑ËæìÂÖ•IMEIÂàóË°®');
                    return;
                }

                const imeiList = imeiText.split('\n').filter(imei => imei.trim()).map(imei => imei.trim());
                
                if (imeiList.length === 0) {
                    this.showError('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑIMEIÂàóË°®');
                    return;
                }

                this.setGenerateButtonState(true);
                this.generatedBlobs = [];
                document.getElementById('qrGrid').innerHTML = '';
                document.getElementById('qrDownloadBtn').disabled = true;
                this.updateApiStatus('‰ΩøÁî®QR-Server.com APIÁîüÊàê‰∫åÁª¥Á†Å...');

                let successCount = 0;
                let failCount = 0;

                for (let i = 0; i < imeiList.length; i++) {
                    const imei = imeiList[i];
                    const qrText = prefix + imei;
                    
                    this.updateProgress(i + 1, imeiList.length, `Ê≠£Âú®ÁîüÊàê ${i + 1}/${imeiList.length}: ${imei}`);
                    
                    try {
                        const qrUrl = await this.generateQRCode(qrText, imei);
                        await this.displayQRCode(qrUrl, imei, qrText);
                        successCount++;
                        
                        // ÂáèÂ∞ëÂª∂ËøüÊó∂Èó¥ÔºåÊèêÈ´òÁîüÊàêÈÄüÂ∫¶
                        if (i < imeiList.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    } catch (error) {
                        console.error(`ÁîüÊàê ${imei} ÁöÑ‰∫åÁª¥Á†ÅÂ§±Ë¥•:`, error);
                        failCount++;
                        this.displayErrorQR(imei, error.message);
                    }
                }

                this.hideProgress();
                this.setGenerateButtonState(false);
                
                if (successCount > 0) {
                    document.getElementById('qrDownloadBtn').disabled = false;
                    this.updateApiStatus(`‚úÖ ÊàêÂäüÁîüÊàê ${successCount} ‰∏™‰∫åÁª¥Á†Å${failCount > 0 ? `ÔºåÂ§±Ë¥• ${failCount} ‰∏™` : ''}`);
                    this.showSuccess(`ÊàêÂäüÁîüÊàê ${successCount} ‰∏™‰∫åÁª¥Á†Å${failCount > 0 ? `ÔºåÂ§±Ë¥• ${failCount} ‰∏™` : ''}`);
                } else {
                    this.updateApiStatus('‚ùå ÊâÄÊúâ‰∫åÁª¥Á†ÅÁîüÊàêÂ§±Ë¥•');
                    this.showError('ÊâÄÊúâ‰∫åÁª¥Á†ÅÁîüÊàêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁ®çÂêéÈáçËØï');
                }
            }

            async displayQRCode(qrUrl, imei, qrText) {
                return new Promise((resolve, reject) => {
                    const qrItem = document.createElement('div');
                    qrItem.className = 'qr-item';
                    
                    // ÂàõÂª∫ÂõæÁâáÂÖÉÁ¥†Âπ∂Á≠âÂæÖÂä†ËΩΩ
                    const img = new Image();
                    img.onload = () => {
                        qrItem.innerHTML = `
                            <img src="${qrUrl}" alt="QR Code for ${imei}">
                            <div class="qr-label">${imei}</div>
                            <div class="qr-label" style="font-size: 0.7em; color: #999; margin-top: 5px;">${qrText}</div>
                            <div class="qr-label" style="font-size: 0.6em; color: #4facfe; margin-top: 3px;">API: QR-Server.com</div>
                        `;
                        
                        document.getElementById('qrGrid').appendChild(qrItem);
                        resolve();
                    };
                    
                    img.onerror = () => {
                        reject(new Error('‰∫åÁª¥Á†ÅÂõæÁâáÂä†ËΩΩÂ§±Ë¥•'));
                    };
                    
                    img.src = qrUrl;
                });
            }

            displayErrorQR(imei, errorMsg) {
                const qrItem = document.createElement('div');
                qrItem.className = 'qr-item';
                qrItem.style.background = '#ffe6e6';
                qrItem.innerHTML = `
                    <div style="padding: 20px; color: #d63031;">
                        <div style="font-size: 2em; margin-bottom: 10px;">‚ùå</div>
                        <div class="qr-label">${imei}</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">${errorMsg}</div>
                    </div>
                `;
                
                document.getElementById('qrGrid').appendChild(qrItem);
            }

            async downloadZip() {
                if (this.generatedBlobs.length === 0) {
                    this.showError('Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑ‰∫åÁª¥Á†Å');
                    return;
                }

                const zip = new JSZip();
                const downloadBtn = document.getElementById('qrDownloadBtn');
                const originalText = downloadBtn.textContent;
                
                downloadBtn.disabled = true;
                downloadBtn.innerHTML = '<span class="loading"></span> Ê≠£Âú®ÊâìÂåÖ...';

                try {
                    // Â§ÑÁêÜÁîüÊàêÁöÑÂõæÁâá
                    for (let i = 0; i < this.generatedBlobs.length; i++) {
                        const item = this.generatedBlobs[i];
                        zip.file(item.filename, item.blob);
                        downloadBtn.textContent = `Ê≠£Âú®ÊâìÂåÖ ${i + 1}/${this.generatedBlobs.length}`;
                    }

                    downloadBtn.textContent = 'Ê≠£Âú®ÁîüÊàêÂéãÁº©ÂåÖ...';
                    const content = await zip.generateAsync({type: 'blob'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = `‰∫åÁª¥Á†Å_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.zip`;
                    link.click();
                    
                    URL.revokeObjectURL(link.href);
                    this.showSuccess('‰∫åÁª¥Á†ÅÊâìÂåÖ‰∏ãËΩΩÊàêÂäüÔºÅ');
                    
                } catch (error) {
                    console.error('ÊâìÂåÖ‰∏ãËΩΩÂ§±Ë¥•:', error);
                    this.showError('ÊâìÂåÖ‰∏ãËΩΩÂ§±Ë¥•: ' + error.message);
                } finally {
                    downloadBtn.disabled = false;
                    downloadBtn.textContent = originalText;
                }
            }
        }

        // ÂàùÂßãÂåñ‰∫åÁª¥Á†ÅÁîüÊàêÂô®
        let qrGenerator = null;
        function initQRGenerator() {
            if (!qrGenerator) {
                qrGenerator = new QRGenerator();
            }
        }

        // Âú®ÊòæÁ§∫Â∑•ÂÖ∑Êó∂ÂàùÂßãÂåñ
        function showTool(toolId) {
            // ÈöêËóèÊâÄÊúâÂ∑•ÂÖ∑
            document.querySelectorAll('.calculator').forEach(tool => {
                tool.style.display = 'none';
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÂ∑•ÂÖ∑
            const selectedTool = document.getElementById(toolId);
            if (selectedTool) {
                selectedTool.style.display = 'block';
                
                // Â¶ÇÊûúÊòØ‰∫åÁª¥Á†ÅÁîüÊàêÂô®ÔºåÂàùÂßãÂåñÂÆÉ
                if (toolId === 'qrGeneratorTool') {
                    initQRGenerator();
                }
                
                // Â¶ÇÊûúÊòØÊó•ÂøóËß£ÊûêÂô®ÔºåÂèØ‰ª•ÂÅö‰∏Ä‰∫õÂàùÂßãÂåñ
                if (toolId === 'logAnalysisTool') {
                    // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Êó•ÂøóËß£ÊûêÂô®ÁöÑÂàùÂßãÂåñÈÄªËæë
                    console.log('Êó•ÂøóËß£ÊûêÂô®Â∑≤ÊøÄÊ¥ª');
                }
            }
            
            // Êõ¥Êñ∞ÊåâÈíÆÊøÄÊ¥ªÁä∂ÊÄÅ
            document.querySelectorAll('.tool-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tool-switcher button[onclick="showTool('${toolId}')"]`).classList.add('active');
        }
    </script>
</body>
</html>
