<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>âš¡ï¸å·¥å…·é›†âš¡ï¸</title>
    <!-- ç½‘ç«™å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="shortcut icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="./logDecode.js"></script>
    <style>
        /* ===== å…¨å±€æ ·å¼ ===== */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* ===== å®¹å™¨æ ·å¼ ===== */
        .container {
            max-width: 1300px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        /* ===== ä¸»æ ‡é¢˜æ ·å¼ ===== */
        h1 {
            text-align: center;
            /*background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);*/
            -webkit-background-clip: text;
            /*-webkit-text-fill-color: transparent;*/
            background-clip: text;
            font-size: 2.5em;
            margin: 0 0 30px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* ===== å·¥å…·å¯¼èˆªæ æ ·å¼ ===== */
        .tool-switcher {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0 30px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .tool-switcher button {
            padding: 12px 20px;
            border: 2px solid transparent;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            cursor: pointer;
            border-radius: 25px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .tool-switcher button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }
        
        .tool-switcher button:hover::before {
            left: 100%;
        }
        
        .tool-switcher button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
            border-color: #007bff;
        }
        
        .tool-switcher button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #5a67d8;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }
        
        /* ===== è®¡ç®—å™¨æ¨¡å—æ ·å¼ ===== */
        .calculator {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .calculator h2 {
            color: #333;
            margin: 0 0 25px 0;
            font-size: 1.8em;
            text-align: center;
            position: relative;
        }
        
        .calculator h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        /* ===== è¡¨å•å…ƒç´ æ ·å¼ ===== */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        input[readonly] {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #666;
            cursor: not-allowed;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        /* ===== æŒ‰é’®æ ·å¼ ===== */
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* ===== æ—¥å¿—åˆ†æå™¨æ ·å¼ ===== */
        .log-analysis-tool {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* ç»“æœé¡¹å®¹å™¨æ ·å¼ */
        .result-item {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .result-item.error {
            border: 2px solid #f5c6cb;
        }
        
        /* é”™è¯¯åŸå§‹æ•°æ®åŒºåŸŸæ ·å¼ */
        .error-raw-data {
            padding: 15px;
            background-color: #f8d7da;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
        }
        
        /* åŸå§‹æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸæ ·å¼ */
        .result-header + div {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .buttons-section {
            display: flex;
            gap: 10px;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .clear-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .clear-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
        
        .status-section {
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .status-section.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-section.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .result-section {
            display: flex;
            flex-direction: column;
        }
        
        .result-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1em;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        .result-content {
            max-height: 600px;
            overflow-y: auto;
            border: 2px solid #e1e5e9;
            border-top: none;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th {
            background: #d1ecf1;
            color: #0c5460;
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            font-size: 0.75em;
            min-width: 60px;
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .data-table th.row-label {
            background: #e9ecef;
            color: #495057;
            font-weight: 700;
            text-align: left;
            min-width: 80px;
            max-width: 100px;
            position: sticky;
            left: 0;
            z-index: 10;
            text-align: center;
            font-size: 1.3em;

        }
        
        .data-table th.range-cell {
            background: #f1f3f4;
            color: #222222;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .data-table td {
            padding: 6px 4px;
            border-bottom: 1px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 0.7em;
            text-align: center;
            white-space: nowrap;
            min-width: 60px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .data-table td.row-label {
            background: #f8f9fa;
            font-weight: 600;
            text-align: left;
            position: sticky;
            left: 0;
            z-index: 5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-width: 80px;
            max-width: 100px;
            text-align: center;
            font-size: 1.3em;

        }
        
        .data-table td.data-cell {
            min-width: 60px;
            max-width: 120px;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .data-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .hex-value {
            color: #666666;
            font-weight: bold;
            font-size: 1.5em;
            text-align: center;
        }
        
        .dec-value {
            color: #333333;
            font-size: 1.5em;
            text-align: center;
            font-weight: bold;

        }
        
        .data-type-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            .data-table {
                font-size: 0.65em;
            }
            
            .data-table th, .data-table td {
                padding: 4px 2px;
                min-width: 45px;
                max-width: 80px;
            }
            
            .data-table th.row-label, .data-table td.row-label {
                min-width: 60px;
                max-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .data-table th, .data-table td {
                padding: 3px 1px;
                min-width: 35px;
                max-width: 60px;
                font-size: 0.6em;
            }
            
            .data-table th.row-label, .data-table td.row-label {
                min-width: 50px;
                max-width: 70px;
            }
        }
        
        button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:active::before {
            width: 300px;
            height: 300px;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ä¸»è¦æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        /* æˆåŠŸæŒ‰é’®æ ·å¼ */
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.4);
        }
        
        /* è­¦å‘ŠæŒ‰é’®æ ·å¼ */
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(240, 147, 251, 0.4);
        }
        
        /* å±é™©æŒ‰é’®æ ·å¼ */
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 65, 108, 0.4);
        }
        
        /* ===== ç»“æœæ˜¾ç¤ºåŒºåŸŸæ ·å¼ ===== */
        .result-area {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            min-height: 120px;
            font-family: 'Consolas', 'Monaco', monospace;
            line-height: 1.6;
        }
        
        /* ===== å‚æ•°è§£æå·¥å…·ç‰¹æ®Šæ ·å¼ ===== */
        .param-results {
            margin-top: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
        }
        
        .param-group {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .param-column {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .param-column h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        /* ===== æŒ‰é’®ç»„æ ·å¼ ===== */
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        /* ===== æç¤ºä¿¡æ¯æ ·å¼ ===== */
        .info-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffeaa7;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .info-box .title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .info-box .content {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* ===== è¡¨æ ¼æ ·å¼ ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 12px;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 1.0em;
        }
        
        .data-table tr:nth-child(even) {
            background: rgba(102, 126, 234, 0.05);
        }
        

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .tool-switcher {
                gap: 5px;
            }
            
            .tool-switcher button {
                padding: 10px 15px;
                font-size: 12px;
            }
            
            .calculator {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .param-group {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2em;
            }
        }
        
        /* ===== æ»šåŠ¨æ¡æ ·å¼ ===== */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        /* ===== äºŒç»´ç ç”Ÿæˆå™¨æ ·å¼ ===== */
        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 0;
        }
        
        .qr-item {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 0;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .qr-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        
        .qr-item img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .qr-label {
            word-break: break-all;
            line-height: 1.4;
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }
        
        .api-status, .progress-container, .error-message, .success-message {
            margin: 15px 0;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        
        .api-status {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            color: #1565c0;
        }
        
        .progress-container {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e9ecef;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .progress-text {
            color: #666;
            font-size: 12px;
            text-align: center;
        }
        
        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border: 2px solid #f44336;
            color: #c62828;
        }
        
        .success-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 2px solid #4caf50;
            color: #2e7d32;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼æ–­ç‚¹ä¼˜åŒ– */
        @media (max-width: 1400px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 12px;
            }
        }
        
        @media (max-width: 1200px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            .qr-item {
                padding: 12px;
            }
            .qr-label {
                font-size: 12px;
            }
        }
        
        @media (max-width: 576px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 8px;
            }
            .qr-item {
                padding: 10px;
            }
            .qr-label {
                font-size: 11px;
            }
        }
        
        @media (max-width: 480px) {
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 6px;
            }
            .qr-item {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="font-family:arial;margin-right: 10px;color:#007bff;">âš¡ï¸YLå·¥å…·é›†âš¡ï¸</h1>

        <a>æ•™ç¨‹ç›®å½•ï¼š</a>
        <a href="http://docx.yuelongxinxi.com/login.html"style="font-family:arial;margin-right: 10px;color:black;">ç™»å½•;</a>

        <a href="http://docx.yuelongxinxi.com/static/views/doc_content/index.html?doc_content_id=63&sign=e21406567970f804d6aef89bd77d6c19"style="font-family:arial;margin-right: 10px;color:black;">å¹³å°æ•™ç¨‹ç›®å½•;</a>

        <a href="http://docx.yuelongxinxi.com/static/views/doc_content/index.html?doc_content_id=62&sign=9aa417293f0f3753fad23457f5fb6973"style="font-family:margin-left: 10px;arial;color:black;">å…¬ä¼—å·æ•™ç¨‹ç›®å½•</a>
        
        <a href="http://docx.yuelongxinxi.com/static/views/doc_content/index.html?doc_content_id=134&sign=ef12fc1f6bd4d2491f3db21ab5cd3e3f"style="font-family:margin-left: 10px;arial;color:black;">ç¡¬ä»¶äº§å“å¤‡å¿˜å½•</a>

        <nav class="tool-switcher">
            <button onclick="showTool('pulseTool')">ğŸ”„ è„‰å†²è®¡ç®—å™¨</button>
            <button onclick="showTool('conversionTool')">ğŸ”¢ è¿›åˆ¶è½¬æ¢å™¨</button>
            <button onclick="showTool('paramParser')">ğŸ“‹ å…¥åº“å‚æ•°è§£æ</button>
            <button onclick="showTool('iccidTool')">ğŸ“± ICCIDè¯¦æƒ…</button>
            <button onclick="showTool('excelTemplateTool')">ğŸ“‹ ICå¡å·å¤„ç†</button>
            <button onclick="showTool('serialNumberTool')">ğŸ”¢ ç”Ÿæˆæµæ°´å·</button>
            <button onclick="showTool('waterValueTool')">ğŸ’§ æ´—æµ´å•ä»·</button>
            <button onclick="showTool('waterPriceTool')">ğŸš° æ°´æ§å•ä»·</button>
            <button onclick="showTool('csv89860Tool')">ğŸ“Š ä¿®å¤iccidä¹±ç </button>
            <button onclick="showTool('qrGeneratorTool')">ğŸ”² äºŒç»´ç ç”Ÿæˆå™¨</button>
            <button onclick="showTool('logAnalysisTool')">ğŸ“Š æ—¥å¿—åˆ†æå™¨</button>
            <button onclick="showTool('logAnalysisTool2')">ğŸ“Š æ—¥å¿—è§£æå™¨</button>
        </nav>
        
        <!-- ICå¡å·å¤„ç†å·¥å…·æ¨¡å— -->
        <section id="excelTemplateTool" class="calculator">
            <h2>ğŸ“‹ ICå¡å·å¤„ç†</h2>
            <div class="form-group">
                <label>ä¸Šä¼ Excelæ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°ä¸‹æ–¹ï¼š</label>
                <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="height: 150px; padding: 8px; font-size: 14px;">
            
            </div>
            <div class="form-group">
                <label>ä½¿ç”¨æ¨¡æ¿ï¼š</label>
                <select id="templateSelect">
                    <option value="icå¡å…¥åº“æ¨¡æ¿.xls" selected>icå¡å…¥åº“æ¨¡æ¿.xls</option>
                </select>
                <div id="templateStatus" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 14px;">ğŸ”„ æ­£åœ¨åŠ è½½è¿œç¨‹æ¨¡æ¿...</div>
            </div>
            <div class="button-group">
                <button onclick="processExcelFile()" class="btn-primary" disabled>ğŸ“Š å¤„ç†Excelæ–‡ä»¶</button>
                <button onclick="clearExcelData()" class="btn-warning">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
            </div>
            <div class="form-group">
                <label>å¤„ç†çŠ¶æ€ï¼š</label>
                <div id="excelProcessStatus" class="result-area">è¯·ä¸Šä¼ Excelæ–‡ä»¶å¹¶é€‰æ‹©æ¨¡æ¿</div>
            </div>
            <div class="form-group">
                <label>æ•°æ®é¢„è§ˆï¼š</label>
                <div id="excelDataPreview" class="result-area" style="max-height: 300px; overflow-y: auto;">ç­‰å¾…æ–‡ä»¶ä¸Šä¼ ...</div>
            </div>
            <div class="info-box">
                <div class="title">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</div>
                <div class="content">
                    â€¢ æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼çš„Excelæ–‡ä»¶<br>
                    â€¢ ä½¿ç”¨GitHub Pages/Gitee Pagesæ‰˜ç®¡æ¨¡æ¿æ–‡ä»¶ï¼Œç¨³å®šå¯é <br>
                    â€¢ è‡ªåŠ¨è¯†åˆ«Aã€Båˆ—ä¸­çš„æ°´å¡å·ï¼ˆåŒ…å«å­—æ¯ï¼‰å’Œæµæ°´å·ï¼ˆçº¯æ•°å­—ï¼‰<br>
                    â€¢ å¦‚æœé¦–è¡ŒåŒ…å«"æµæ°´å·"ã€"æ°´å¡å·"ç­‰ä¸­æ–‡å­—ç¬¦ï¼Œå°†è·³è¿‡é¦–è¡Œ<br>
                    â€¢ å¤„ç†åçš„æ•°æ®å°†å¡«å…¥è¿œç¨‹æ¨¡æ¿æ–‡ä»¶ä¸­<br>
                    â€¢ æ°´å¡å·å¡«å…¥æ¨¡æ¿Aåˆ—ï¼ˆä»A2å¼€å§‹ï¼‰ï¼Œæµæ°´å·å¡«å…¥Båˆ—ï¼ˆä»B2å¼€å§‹ï¼‰<br><br>
                    ğŸ”§ <strong>é…ç½®æ¨¡æ¿æ–‡ä»¶æ­¥éª¤ï¼š</strong><br>
                    1ï¸âƒ£ åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªå…¬å¼€ä»“åº“<br>
                    2ï¸âƒ£ ä¸Šä¼ `icå¡å…¥åº“æ¨¡æ¿.xls`æ–‡ä»¶åˆ°ä»“åº“æ ¹ç›®å½•<br>
                    3ï¸âƒ£ åœ¨ä»“åº“Settingsä¸­å¯ç”¨GitHub Pages<br>
                    4ï¸âƒ£ è·å–æ¨¡æ¿æ–‡ä»¶çš„å…¬å¼€URLï¼ˆå¦‚ï¼šhttps://username.github.io/repo/icå¡å…¥åº“æ¨¡æ¿.xlsï¼‰<br>
                    5ï¸âƒ£ ä¿®æ”¹ä»£ç ä¸­çš„templateUrlä¸ºå®é™…URL<br><br>
                    ğŸ† <strong>Gitee Pageså¤‡ç”¨æ–¹æ¡ˆï¼ˆå›½å†…è®¿é—®æ›´å¿«ï¼‰ï¼š</strong><br>
                    1ï¸âƒ£ åœ¨Giteeä¸Šåˆ›å»ºä¸€ä¸ªå…¬å¼€ä»“åº“<br>
                    2ï¸âƒ£ ä¸Šä¼ `icå¡å…¥åº“æ¨¡æ¿.xls`æ–‡ä»¶åˆ°ä»“åº“æ ¹ç›®å½•<br>
                    3ï¸âƒ£ åœ¨ä»“åº“çš„"æœåŠ¡"ä¸­é€‰æ‹©"Gitee Pages"<br>
                    4ï¸âƒ£ é€‰æ‹©éƒ¨ç½²åˆ†æ”¯ï¼ˆé€šå¸¸ä¸ºmasterï¼‰ï¼Œç‚¹å‡»"å¯åŠ¨"<br>
                    5ï¸âƒ£ æˆåŠŸåè·å–URLï¼ˆå¦‚ï¼šhttps://username.gitee.io/repo/icå¡å…¥åº“æ¨¡æ¿.xlsï¼‰<br>
                    6ï¸âƒ£ å°†æ­¤URLè®¾ç½®ä¸ºfallbackUrls[0]<br><br>
                    ğŸŒ <strong>å¦‚æœGitee Pagesä¸å¯ç”¨ï¼Œæ›¿ä»£æ–¹æ¡ˆï¼š</strong><br>
                    â€¢ <strong>jsDelivr CDN</strong>: https://cdn.jsdelivr.net/gh/ç”¨æˆ·å/ä»“åº“å/æ–‡ä»¶å<br>
                    â€¢ <strong>GitHub Raw</strong>: https://raw.githubusercontent.com/ç”¨æˆ·å/ä»“åº“å/main/æ–‡ä»¶å<br>
                    â€¢ <strong>Coding.net</strong>: https://ç”¨æˆ·å.coding.net/p/é¡¹ç›®å/d/ä»“åº“å/git/raw/master/æ–‡ä»¶å
                </div>
            </div>
            <div class="info-box" style="border-color: #007bff; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                <div class="title" style="color: #1565c0;">ğŸŒ å½“å‰å¤šé‡å¤‡ç”¨é…ç½®ï¼š</div>
                <div class="content" style="color: #1565c0; font-size: 12px;">
                    â€¢ ä¸»URLï¼š<code>GitHub Raw</code><br>
                    â€¢ å¤‡ç”¨URL 1ï¼š<code>GitHub Pages</code><br>
                    â€¢ å¤‡ç”¨URL 2ï¼š<code>Gitee Pages</code><br>
                    â€¢ å¤‡ç”¨URL 3ï¼š<code>jsDelivr CDN</code><br>
                    â€¢ å¤‡ç”¨URL 4ï¼š<code>Coding.net</code><br>
                    â€¢ çŠ¶æ€ï¼šâœ… å¤šé‡ä¿éšœï¼Œé«˜å¯ç”¨æ€§
                </div>
            </div>
        </section>
        
        <section id="pulseTool" class="calculator" style="display:none;">
            <h2>ğŸ”„ è„‰å†²å‚æ•°è®¡ç®—å™¨</h2>
            <div class="form-group">
                <label>ç³»ç»Ÿè®¾ç½®è„‰å†²æ•°ï¼š</label>
                <input type="number" id="systemPulses" min="0" step="1" placeholder="è¯·è¾“å…¥æ­£æ•´æ•°">
            </div>
            
            <div class="form-group">
                <label>ç³»ç»Ÿæ˜¾ç¤ºå‡ºæ°´é‡(ml)ï¼š</label>
                <input type="number" id="systemWater" min="0" step="0.01" placeholder="è¯·è¾“å…¥æ­£æ•°">
            </div>
            
            <div class="form-group">
                <label>å®é™…å‡ºæ°´é‡(ml)ï¼š</label>
                <input type="number" id="actualWater" placeholder="è¯·è¾“å…¥æ­£æ•°">
            </div>
            
            <div class="form-group">
                <label>å®é™…è„‰å†²æ•°ï¼š</label>
                <input type="number" id="actualPulses" readonly placeholder="è‡ªåŠ¨è®¡ç®—ç»“æœ">
            </div>
        </section>

        <section id="conversionTool" class="calculator" style="display:none;">
            <h2>ğŸ”¢ è¿›åˆ¶è½¬æ¢å·¥å…·</h2>
            <div class="form-group">
                <label>åè¿›åˆ¶ï¼š</label>
                <input type="text" id="decimalInput" placeholder="è¾“å…¥0-9æ•°å­—">
            </div>
            
            <div class="form-group">
                <label>åå…­è¿›åˆ¶ï¼š</label>
                <input type="text" id="hexInput" placeholder="è¾“å…¥0-9/A-F">
            </div>
        </section>
        
        <section id="paramParser" class="calculator" style="display:none;">
            <h2>ğŸ“‹ å…¥åº“å‚æ•°è§£æå·¥å…·</h2>
            <div class="form-group">
                <label>å‚æ•°æ–‡æœ¬ï¼š</label>
                <textarea id="paramInput" placeholder="ç²˜è´´å‚æ•°æ–‡æœ¬... ç¤ºä¾‹ï¼š
1è„‰å†²1250ï¼Œæ£€ä¿®720ï¼Œå¤§/1é€šé“/çƒ­æ°´è´¹ç‡[å…ƒ/å‡]0.5"></textarea>
            </div>
            <div class="button-group">
                <button onclick="parseParams()" class="btn-primary">ğŸ” è§£æå‚æ•°</button>
            </div>
            
            <div class="param-results">
                <div class="param-group">
                    <div class="param-column">
                        <h4>æ ‡å‡†æ ¼å¼ï¼š</h4>
                        <div id="formattedParams"></div>
                    </div>
                </div>
            </div>
        </section>
        

        
        <!-- ICCIDè¯¦æƒ…å·¥å…·æ¨¡å— -->
        <section id="iccidTool" class="calculator" style="display:none;">
            <h2>ICCIDè¯¦æƒ…å·¥å…·</h2>
              <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</div>
                    <div style="color: #856404; font-size: 14px;">
                        â€¢ æ”¯æŒç²˜è´´ICCIDåŒºé—´èŒƒå›´æ–‡æœ¬ä¾‹ï¼š898604C6062290468489åˆ°898604C6062290468491<br>
                        â€¢ æ”¯æŒå•ä¸ªiccidï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰<br>
                        â€¢ ç‚¹å‡»è·å–å®Œæ•´iccidæŒ‰é’®ï¼Œä¼šå°†åŒºé—´æ‰€æœ‰iccidèŒƒå›´æå–ä¸ºä¸€åˆ—æ•°æ®ã€‚<br>
                        â€¢ ç‚¹å‡»ä¿®æ”¹ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼æŒ‰é’®ï¼Œä¼šåˆ é™¤æ‰€æœ‰æ¢è¡Œã€‚ä½¿ç”¨è‹±æ–‡é€—å·é—´éš”ã€‚<br>
                        â€¢ åœ¨iccidåæ·»åŠ è‹±æ–‡å•å¼•å·ï¼Œç”¨äºé˜²æ­¢ç²˜è´´è‡³excelè‡ªåŠ¨å˜ç§‘å­¦è®¡æ•°ã€‚<br>
                    </div>
                </div>
            <div class="form-group">
                <textarea id="iccidInput" placeholder="ç²˜è´´ICCIDèŒƒå›´æ–‡æœ¬... ç¤ºä¾‹ï¼š
898604C6062290468489åˆ°898604C6062290468491(3å¼ )
898604C6062290469305åˆ°898604C6062290469309ï¼ˆ5å¼ ï¼‰
898604D00623D0047511'
898604D00623D0047313'
898604D00623D0046269'

æ”¯æŒåŒæ—¶è§£æä¸¤ç§æ ¼å¼çš„ICCID
æŒ‰Ctrl+Enterå¯ä»¥æ¢è¡Œ
" style="width:100%; height:100px; padding:8px; margin-bottom:10px;"></textarea>
            </div>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button onclick="parseIccids()" style="background: #007bff; color: white; padding: 8px 20px;">ğŸ” è·å–å®Œæ•´iccid</button>
                <button onclick="formatIccids()" style="background: #28a745; color: white; padding: 8px 20px;">ğŸ“ ä¿®æ”¹ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼</button>
                <button onclick="addQuotesToIccids()" style="background: #ffc107; color: black; padding: 8px 20px;">ğŸ”„ é˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼</button>
            </div>
            
            <div class="form-group">
                <label>è§£æç»“æœï¼š</label>
                <textarea id="iccidResult" style="width:100%; height:200px; padding:8px;"></textarea>
            </div>
        </section>

        <!-- ç”Ÿæˆæµæ°´å·å·¥å…·æ¨¡å— -->
        <section id="serialNumberTool" class="calculator" style="display:none;">
            <h2>ğŸ”¢ ç”Ÿæˆæµæ°´å·å·¥å…·</h2>
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 15px;">
                <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</div>
                <div style="color: #856404; font-size: 14px;">
                    â€¢ èµ·å§‹æµæ°´å·ä¸ºå¿…å¡«é¡¹ï¼Œé»˜è®¤æ˜¾ç¤ºå½“æ—¥æ—¥æœŸ+001<br>
                    â€¢ æ•°é‡å’Œç»“æŸæµæ°´å·ä»»é€‰å…¶ä¸€å¡«å†™<br>
                    â€¢ ç”ŸæˆæŒ‰é’®ç”¨äºæ ¹æ®è¾“å…¥ç”Ÿæˆå¯¹åº”æ•°é‡çš„æµæ°´å·<br>
                    â€¢ å¤åˆ¶æŒ‰é’®å¯å¤åˆ¶ç”Ÿæˆçš„ç»“æœ<br>
                    â€¢ ä¿®æ”¹ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼ï¼šå°†æ¢è¡Œåˆ†éš”è½¬ä¸ºé€—å·åˆ†éš”<br>
                    â€¢ é˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼ï¼šåœ¨æ¯ä¸ªæµæ°´å·åæ·»åŠ å•å¼•å·
                </div>
            </div>
            
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <div style="flex:1;">
                    <label>èµ·å§‹æµæ°´å·ï¼š</label>
                    <input type="text" id="startSerialNumber" style="width:100%; padding:8px;">
                </div>
                <div style="flex:1;">
                    <label>æ•°é‡ï¼š</label>
                    <input type="number" id="serialNumberCount" max="20000" style="width:100%; padding:8px;">
                </div>
                <div style="flex:1;">
                    <label>ç»“æŸæµæ°´å·ï¼š</label>
                    <input type="text" id="endSerialNumber" style="width:100%; padding:8px;">
                </div>
            </div>
            
            <!-- æç¤ºä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="toolMessage" style="padding:10px; margin-bottom:10px; border-radius:5px; background-color: #f8f9fa; display:none;"></div>
            
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button onclick="generateSerialNumbers()" style="background: #007bff; color: white; padding: 8px 20px;">ğŸ” ç”Ÿæˆæµæ°´å·</button>
                <button onclick="copySerialNumbers()" style="background: #6c757d; color: white; padding: 8px 20px;">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button onclick="formatSerialNumbers()" style="background: #28a745; color: white; padding: 8px 20px;">ğŸ“ ä¿®æ”¹ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼</button>
                <button onclick="addQuotesToSerialNumbers()" style="background: #ffc107; color: black; padding: 8px 20px;">ğŸ”„ é˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼</button>
            </div>
            
            <div class="form-group">
                <label>ç”Ÿæˆç»“æœï¼š</label>
                <textarea id="serialNumberResult" style="width:100%; height:200px; padding:8px;"></textarea>
            </div>
        </section>

        <section id="waterValueTool" class="calculator" style="display:none;">
            <h2>ğŸ’§ æ´—æµ´æ°´æ§ é‡‘é¢æ°´é‡æ¢ç®—</h2>
            <div class="form-group">
                <label>é‡‘é¢ (å…ƒ):</label>
                <input type="number" id="amount" step="0.01" placeholder="è¾“å…¥é‡‘é¢" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>æ°´é‡ (æ¯«å‡):</label>
                <input type="number" id="waterVolume" placeholder="è¾“å…¥æ°´é‡" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>1åˆ†é’±å¯¹åº”æ°´é‡ (æ¯«å‡):</label>
                <input type="number" id="pricePerMl" step="0.01" placeholder="è¾“å…¥1åˆ†é’±å¯¹åº”çš„æ¯«å‡æ•°" oninput="calculateWaterValue()">
            </div>
            <div class="form-group">
                <label>æ¢ç®—ç»“æœï¼š</label>
                <div id="waterValueResult" class="result-area">
                    <div id="waterCalculations">è¯·è¾“å…¥ä»»æ„ä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—</div>
                </div>
            </div>
        </section>

        <section id="waterPriceTool" class="calculator" style="display:none;">
            <h2>ğŸš° å…±äº«å•ä»·è®¡ç®—å™¨</h2>
            <div class="form-group">
                <label>æ°´é‡ (æ¯«å‡):</label>
                <input type="number" id="waterVolume2" step="0.01" placeholder="ä¾‹å¦‚ï¼š787" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>æ¶ˆè´¹é‡‘é¢ (å…ƒ):</label>
                <input type="number" id="amount2" step="0.0001" placeholder="ä¾‹å¦‚ï¼š0.2385" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>1å‡æ°´å•ä»· (å…ƒ/å‡):</label>
                <input type="number" id="pricePerLiter" step="0.0001" placeholder="ä¾‹å¦‚ï¼š0.3030" oninput="calculateWaterPrice()">
            </div>
            <div class="form-group">
                <label>è®¡ç®—ç»“æœï¼š</label>
                <div id="waterPriceResult" class="result-area">
                    <div id="waterPriceCalculations">è¯·è¾“å…¥ä»»æ„ä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—</div>
                </div>
            </div>
        </section>
        
        <!-- CSV/Excel IMEI/ICCID ç§‘å­¦è®¡æ•°æ³•å¤„ç†å·¥å…·æ¨¡å— -->
        <section id="csv89860Tool" class="calculator" style="display:none;">
                <h2>ğŸ“Š  IMEI/ICCID ä¹±ç å¤„ç†å·¥å…·</h2>
                <div class="form-group">
                    <label>ä¸Šä¼ æ–‡ä»¶ï¼ˆæ”¯æŒCSVã€XLSã€XLSXæ ¼å¼ï¼‰ï¼š</label>
                    <input type="file" id="csvFileInput" accept=".csv,.xls,.xlsx" style="height: 150px; padding: 8px; font-size: 14px;">
                </div>
                <button onclick="processCSVFile()" disabled>å¤„ç†æ–‡ä»¶</button>
                <div class="form-group">
                    <label>å¤„ç†çŠ¶æ€ï¼š</label>
                    <div id="csvProcessStatus" style="min-height: 40px;">è¯·é€‰æ‹©æ–‡ä»¶è¿›è¡Œå¤„ç†</div>
                </div>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 15px;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</div>
                    <div style="color: #856404; font-size: 14px;">
                        â€¢ æ”¯æŒCSVã€Excel(.xls/.xlsx)æ ¼å¼æ–‡ä»¶å¤„ç†<br>
                        â€¢ è‡ªåŠ¨åœ¨æ‰€æœ‰"89860"å¼€å¤´çš„å€¼å‰æ·»åŠ è‹±æ–‡å•å¼•å·<br>
                        â€¢ è‡ªåŠ¨åœ¨æ‰€æœ‰"86"å¼€å¤´çš„15ä½æ•°å­—(IMEI)å‰æ·»åŠ è‹±æ–‡å•å¼•å·<br>
                        â€¢ è‡ªåŠ¨åœ¨æ‰€æœ‰é•¿æ•°å­—(å¯èƒ½è¢«Excelè½¬ä¸ºç§‘å­¦è®¡æ•°æ³•)å‰æ·»åŠ è‹±æ–‡å•å¼•å·<br>
                        â€¢ å¤„ç†å®Œæˆåè‡ªåŠ¨ä¸‹è½½ä¿®æ”¹åçš„æ–‡ä»¶
                    </div>
                </div>
        </section>

    </div>

    <script>
        // å…¨å±€å˜é‡
        let excelData = null;
        let parsedData = { waterCardNumbers: [], serialNumbers: [] };
        let uploadedFileName = '';
        let templateWorkbook = null;
        let loadedTemplates = new Map(); // å­˜å‚¨å·²åŠ è½½çš„æ¨¡æ¿æ–‡ä»¶
        
        // è¿œç¨‹æ¨¡æ¿é…ç½®ï¼ˆå¤šé‡å¤‡ç”¨æ–¹æ¡ˆï¼‰
        const remoteTemplateConfig = {
            // ğŸ”— ä¸»æ–¹æ¡ˆä½¿ç”¨GitHub Rawï¼Œæ›´ç¨³å®šå¯é 
            templateUrl: 'https://raw.githubusercontent.com/DDzhp/ICkamuban/main/icå¡å…¥åº“æ¨¡æ¿.xls',
            templateName: 'icå¡å…¥åº“æ¨¡æ¿.xls',
            // å¤šä¸ªå¤‡ç”¨URLï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
            fallbackUrls: [
                'https://DDzhp.github.io/ICkamuban/icå¡å…¥åº“æ¨¡æ¿.xls',  // GitHub Pages
                'https://raw.githubusercontent.com/DDzhp/ICkamuban/main/icå¡å…¥åº“æ¨¡æ¿.xls',  // Gitee Pages
                'https://cdn.jsdelivr.net/gh/DDzhp/ICkamuban/icå¡å…¥åº“æ¨¡æ¿.xls',  // jsDelivr CDN
                'https://your-username.coding.net/p/your-project/d/your-repo/git/raw/master/icå¡å…¥åº“æ¨¡æ¿.xls'  // Coding.net
            ]
        };
        
        // ä»è¿œç¨‹URLåŠ è½½æ¨¡æ¿æ–‡ä»¶ï¼ˆæ”¯æŒå¤šé‡å¤‡ç”¨ï¼‰
        async function loadRemoteTemplate() {
            const statusDiv = document.getElementById('templateStatus');
            const { templateUrl, templateName, fallbackUrls } = remoteTemplateConfig;
            
            statusDiv.innerHTML = 'ğŸ”„ æ­£åœ¨ä»è¿œç¨‹æœåŠ¡å™¨åŠ è½½æ¨¡æ¿...';
            
            // æ‰€æœ‰è¦å°è¯•çš„URLåˆ—è¡¨
            const urlsToTry = [templateUrl, ...fallbackUrls];
            let lastError = null;
            
            for (let i = 0; i < urlsToTry.length; i++) {
                const currentUrl = urlsToTry[i];
                if (!currentUrl || currentUrl.includes('your-username')) {
                    continue; // è·³è¿‡æœªé…ç½®çš„URL
                }
                
                try {
                    statusDiv.innerHTML = `ğŸ”„ æ­£åœ¨å°è¯•ç¬¬${i + 1}ä¸ªæœåŠ¡å™¨: ${getServerName(currentUrl)}...`;
                    
                    const response = await fetch(currentUrl, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'default'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    // è·å–æ–‡ä»¶æ•°æ®
                    const arrayBuffer = await response.arrayBuffer();
                    const data = new Uint8Array(arrayBuffer);
                    
                    // ä½¿ç”¨XLSXè¯»å–æ¨¡æ¿
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // éªŒè¯å·¥ä½œç°¿
                    if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) {
                        throw new Error('æ¨¡æ¿æ–‡ä»¶æ ¼å¼æ— æ•ˆ');
                    }
                    
                    // å­˜å‚¨æ¨¡æ¿å·¥ä½œç°¿å’Œæ¥æºä¿¡æ¯
                    loadedTemplates.set(templateName, {
                        workbook: workbook,
                        fileName: templateName,
                        fileData: data,
                        source: `${getServerName(currentUrl)} - ${currentUrl}`,
                        loadedAt: new Date().toISOString()
                    });
                    
                    statusDiv.innerHTML = `âœ… è¿œç¨‹æ¨¡æ¿åŠ è½½æˆåŠŸ: ${templateName}<br>` +
                        `ğŸ“Š åŒ…å« ${workbook.SheetNames.length} ä¸ªå·¥ä½œè¡¨<br>` +
                        `ğŸŒ æ¥æº: ${getServerName(currentUrl)} (ç¬¬${i + 1}ä¸ªæœåŠ¡å™¨)<br>` +
                        `ğŸ”— å½“å‰URL: <code style="font-size:11px;color:#666;">${currentUrl}</code>`;
                    
                    console.log('è¿œç¨‹æ¨¡æ¿åŠ è½½æˆåŠŸ:', {
                        name: templateName,
                        sheets: workbook.SheetNames,
                        size: `${(data.length / 1024).toFixed(2)}KB`,
                        source: currentUrl
                    });
                    
                    // å¯ç”¨å¤„ç†æŒ‰é’®
                    updateProcessButton();
                    
                    return; // æˆåŠŸåé€€å‡º
                    
                } catch (error) {
                    lastError = error;
                    console.warn(`ç¬¬${i + 1}ä¸ªæœåŠ¡å™¨å¤±è´¥:`, currentUrl, error.message);
                    
                    if (i < urlsToTry.length - 1) {
                        statusDiv.innerHTML = `âš ï¸ ${getServerName(currentUrl)}å¤±è´¥ï¼Œæ­£åœ¨å°è¯•ä¸‹ä¸€ä¸ªæœåŠ¡å™¨...`;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
                    }
                }
            }
            
            // æ‰€æœ‰URLéƒ½å¤±è´¥
            console.error('æ‰€æœ‰è¿œç¨‹æ¨¡æ¿åŠ è½½å¤±è´¥:', lastError);
            statusDiv.innerHTML = `âŒ æ‰€æœ‰è¿œç¨‹æ¨¡æ¿éƒ½åŠ è½½å¤±è´¥<br>` +
                `ğŸ“ è¯·æ£€æŸ¥ä»¥ä¸‹äº‹é¡¹ï¼š<br>` +
                `â€¢ ç¡®ä¿æ¨¡æ¿æ–‡ä»¶å·²æ­£ç¡®ä¸Šä¼ <br>` +
                `â€¢ æ£€æŸ¥URLé…ç½®æ˜¯å¦æ­£ç¡®<br>` +
                `â€¢ ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸<br>` +
                `â€¢ å°è¯•ä½¿ç”¨ä¸‹é¢çš„æ›¿ä»£æ–¹æ¡ˆ<br>` +
                `ğŸ”— å°è¯•çš„URLåˆ—è¡¨: <details><summary>ç‚¹å‡»æŸ¥çœ‹</summary><pre style="font-size:10px;">${urlsToTry.filter(url => url && !url.includes('your-username')).join('\n')}</pre></details>`;
            
            // ç¦ç”¨å¤„ç†æŒ‰é’®
            updateProcessButton();
        }
        
        // è·å–æœåŠ¡å™¨åç§°
        function getServerName(url) {
            if (url.includes('github.io')) return 'GitHub Pages';
            if (url.includes('gitee.io')) return 'Gitee Pages';
            if (url.includes('coding.net')) return 'Coding.net';
            if (url.includes('jsdelivr.net')) return 'jsDelivr CDN';
            if (url.includes('githubusercontent.com')) return 'GitHub Raw';
            return 'æœªçŸ¥æœåŠ¡å™¨';
        }
        
        // å·¥å…·åˆ‡æ¢å‡½æ•°
        function showTool(toolId) {
            document.querySelectorAll('.calculator').forEach(tool => {
                tool.style.display = 'none';
            });
            
            document.getElementById(toolId).style.display = 'block';
            
            document.querySelectorAll('.tool-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            // æ‰¾åˆ°å¯¹åº”çš„æŒ‰é’®å¹¶æ·»åŠ activeç±»
            const activeButton = document.querySelector(`.tool-switcher button[onclick="showTool('${toolId}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }

        // ===== Excelæ¨¡æ¿å¤„ç†ç›¸å…³å‡½æ•° =====
        
        // åŠ è½½æ¨¡æ¿æ–‡ä»¶åˆ—è¡¨
        const templatePath = 'icå¡å…¥åº“æ¨¡æ¿.xls';
        // åŠ è½½æŒ‡å®šè·¯å¾„çš„æ¨¡æ¿
        async function loadSpecificTemplate() {
            const templateName = 'icå¡å…¥åº“æ¨¡æ¿.xls';
            const statusDiv = document.getElementById('templateStatus');
            
            try {
                // é¦–å…ˆå°è¯•ä»æŒ‡å®šç»å¯¹è·¯å¾„åŠ è½½æ¨¡æ¿æ–‡ä»¶
                let response;
                let usedPath;
                
                try {
                    response = await fetch(templatePath);
                    usedPath = templatePath;
                } catch (error) {
                    // ç»å¯¹è·¯å¾„å¤±è´¥ï¼Œå°è¯•ç›¸å¯¹è·¯å¾„
                    response = await fetch(templateName);
                    usedPath = templateName;
                }
                
                if (!response.ok) {
                    throw new Error(`æ— æ³•åŠ è½½æ¨¡æ¿æ–‡ä»¶: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // å­˜å‚¨æ¨¡æ¿å·¥ä½œç°¿
                loadedTemplates.set(templateName, {
                    workbook: workbook,
                    fileName: templateName,
                    fileData: data
                });
                
                statusDiv.innerHTML = `âœ… å·²æˆåŠŸåŠ è½½æ¨¡æ¿: ${usedPath}`;
                
            } catch (error) {
                console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', error);
                statusDiv.innerHTML = `âš ï¸ åŠ è½½æ¨¡æ¿å¤±è´¥: ${error.message}<br>è¯·ç¡®ä¿æœ¬åœ°æœåŠ¡å™¨è¿è¡Œä¸”æ¨¡æ¿æ–‡ä»¶å¯è®¿é—®: ${templatePath}`;
            }
        }
        async function loadTemplateList() {
            // å¦‚æœå·²ç»æœ‰åŠ è½½çš„æ¨¡æ¿ï¼Œæ˜¾ç¤ºå®ƒä»¬
            if (loadedTemplates.size > 0) {
                renderTemplateOptions();
            } else {
                // æç¤ºç”¨æˆ·åŠ è½½æ¨¡æ¿
                const statusDiv = document.getElementById('excelProcessStatus');
                statusDiv.innerHTML = 'è¯·ç‚¹å‡»â€œåŠ è½½æ¨¡æ¿æ–‡ä»¶å¤¹â€æŒ‰é’®æ¥é€‰æ‹©æ¨¡æ¿æ–‡ä»¶';
            }
        }
        
        // å¤„ç†æ¨¡æ¿æ–‡ä»¶ä¸Šä¼ 
        function handleTemplateUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('excelProcessStatus');
            statusDiv.innerHTML = 'æ­£åœ¨åŠ è½½æ¨¡æ¿æ–‡ä»¶...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    templateWorkbook = XLSX.read(data, { type: 'array' });
                    
                    // æ›´æ–°é€‰æ‹©æ¡†æ˜¾ç¤ºå·²ä¸Šä¼ çš„æ¨¡æ¿
                    const select = document.getElementById('templateSelect');
                    const uploadedOption = document.createElement('option');
                    uploadedOption.value = 'uploaded';
                    uploadedOption.textContent = `ğŸ“„ ${file.name} (å·²ä¸Šä¼ )`;
                    uploadedOption.selected = true;
                    
                    // ç§»é™¤ä¹‹å‰çš„ä¸Šä¼ é€‰é¡¹
                    const existingUploaded = select.querySelector('option[value="uploaded"]');
                    if (existingUploaded) {
                        existingUploaded.remove();
                    }
                    
                    select.appendChild(uploadedOption);
                    
                    statusDiv.innerHTML = `æ¨¡æ¿æ–‡ä»¶ "${file.name}" åŠ è½½æˆåŠŸ`;
                    updateProcessButton();
                    
                } catch (error) {
                    statusDiv.innerHTML = `æ¨¡æ¿æ–‡ä»¶åŠ è½½å¤±è´¥: ${error.message}`;
                    templateWorkbook = null;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // è¯»å–Excelæ–‡ä»¶
        function readExcelFile(file) {
            const statusDiv = document.getElementById('excelProcessStatus');
            const previewDiv = document.getElementById('excelDataPreview');
            
            // ä¿å­˜ä¸Šä¼ æ–‡ä»¶å
            uploadedFileName = file.name;
            
            statusDiv.innerHTML = 'æ­£åœ¨è¯»å–Excelæ–‡ä»¶...';
            previewDiv.innerHTML = 'æ­£åœ¨è§£ææ–‡ä»¶å†…å®¹...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½¬æ¢ä¸ºJSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    excelData = jsonData;
                    analyzeExcelData(jsonData);
                    
                } catch (error) {
                    statusDiv.innerHTML = `è¯»å–æ–‡ä»¶å¤±è´¥: ${error.message}`;
                    previewDiv.innerHTML = 'æ–‡ä»¶è§£æå¤±è´¥';
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // åˆ†æExcelæ•°æ®
        function analyzeExcelData(data) {
            const statusDiv = document.getElementById('excelProcessStatus');
            const previewDiv = document.getElementById('excelDataPreview');
            
            try {
                if (!data || data.length === 0) {
                    statusDiv.innerHTML = 'æ–‡ä»¶ä¸ºç©ºæˆ–æ— æœ‰æ•ˆæ•°æ®';
                    return;
                }
                
                let startRow = 0;
                let waterCardCol = -1;
                let serialCol = -1;
                
                // æ£€æŸ¥é¦–è¡Œæ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
                const firstRow = data[0] || [];
                const hasChineseInFirstRow = firstRow.some(cell => 
                    cell && /[\u4e00-\u9fa5]/.test(cell.toString())
                );
                
                if (hasChineseInFirstRow) {
                    startRow = 1;
                    statusDiv.innerHTML = 'æ£€æµ‹åˆ°é¦–è¡ŒåŒ…å«ä¸­æ–‡ï¼Œå°†ä»ç¬¬äºŒè¡Œå¼€å§‹å¤„ç†';
                } else {
                    startRow = 0;
                    statusDiv.innerHTML = 'é¦–è¡Œä¸åŒ…å«ä¸­æ–‡ï¼Œä»ç¬¬ä¸€è¡Œå¼€å§‹å¤„ç†';
                }
                
                // åˆ†æAã€Båˆ—æ•°æ®ç±»å‹
                const sampleSize = Math.min(10, data.length - startRow);
                let colAHasLetters = false;
                let colBHasLetters = false;
                
                for (let i = startRow; i < startRow + sampleSize && i < data.length; i++) {
                    const row = data[i];
                    if (row && row.length >= 2) {
                        const cellA = row[0] ? row[0].toString() : '';
                        const cellB = row[1] ? row[1].toString() : '';
                        
                        if (/[a-zA-Z]/.test(cellA)) colAHasLetters = true;
                        if (/[a-zA-Z]/.test(cellB)) colBHasLetters = true;
                    }
                }
                
                // æ ¹æ®è§„åˆ™ç¡®å®šåˆ—ç±»å‹
                if (colAHasLetters && !colBHasLetters) {
                    waterCardCol = 0;
                    serialCol = 1;
                } else if (colBHasLetters && !colAHasLetters) {
                    waterCardCol = 1;
                    serialCol = 0;
                } else if (colAHasLetters && colBHasLetters) {
                    // ä¸¤åˆ—éƒ½æœ‰å­—æ¯ï¼Œé»˜è®¤Aåˆ—ä¸ºæ°´å¡å·
                    waterCardCol = 0;
                    serialCol = 1;
                } else {
                    // éƒ½æ˜¯çº¯æ•°å­—ï¼Œé»˜è®¤Aåˆ—ä¸ºæµæ°´å·ï¼ŒBåˆ—ä¸ºæ°´å¡å·
                    serialCol = 0;
                    waterCardCol = 1;
                }
                
                // æå–æ•°æ®
                const waterCards = [];
                const serials = [];
                
                for (let i = startRow; i < data.length; i++) {
                    const row = data[i];
                    if (row && row.length >= 2) {
                        if (waterCardCol >= 0 && row[waterCardCol]) {
                            waterCards.push(row[waterCardCol].toString());
                        }
                        if (serialCol >= 0 && row[serialCol]) {
                            serials.push(row[serialCol].toString());
                        }
                    }
                }
                
                parsedData = {
                    waterCardNumbers: waterCards,
                    serialNumbers: serials
                };
                
                // æ˜¾ç¤ºé¢„è§ˆ
                let preview = `<h4>æ•°æ®è§£æç»“æœï¼š</h4>`;
                preview += `<p>å¼€å§‹è¡Œï¼šç¬¬${startRow + 1}è¡Œ</p>`;
                preview += `<p>æ°´å¡å·åˆ—ï¼š${String.fromCharCode(65 + waterCardCol)}åˆ— (${waterCards.length}æ¡)</p>`;
                preview += `<p>æµæ°´å·åˆ—ï¼š${String.fromCharCode(65 + serialCol)}åˆ— (${serials.length}æ¡)</p>`;
                
                preview += `<table class="data-table">`;
                preview += `<tr><th>åºå·</th><th>æ°´å¡å·</th><th>æµæ°´å·</th></tr>`;
                
                const maxRows = Math.min(10, Math.max(waterCards.length, serials.length));
                for (let i = 0; i < maxRows; i++) {
                    preview += `<tr>`;
                    preview += `<td>${i + 1}</td>`;
                    preview += `<td>${waterCards[i] || ''}</td>`;
                    preview += `<td>${serials[i] || ''}</td>`;
                    preview += `</tr>`;
                }
                
                if (Math.max(waterCards.length, serials.length) > 10) {
                    preview += `<tr><td colspan="3">... è¿˜æœ‰ ${Math.max(waterCards.length, serials.length) - 10} è¡Œæ•°æ®</td></tr>`;
                }
                
                preview += `</table>`;
                
                previewDiv.innerHTML = preview;
                statusDiv.innerHTML = `æ•°æ®è§£æå®Œæˆï¼å…±è¯†åˆ«åˆ° ${waterCards.length} ä¸ªæ°´å¡å·å’Œ ${serials.length} ä¸ªæµæ°´å·`;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateProcessButton();
                
            } catch (error) {
                statusDiv.innerHTML = `æ•°æ®åˆ†æå¤±è´¥: ${error.message}`;
                previewDiv.innerHTML = 'æ•°æ®åˆ†æå¤±è´¥';
            }
        }
        
        // å¤„ç†Excelæ–‡ä»¶
        async function processExcelFile() {
            const statusDiv = document.getElementById('excelProcessStatus');
            const templateName = document.getElementById('templateSelect').value;
            
            if (!excelData || !templateName) {
                statusDiv.innerHTML = 'è¯·ç¡®ä¿å·²ä¸Šä¼ æ–‡ä»¶å¹¶é€‰æ‹©æ¨¡æ¿';
                return;
            }
            
            if (!loadedTemplates.has(templateName)) {
                statusDiv.innerHTML = 'é€‰ä¸­çš„æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°åŠ è½½æ¨¡æ¿';
                return;
            }
            
            try {
                statusDiv.innerHTML = 'ğŸ”„ æ­£åœ¨ä½¿ç”¨æ¨¡æ¿å¤„ç†æ•°æ®...';
                
                // è·å–æ¨¡æ¿å·¥ä½œç°¿å’Œæ¥æºä¿¡æ¯
                const templateInfo = loadedTemplates.get(templateName);
                const templateWorkbook = templateInfo.workbook;
                const templateSource = templateInfo.source || 'æœ¬åœ°ç¼“å­˜';
                
                // ä½¿ç”¨æ¨¡æ¿å¤„ç†æ•°æ®
                const result = await processWithTemplate(templateWorkbook, templateName, templateSource);
                
                if (result.success) {
                    statusDiv.innerHTML = `âœ… æ–‡ä»¶å¤„ç†å®Œæˆï¼<br>` +
                        `â€¢ ä½¿ç”¨æ¨¡æ¿ï¼š${templateName}<br>` +
                        `â€¢ æ¨¡æ¿æ¥æºï¼š${templateSource}<br>` +
                        `â€¢ å·²ä¸‹è½½æ–‡ä»¶ï¼š${result.filename}<br>` +
                        `â€¢ æ°´å¡å·ï¼š${parsedData.waterCardNumbers.length}æ¡ï¼Œæµæ°´å·ï¼š${parsedData.serialNumbers.length}æ¡<br>` +
                        `â€¢ æ•°æ®å·²å¡«å…¥æ¨¡æ¿Aåˆ—å’ŒBåˆ—ï¼ˆä»A2ã€B2å¼€å§‹ï¼‰`;
                } else {
                    statusDiv.innerHTML = `âŒ å¤„ç†å¤±è´¥ï¼š${result.error}`;
                }
                
            } catch (error) {
                statusDiv.innerHTML = `âŒ å¤„ç†å¤±è´¥: ${error.message}`;
                console.error('å¤„ç†Excelæ–‡ä»¶å¤±è´¥:', error);
            }
        }
        
        // ä½¿ç”¨æ¨¡æ¿å¤„ç†æ•°æ®
        async function processWithTemplate(templateWorkbook, templateName, templateSource) {
            try {
                // å…‹éš†æ¨¡æ¿å·¥ä½œç°¿
                const newWorkbook = XLSX.utils.book_new();
                
                // å¤åˆ¶æ¨¡æ¿çš„æ‰€æœ‰å·¥ä½œè¡¨
                templateWorkbook.SheetNames.forEach(sheetName => {
                    const originalSheet = templateWorkbook.Sheets[sheetName];
                    
                    // å¤åˆ¶åŸå·¥ä½œè¡¨çš„æ•°æ®
                    const sheetData = XLSX.utils.sheet_to_json(originalSheet, { header: 1, defval: '' });
                    
                    // åœ¨A2å’ŒB2ä½ç½®å¼€å§‹å¡«å…¥æ•°æ®
                    const maxRows = Math.max(parsedData.waterCardNumbers.length, parsedData.serialNumbers.length);
                    
                    // ç¡®ä¿æœ‰è¶³å¤Ÿçš„è¡Œæ•°
                    while (sheetData.length < maxRows + 1) {
                        sheetData.push([]);
                    }
                    
                    // å¡«å…¥æ•°æ®åˆ°Aåˆ—å’ŒBåˆ—ï¼ˆä»A2ã€B2å¼€å§‹ï¼‰
                    for (let i = 0; i < maxRows; i++) {
                        const rowIndex = i + 1; // ä»ç¬¬2è¡Œå¼€å§‹ï¼ˆ0-basedç´¢å¼•ï¼‰
                        
                        // ç¡®ä¿è¡Œå­˜åœ¨
                        if (!sheetData[rowIndex]) {
                            sheetData[rowIndex] = [];
                        }
                        
                        // å¡«å…¥Aåˆ—ï¼ˆæ°´å¡å·ï¼‰
                        if (parsedData.waterCardNumbers[i]) {
                            sheetData[rowIndex][0] = parsedData.waterCardNumbers[i];
                        }
                        
                        // å¡«å…¥Båˆ—ï¼ˆæµæ°´å·ï¼‰
                        if (parsedData.serialNumbers[i]) {
                            sheetData[rowIndex][1] = parsedData.serialNumbers[i];
                        }
                    }
                    
                    // åˆ›å»ºæ–°çš„å·¥ä½œè¡¨
                    const newSheet = XLSX.utils.aoa_to_sheet(sheetData);
                    
                    // å¤åˆ¶åŸå§‹å·¥ä½œè¡¨çš„å…¶ä»–å±æ€§ï¼ˆå¦‚åˆ—å®½ã€æ ¼å¼ç­‰ï¼‰
                    if (originalSheet['!cols']) {
                        newSheet['!cols'] = originalSheet['!cols'];
                    }
                    if (originalSheet['!rows']) {
                        newSheet['!rows'] = originalSheet['!rows'];
                    }
                    if (originalSheet['!merges']) {
                        newSheet['!merges'] = originalSheet['!merges'];
                    }
                    
                    XLSX.utils.book_append_sheet(newWorkbook, newSheet, sheetName);
                });
                
                // ç”Ÿæˆæ–‡ä»¶å¹¶ä¸‹è½½
                const originalName = uploadedFileName;
                const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.xlsx';
                const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                const filename = `${baseName}_å·²å¤„ç†${extension}`;
                XLSX.writeFile(newWorkbook, filename);
                
                return {
                    success: true,
                    filename: filename,
                    templateSource: templateSource
                };
                
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        // ä½¿ç”¨é»˜è®¤æ¨¡æ¿å¤„ç†
        function processWithDefaultTemplate() {
            const statusDiv = document.getElementById('excelProcessStatus');
            
            try {
                // åˆ›å»ºæ–°çš„å·¥ä½œç°¿
                const newWorkbook = XLSX.utils.book_new();
                
                // åˆ›å»ºå·¥ä½œè¡¨æ•°æ®
                const wsData = [];
                
                // æ·»åŠ æ ‡é¢˜è¡Œ
                wsData.push(['æ°´å¡å·', 'æµæ°´å·']);
                
                // æ·»åŠ æ•°æ®è¡Œ
                const maxRows = Math.max(parsedData.waterCardNumbers.length, parsedData.serialNumbers.length);
                for (let i = 0; i < maxRows; i++) {
                    wsData.push([
                        parsedData.waterCardNumbers[i] || '',
                        parsedData.serialNumbers[i] || ''
                    ]);
                }
                
                // åˆ›å»ºå·¥ä½œè¡¨
                const worksheet = XLSX.utils.aoa_to_sheet(wsData);
                
                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(newWorkbook, worksheet, 'Sheet1');
                
                // ç”Ÿæˆæ–‡ä»¶å¹¶ä¸‹è½½
                const originalName = uploadedFileName;
                const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.xlsx';
                const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                const filename = `${baseName}å·²å¤„ç†${extension}`;
                XLSX.writeFile(newWorkbook, filename);
                
                statusDiv.innerHTML = `æ–‡ä»¶å¤„ç†å®Œæˆï¼<br>` +
                    `â€¢ ä½¿ç”¨é»˜è®¤æ¨¡æ¿<br>` +
                    `â€¢ å·²ä¸‹è½½æ–‡ä»¶ï¼š${filename}<br>` +
                    `â€¢ æ°´å¡å·ï¼š${parsedData.waterCardNumbers.length}æ¡ï¼Œæµæ°´å·ï¼š${parsedData.serialNumbers.length}æ¡`;
                
            } catch (error) {
                statusDiv.innerHTML = `é»˜è®¤æ¨¡æ¿å¤„ç†å¤±è´¥: ${error.message}`;
            }
        }
        
        // æ¸…ç©ºæ•°æ®
        function clearExcelData() {
            excelData = null;
            parsedData = { waterCardNumbers: [], serialNumbers: [] };
            uploadedFileName = '';
            templateWorkbook = null;
            document.getElementById('excelFileInput').value = '';
            document.getElementById('templateSelect').value = '';
            document.getElementById('templateFileInput').value = '';
            
            // ç§»é™¤ä¸Šä¼ çš„æ¨¡æ¿é€‰é¡¹
            const select = document.getElementById('templateSelect');
            const uploadedOption = select.querySelector('option[value="uploaded"]');
            if (uploadedOption) {
                uploadedOption.remove();
            }
            
            document.getElementById('excelProcessStatus').innerHTML = 'è¯·ä¸Šä¼ Excelæ–‡ä»¶å¹¶é€‰æ‹©æ¨¡æ¿';
            document.getElementById('excelDataPreview').innerHTML = 'ç­‰å¾…æ–‡ä»¶ä¸Šä¼ ...';
            updateProcessButton();
        }
        
        // æ›´æ–°å¤„ç†æŒ‰é’®çŠ¶æ€
        function updateProcessButton() {
            const hasFile = excelData !== null;
            const hasTemplate = document.getElementById('templateSelect').value !== '' && loadedTemplates.has('icå¡å…¥åº“æ¨¡æ¿.xls');
            const processButton = document.querySelector('#excelTemplateTool .btn-primary');
            processButton.disabled = !(hasFile && hasTemplate);
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬æ˜¾ç¤ºå½“å‰çŠ¶æ€
            if (processButton.disabled) {
                if (!hasFile) {
                    processButton.textContent = 'ğŸ“Š è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶';
                } else if (!hasTemplate) {
                    processButton.textContent = 'ğŸ“Š æ­£åœ¨åŠ è½½æ¨¡æ¿...';
                }
            } else {
                processButton.textContent = 'ğŸ“Š å¤„ç†Excelæ–‡ä»¶';
            }
        }

        // åè¿›åˆ¶è½¬åå…­è¿›åˆ¶å‡½æ•°
        function convertDecToHex() {
            const decimalValue = document.getElementById('decimalInput').value;
            if (/^\d+$/.test(decimalValue)) {
                const hex = parseInt(decimalValue).toString(16).toUpperCase();
                document.getElementById('hexInput').value = hex;
                showMessage(`å·²æˆåŠŸè½¬æ¢ ${decimalValue} ä¸ºåå…­è¿›åˆ¶ ${hex}`, 'success');
            } else if (decimalValue.trim()) {
                document.getElementById('hexInput').value = '';
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„åè¿›åˆ¶æ•°å­—', 'error');
            }
        }

        // åå…­è¿›åˆ¶è½¬åè¿›åˆ¶å‡½æ•°
        function convertHexToDec() {
            const hexValue = document.getElementById('hexInput').value;
            if (/^[0-9A-Fa-f]+$/.test(hexValue)) {
                const decimal = parseInt(hexValue, 16);
                document.getElementById('decimalInput').value = decimal;
                showMessage(`å·²æˆåŠŸè½¬æ¢åå…­è¿›åˆ¶ ${hexValue.toUpperCase()} ä¸ºåè¿›åˆ¶ ${decimal}`, 'success');
            } else if (hexValue.trim()) {
                document.getElementById('decimalInput').value = '';
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„åå…­è¿›åˆ¶æ•°å­—ï¼ˆ0-9, A-Fï¼‰', 'error');
            }
        }

        // è„‰å†²è®¡ç®—ä¸»å‡½æ•°
        function calculateActualPulses() {
            const systemPulses = parseFloat(document.getElementById('systemPulses').value);
            const systemWater = parseFloat(document.getElementById('systemWater').value);
            const actualWater = parseFloat(document.getElementById('actualWater').value);
            
            if (isNaN(systemPulses) || isNaN(systemWater) || isNaN(actualWater)) {
                document.getElementById('actualPulses').value = '';
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—', 'error');
                return;
            }
            
            if (systemPulses > 0 && systemWater > 0 && actualWater > 0) {
                const actualPulses = (systemPulses * systemWater) / actualWater;
                document.getElementById('actualPulses').value = actualPulses.toFixed(2);
                showMessage('è„‰å†²è®¡ç®—æˆåŠŸ', 'success');
            } else {
                document.getElementById('actualPulses').value = '';
                if (systemPulses <= 0 || isNaN(systemPulses)) {
                    showMessage('è¯·è¾“å…¥å¤§äº0çš„ç³»ç»Ÿè„‰å†²æ•°', 'error');
                } else if (systemWater <= 0 || isNaN(systemWater)) {
                    showMessage('è¯·è¾“å…¥å¤§äº0çš„ç³»ç»Ÿæ°´é‡', 'error');
                } else if (actualWater <= 0 || isNaN(actualWater)) {
                    showMessage('è¯·è¾“å…¥å¤§äº0çš„å®é™…æ°´é‡', 'error');
                }
            }
        }


        // å…¥åº“å‚æ•°è§£æå‡½æ•°ï¼ˆå®Œå–„ç‰ˆï¼‰
        function parseParams() {
            const inputText = document.getElementById('paramInput').value;
            
            // åˆ›å»ºç»“æœå¯¹è±¡
            const result = {
                rawItems: [],
                formattedItems: [],
                jsonData: {}
            };
        
            // æ–°å¢å…¬å¸åç§°åŒ¹é…è§„åˆ™
            const companyMatch = inputText.match(/^([\s\S]*?)\s*è·ƒé¾™/);
            let processedText = inputText;
            const rawItems = [];
            const formattedItems = [];
        
            // æå–å…¬å¸åç§°
            if (companyMatch) {
                const company = companyMatch[1].trim().replace(/\s+/g, ' ');
                rawItems.push(`å…¬å¸=${company}`);
                formattedItems.push(`å…¬å¸ï¼š${company}`);
                processedText = processedText.replace(companyMatch[0], ''); // ç§»é™¤å·²åŒ¹é…å†…å®¹
            }
        
            // ä¼˜åŒ–è·ƒé¾™ç±»å‹åˆ¤æ–­é€»è¾‘
            const yuelongTypes = [
                { pattern: 'è·ƒé¾™æ–°ç§æœ‰', value: 'æ–°ç§æœ‰' },
                { pattern: 'è·ƒé¾™å…¬æœ‰å”®æ°´æœº', value: 'å…¬æœ‰å”®æ°´æœº' },
                { pattern: 'è·ƒé¾™æ–°å…¬æœ‰', value: 'æ–°å…¬æœ‰' },
                { pattern: 'è·ƒé¾™å…¬æœ‰', value: 'å…¬æœ‰' },
                { pattern: 'è·ƒé¾™ç§æœ‰', value: 'ç§æœ‰' }
            ];
            
            // ä¿®æ”¹ä¸ºä½¿ç”¨åŸå§‹è¾“å…¥æ–‡æœ¬åˆ¤æ–­
            yuelongTypes.forEach(type => {
                if (inputText.includes(type.pattern)) {
                    rawItems.push(`è·ƒé¾™ç±»å‹=${type.value}`);
                    formattedItems.push(`è·ƒé¾™ç±»å‹ï¼š${type.value}`);
                }
            });

            // ä¼˜åŒ–ICCIDåŒ¹é…
            const iccidMatches = [...processedText.matchAll(/(89860[\dA-Za-z]{14,18})/g)];
            const iccids = iccidMatches.map(m => m[0]);
            
            // åªå¤„ç†ç¬¬ä¸€ä¸ªICCID
            if (iccids.length > 0) {
                rawItems.push(`ICCIDå¼€å§‹=${iccids[0]}`);
                formattedItems.push(`ICCIDå¼€å§‹ï¼š${iccids[0]}`);
            }
            // ç§»é™¤æ‰€æœ‰ICCID
            iccids.forEach(iccid => {
                processedText = processedText.replace(iccid, '');
            });

            // ä¼˜åŒ–åçš„æ•°é‡æå–è§„åˆ™ï¼ˆæ”¯æŒä¸­æ–‡ç¬¦å·é—´éš”ï¼‰
            const quantityMatch = processedText.match(/(\d+)\s*å¼ (?=\D*$)/);
            if (quantityMatch) {
                rawItems.push(`æ•°é‡=${quantityMatch[1]}`);
                formattedItems.push(`æ•°é‡ï¼š${quantityMatch[1]}`);
                processedText = processedText.replace(quantityMatch[0], '');
            }
        
            // æ–°å¢é¢„å¤„ç†ï¼šè¿‡æ»¤"å…¶ä¸­"ç›¸å…³å†…å®¹
            processedText = processedText.replace(/å…¶ä¸­\D*(\d+)[\u4e00-\u9fa5]+/g, '');
        
            // æ–°å¢æ»¤èŠ¯å¯¿å‘½ç±»å‹åˆ¤æ–­
            let filterType = 'ç©º';
            if (/æ—¶é—´/.test(processedText)) {
                filterType = '0æ—¶é—´';
            } else if (/æµé‡/.test(processedText)) {
                filterType = '1æµé‡';
            }
            rawItems.push(`æ»¤èŠ¯å¯¿å‘½ç±»å‹=${filterType}`);
            formattedItems.push(`æ»¤èŠ¯å¯¿å‘½ç±»å‹ï¼š${filterType}`);

            // ä¼˜åŒ–åçš„å‚æ•°è§£æé€»è¾‘ï¼ˆå…¼å®¹è·¯å¾„å’Œæ™®é€šå‚æ•°ï¼‰
            const pattern = /((?:[\u4e00-\u9fa5]+(?:\/[\u4e00-\u9fa5\/\[\]]+)*|[\u4e00-\u9fa5]+))(\d+\.?\d*)/g;
            const matches = [...processedText.matchAll(pattern)];
            
            matches.forEach(match => {
                let title = match[1]
                    .replace(/\[.*?\]/g, '')  // ç§»é™¤å•ä½è¯´æ˜
                    .replace(/\/+/g, '/')     // åˆå¹¶è¿ç»­æ–œæ 
                    .replace(/\/$/, '');     // å»é™¤ç»“å°¾æ–œæ 
                const value = match[2];
        
                // æ–°å¢ä¸­æ–‡å‚æ•°åç§°è¿‡æ»¤
                if(title && value && !/^[\u4e00-\u9fa5]+$/.test(value)) {
                    rawItems.push(`${title}=${value}`);
                    formattedItems.push(`${title}ï¼š${value}`);
                }
            });
        
            // æ˜¾ç¤ºç»“æœï¼ˆä¿®æ”¹è¿™éƒ¨åˆ†ï¼‰
            // å®šä¹‰ä¼˜å…ˆæ˜¾ç¤ºçš„å‚æ•°é¡ºåº
            const priorityParams = [
                { key: 'æ»¤èŠ¯å¯¿å‘½ç±»å‹', default: 'ç©º' },
                { key: 'è„‰å†²', default: null },
                { key: 'å†·æ°´è„‰å†²', default: null },
                { key: 'æ”¾æ°´', default: null },
                { key: 'æ”¾æ°´æ—¶é—´', default: null },
                { key: 'åˆ¶æ°´', default: null },
                { key: 'åˆ¶æ°´æ—¶é—´', default: null },
                { key: 'æ£€ä¿®', default: '0' },
                { key: 'æ£€ä¿®æ—¶é—´', default: '0' }
            ];
        
            // æ£€æŸ¥æ£€ä¿®å‚æ•°çš„ç‰¹æ®Šæƒ…å†µ
            const maintenanceItem = formattedItems.find(item => item.startsWith('æ£€ä¿®ï¼š'));
            const maintenanceTimeItem = formattedItems.find(item => item.startsWith('æ£€ä¿®æ—¶é—´ï¼š'));
            
            // å¦‚æœæ£€ä¿®å’Œæ£€ä¿®æ—¶é—´éƒ½ä¸º0ï¼Œåˆ™åªä¿ç•™æ£€ä¿®
            if (maintenanceItem?.endsWith('ï¼š0') && maintenanceTimeItem?.endsWith('ï¼š0')) {
                formattedItems = formattedItems.filter(item => !item.startsWith('æ£€ä¿®æ—¶é—´ï¼š'));
            }
        
            // æ£€æŸ¥äº’æ–¥å‚æ•°
            const hasPulse = formattedItems.some(item => item.startsWith('è„‰å†²ï¼š'));
            const hasWaterDrain = formattedItems.some(item => item.startsWith('æ”¾æ°´ï¼š'));
            const hasWaterMake = formattedItems.some(item => item.startsWith('åˆ¶æ°´ï¼š'));
            const hasMaintenance = formattedItems.some(item => item.startsWith('æ£€ä¿®ï¼š'));
        
            // è¿‡æ»¤æ‰ä¸éœ€è¦æ˜¾ç¤ºçš„äº’æ–¥å‚æ•°
            const filteredPriorityParams = priorityParams.filter(param => {
                if (hasPulse && param.key === 'å†·æ°´è„‰å†²') return false;
                if (hasWaterDrain && param.key === 'æ”¾æ°´æ—¶é—´') return false;
                if (hasWaterMake && param.key === 'åˆ¶æ°´æ—¶é—´') return false;
                if (hasMaintenance && param.key === 'æ£€ä¿®æ—¶é—´') return false;
                return true;
            });
        
            // åˆ†ç¦»ä¼˜å…ˆæ˜¾ç¤ºå’Œæ™®é€šå‚æ•°
            const priorityResults = [];
            const normalResults = [];
        
            // å¤„ç†ä¼˜å…ˆå‚æ•°
            filteredPriorityParams.forEach(param => {
                const foundItem = formattedItems.find(item => item.startsWith(param.key + 'ï¼š'));
                if (foundItem) {
                    priorityResults.push(foundItem);
                } else if (param.default !== null) {
                    priorityResults.push(`${param.key}ï¼š${param.default}`);
                }
            });
        
            // å¤„ç†æ™®é€šå‚æ•°ï¼ˆè¿‡æ»¤æ‰å·²æ˜¾ç¤ºçš„ä¼˜å…ˆå‚æ•°ï¼‰
            formattedItems.forEach(item => {
                const [key] = item.split('ï¼š');
                if (!priorityParams.some(param => param.key === key)) {
                    normalResults.push(item);
                }
            });
        
            // å¯¹æ™®é€šå‚æ•°æŒ‰é•¿åº¦æ’åºï¼ˆä»çŸ­åˆ°é•¿ï¼‰
            normalResults.sort((a, b) => {
                const aLen = a.split('ï¼š')[1]?.length || 0;
                const bLen = b.split('ï¼š')[1]?.length || 0;
                return aLen - bLen;
            });
        
            // åˆå¹¶ç»“æœ
            const finalResults = [...priorityResults, ...normalResults];
            
            
            // å¦åˆ™æ­£å¸¸æ˜¾ç¤ºç»“æœ
            document.getElementById('formattedParams').innerHTML = finalResults.map((item,index) => {
                const [key, value] = item.split('ï¼š');
                
                return `${index + 1} - ${key}ï¼š<span style="color:red">${value}</span>`;
            }).filter(item => item !== '').join('<br>');
            
            console.log(finalResults,'finalResults')
            
            return result.jsonData;
        }

        // æ·»åŠ ä¸€ä¸ªå…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
        function getParsedParams() {
            return parseParams();
        }
        // å‚æ•°è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('paramInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤æ¢è¡Œè¡Œä¸º
                parseParams();       // è§¦å‘å…¥åº“å‚æ•°è§£æ
                this.blur();        // ç§»é™¤è¾“å…¥æ¡†ç„¦ç‚¹
            }
        });


        // ICCIDè§£æå‡½æ•°
        function parseIccids() {
            const inputText = document.getElementById('iccidInput').value;
            const resultArray = [];
            
            if (!inputText.trim()) {
                showMessage('è¯·è¾“å…¥ICCIDæ•°æ®', 'error');
                return;
            }
            
            // å¤„ç†èŒƒå›´æ ¼å¼ï¼šICCIDåˆ°ICCID(æ•°é‡å¼ )
            const rangePattern = /(\d+[A-Za-z0-9]*)åˆ°(\d+[A-Za-z0-9]*)(?:\s*[\(ï¼ˆ](\d+)å¼ [\)ï¼‰])?/g;
            let match;
            
            // å¤„ç†èŒƒå›´æ ¼å¼
            while ((match = rangePattern.exec(inputText)) !== null) {
                const startIccid = match[1];
                const endIccid = match[2];
                const count = match[3] ? parseInt(match[3]) : null;
                
                // æå–æ•°å­—éƒ¨åˆ†
                const numericStart = extractNumericSuffix(startIccid);
                const numericEnd = extractNumericSuffix(endIccid);
                
                if (numericStart && numericEnd) {
                    const prefix = startIccid.substring(0, startIccid.length - numericStart.length);
                    const startNum = parseInt(numericStart);
                    const endNum = parseInt(numericEnd);
                    
                    // éªŒè¯èŒƒå›´æ˜¯å¦ä¸æŒ‡å®šæ•°é‡åŒ¹é…
                    const actualCount = endNum - startNum + 1;
                    if (count !== null && actualCount !== count) {
                        console.warn(`è­¦å‘Šï¼šæŒ‡å®šæ•°é‡ ${count} ä¸å®é™…èŒƒå›´ ${actualCount} ä¸åŒ¹é…`);
                    }
                    
                    // ç”ŸæˆèŒƒå›´å†…çš„æ‰€æœ‰ICCID
                    for (let i = startNum; i <= endNum; i++) {
                        const paddedNum = i.toString().padStart(numericStart.length, '0');
                        resultArray.push(prefix + paddedNum);
                    }
                } else {
                    console.error('æ— æ³•æå–æ•°å­—éƒ¨åˆ†:', startIccid, endIccid);
                }
            }
            
            // åŒæ—¶å¤„ç†å•è¡ŒICCIDæ ¼å¼ï¼ˆæ— è®ºæ˜¯å¦å·²å¤„ç†èŒƒå›´æ ¼å¼ï¼‰
            // åˆ†å‰²è¾“å…¥æ–‡æœ¬ï¼Œå¤„ç†æ¯ä¸€è¡Œ
            const lines = inputText.split(/[\n\r]+/);
            
            lines.forEach(line => {
                // è·³è¿‡åŒ…å«"åˆ°"çš„è¡Œï¼Œå› ä¸ºè¿™äº›è¡Œå·²ç»åœ¨èŒƒå›´å¤„ç†ä¸­å¤„ç†è¿‡äº†
                if (line.includes('åˆ°')) {
                    return;
                }
                
                // æ¸…ç†æ¯è¡Œï¼Œç§»é™¤å¯èƒ½çš„å¼•å·å’Œç©ºæ ¼
                const cleanedLine = line.trim().replace(/['""`]/g, '');
                
                // å¦‚æœæ˜¯æœ‰æ•ˆçš„ICCIDï¼ˆè‡³å°‘åŒ…å«æ•°å­—å’Œå¯èƒ½çš„å­—æ¯ï¼Œé•¿åº¦å¤§äº10ï¼‰
                if (/^\d+[A-Za-z0-9]*$/.test(cleanedLine) && cleanedLine.length > 10) {
                    resultArray.push(cleanedLine);
                }
            });
            
            // æ˜¾ç¤ºç»“æœï¼Œæ¯è¡Œä¸€ä¸ªICCID
            document.getElementById('iccidResult').value = resultArray.join('\n');
            
            if (resultArray.length > 0) {
                showMessage(`è§£ææˆåŠŸï¼Œå…±æå– ${resultArray.length} ä¸ªICCID`, 'success');
            } else {
                showMessage('æœªæ‰¾åˆ°æœ‰æ•ˆçš„ICCIDæ•°æ®ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼', 'error');
            }
        }
        
        // æå–ICCIDæœ«å°¾çš„æ•°å­—éƒ¨åˆ†
        function extractNumericSuffix(iccid) {
            // å¯¹äºçº¯æ•°å­—ICCIDï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
            if (/^\d+$/.test(iccid)) {
                // å¦‚æœæ˜¯çº¯æ•°å­—ï¼Œå–æœ€å5ä½ä½œä¸ºå˜åŒ–éƒ¨åˆ†
                return iccid.slice(-5);
            } else {
                // å¯¹äºæ··åˆå­—æ¯æ•°å­—çš„ICCIDï¼Œä½¿ç”¨åŸæ¥çš„é€»è¾‘
                const match = iccid.match(/(\d+)$/);
                return match ? match[1] : null;
            }
        }
        
        // ä¿®æ”¹ICCIDæ ¼å¼å‡½æ•°
        function formatIccids() {
            const resultText = document.getElementById('iccidResult').value;
            if (!resultText.trim()) {
                showMessage('è¯·å…ˆè§£æICCIDæ•°æ®', 'error');
                return;
            }
            
            // å°†æ¢è¡Œåˆ†éš”çš„ICCIDè½¬æ¢ä¸ºé€—å·åˆ†éš”
            const iccids = resultText.split('\n').filter(line => line.trim());
            document.getElementById('iccidResult').value = iccids.join(',');
            showMessage('å·²è½¬æ¢ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼', 'success');
        }
        
        // æ¢å¤ICCIDæ ¼å¼å‡½æ•° - åœ¨æ¯ä¸ªICCIDåæ·»åŠ å•å¼•å·
        function addQuotesToIccids() {
            const resultText = document.getElementById('iccidResult').value;
            if (!resultText.trim()) {
                showMessage('è¯·å…ˆè§£æICCIDæ•°æ®', 'error');
                return;
            }
            
            // å¤„ç†ä¸åŒæ ¼å¼çš„ICCID
            let iccids;
            if (resultText.includes(',')) {
                // é€—å·åˆ†éš”çš„æ ¼å¼
                iccids = resultText.split(',').filter(item => item.trim());
                // æ·»åŠ å•å¼•å·å¹¶é‡æ–°ç”¨é€—å·è¿æ¥
                document.getElementById('iccidResult').value = iccids.map(iccid => 
                    iccid.trim().endsWith("'") ? iccid.trim() : iccid.trim() + "'"
                ).join(',');
            } else {
                // æ¢è¡Œåˆ†éš”çš„æ ¼å¼
                iccids = resultText.split('\n').filter(line => line.trim());
                // æ·»åŠ å•å¼•å·å¹¶ä¿æŒæ¢è¡Œæ ¼å¼
                document.getElementById('iccidResult').value = iccids.map(iccid => 
                    iccid.trim().endsWith("'") ? iccid.trim() : iccid.trim() + "'"
                ).join('\n');
            }
            
            showMessage('å·²æ·»åŠ å•å¼•å·ï¼Œé˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼', 'success');
        }

        // é‡‘é¢æ°´é‡æ¢ç®—å‡½æ•°
        function calculateWaterValue() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const waterVolume = parseFloat(document.getElementById('waterVolume').value) || 0;
            const mlPerCent = parseFloat(document.getElementById('pricePerMl').value) || 0;
            
            let results = [];
            
            if (amount > 0 && waterVolume > 0) {
                const calculatedMlPerCent = waterVolume / (amount * 100);
                document.getElementById('pricePerMl').value = calculatedMlPerCent.toFixed(4);
                results.push(`ğŸ§® 1åˆ†é’±å¯¹åº”ï¼š<span style="color:red">${calculatedMlPerCent.toFixed(4)}æ¯«å‡</span>`);
                results.push(`ğŸ’§ ${waterVolume}æ¯«å‡ = <span style="color:red">${amount}å…ƒ</span>`);
            } else if (amount > 0 && mlPerCent > 0) {
                const calculatedVolume = (amount * 100) * mlPerCent;
                document.getElementById('waterVolume').value = calculatedVolume.toFixed(2);
                results.push(`ğŸ’§ æ°´é‡ï¼š<span style="color:red">${calculatedVolume.toFixed(2)}æ¯«å‡</span>`);
            } else if (waterVolume > 0 && mlPerCent > 0) {
                const calculatedAmount = waterVolume / mlPerCent / 100;
                document.getElementById('amount').value = calculatedAmount.toFixed(2);
                results.push(`ğŸ’° é‡‘é¢ï¼š<span style="color:red">${calculatedAmount.toFixed(2)}å…ƒ</span>`);
            } else {
                results.push(`ğŸ“ è¯·è¾“å…¥ä»»æ„ä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—`);
            }
            
            document.getElementById('waterCalculations').innerHTML = results.join('<br>');
        }

        // æ°´å•ä»·è®¡ç®—å‡½æ•°
        function calculateWaterPrice() {
            const waterVolume = parseFloat(document.getElementById('waterVolume2').value) || 0;
            const amount = parseFloat(document.getElementById('amount2').value) || 0;
            const pricePerLiter = parseFloat(document.getElementById('pricePerLiter').value) || 0;
            
            let results = [];
            
            if (waterVolume > 0 && amount > 0) {
                const calculatedPricePerLiter = (amount / waterVolume) * 1000;
                document.getElementById('pricePerLiter').value = calculatedPricePerLiter.toFixed(4);
                results.push(`ğŸš° <strong>è®¡ç®—ç»“æœï¼š1å‡æ°´å•ä»· = <span style="color:red;font-size:18px">${calculatedPricePerLiter.toFixed(4)}å…ƒ/å‡</span></strong>`);
                results.push(`ğŸ“Š è®¡ç®—è¿‡ç¨‹ï¼š${amount}å…ƒ Ã· ${waterVolume}æ¯«å‡ Ã— 1000 = ${calculatedPricePerLiter.toFixed(4)}å…ƒ/å‡`);
            } else if (waterVolume > 0 && pricePerLiter > 0) {
                const calculatedAmount = (waterVolume / 1000) * pricePerLiter;
                document.getElementById('amount2').value = calculatedAmount.toFixed(4);
                results.push(`ğŸ’° <strong>åº”ä»˜é‡‘é¢ï¼š<span style="color:red;font-size:18px">${calculatedAmount.toFixed(4)}å…ƒ</span></strong>`);
            } else if (amount > 0 && pricePerLiter > 0) {
                const calculatedVolume = (amount / pricePerLiter) * 1000;
                document.getElementById('waterVolume2').value = calculatedVolume.toFixed(2);
                results.push(`ğŸ’§ <strong>å¯è´­ä¹°æ°´é‡ï¼š<span style="color:red;font-size:18px">${calculatedVolume.toFixed(2)}æ¯«å‡</span></strong>`);
            } else {
                results.push(`ğŸ“ è¯·è¾“å…¥ä»»æ„ä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—`);
                results.push(`ğŸ’¡ ç¤ºä¾‹ï¼šè¾“å…¥787æ¯«å‡å’Œ0.2385å…ƒï¼Œè‡ªåŠ¨è®¡ç®—1å‡æ°´å•ä»·`);
            }
            
            document.getElementById('waterPriceCalculations').innerHTML = results.join('<br>');
        }

        // CSV/Excelæ–‡ä»¶å¤„ç†ç›¸å…³
        document.getElementById('csvFileInput').addEventListener('change', function() {
            const processButton = document.querySelector('#csv89860Tool button');
            if (this.files.length > 0) {
                processButton.disabled = false;
                document.getElementById('csvProcessStatus').textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${this.files[0].name}`;
            } else {
                processButton.disabled = true;
                document.getElementById('csvProcessStatus').textContent = 'è¯·é€‰æ‹©æ–‡ä»¶è¿›è¡Œå¤„ç†';
            }
        });
        
        function processCSVFile() {
            const fileInput = document.getElementById('csvFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('csvProcessStatus').textContent = 'è¯·å…ˆé€‰æ‹©æ–‡ä»¶';
                return;
            }
            
            document.getElementById('csvProcessStatus').textContent = 'æ­£åœ¨å¤„ç†æ–‡ä»¶...';
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            // æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©å¤„ç†æ–¹æ³•
            if (fileExtension === 'csv') {
                processCSV(file);
            } else if (['xls', 'xlsx'].includes(fileExtension)) {
                processExcel(file);
            } else {
                document.getElementById('csvProcessStatus').textContent = 'ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·é€‰æ‹©CSVã€XLSæˆ–XLSXæ–‡ä»¶';
            }
        }
        
        // å¤„ç†CSVæ–‡ä»¶
        function processCSV(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    let matchCount = 0;
                    
                    // å¤„ç†å¼•å·ä¸­çš„89860å¼€å¤´çš„å€¼
                    let modifiedContent = content;
                    const pattern89860 = /"89860/g;
                    const matches89860 = content.match(pattern89860) || [];
                    modifiedContent = modifiedContent.replace(pattern89860, '"\'89860');
                    matchCount += matches89860.length;
                    
                    // å¤„ç†86å¼€å¤´çš„15ä½æ•°å­—(IMEI)
                    // å…ˆåŒ¹é…å¼•å·ä¸­çš„IMEI
                    const patternIMEIQuoted = /"86\d{13}"/g;
                    const matchesIMEIQuoted = content.match(patternIMEIQuoted) || [];
                    modifiedContent = modifiedContent.replace(patternIMEIQuoted, (match) => {
                        return `"'${match.substring(1, match.length - 1)}"`;
                    });
                    matchCount += matchesIMEIQuoted.length;

                    // å†åŒ¹é…æ²¡æœ‰å¼•å·çš„IMEIï¼ˆé€šå¸¸åœ¨CSVä¸­å‡ºç°ï¼‰
                    const patternIMEIUnquoted = /(^|,|\n)86\d{13}($|,|\n)/g;
                    const matchesIMEIUnquoted = content.match(patternIMEIUnquoted) || [];
                    modifiedContent = modifiedContent.replace(patternIMEIUnquoted, (match) => {
                        // ä¿ç•™åˆ†éš”ç¬¦
                        if (match.startsWith(',') || match.startsWith('\n')) {
                            const prefix = match[0];
                            const imei = match.substring(1, match.length - 1);
                            const suffix = match[match.length - 1];
                            return `${prefix}"${imei}"${suffix}`;
                        } else if (match.endsWith(',') || match.endsWith('\n')) {
                            const prefix = match[0];
                            const imei = match.substring(1, match.length - 1);
                            const suffix = match[match.length - 1];
                            return `${prefix}"${imei}"${suffix}`;
                        } else {
                            const imei = match;
                            return `"${imei}"`;
                        }
                    });
                    matchCount += matchesIMEIUnquoted.length;
                    
                    // å¤„ç†å¯èƒ½è¢«Excelè½¬ä¸ºç§‘å­¦è®¡æ•°æ³•çš„é•¿æ•°å­—
                    // åŒ¹é…å¼•å·ä¸­çš„10ä½ä»¥ä¸Šçº¯æ•°å­—
                    const patternLongNum = /"\d{10,}"/g;
                    const matchesLongNum = content.match(patternLongNum) || [];
                    modifiedContent = modifiedContent.replace(patternLongNum, (match) => {
                        // é¿å…é‡å¤å¤„ç†å·²ç»æ·»åŠ å•å¼•å·çš„å€¼
                        if (!match.includes("'")) {
                            return `"'${match.substring(1, match.length - 1)}"`;
                        }
                        return match;
                    });
                    matchCount += matchesLongNum.length;
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const blob = new Blob(['\ufeff' + modifiedContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    
                    // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
                    const originalName = file.name;
                    const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.csv';
                    const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                    const downloadName = `${baseName}_processed${extension}`;
                    
                    link.setAttribute('href', url);
                    link.setAttribute('download', downloadName);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    document.getElementById('csvProcessStatus').textContent = `å¤„ç†å®Œæˆï¼å…±å¤„ç†äº† ${matchCount} ä¸ªéœ€è¦æ·»åŠ å•å¼•å·çš„å€¼ï¼Œæ–‡ä»¶å·²ä¸‹è½½`;
                    
                    // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
                    document.getElementById('csvFileInput').value = '';
                    document.querySelector('#csv89860Tool button').disabled = true;
                } catch (error) {
                    document.getElementById('csvProcessStatus').textContent = `å¤„ç†å¤±è´¥: ${error.message}`;
                }
            };
            
            reader.onerror = function() {
                document.getElementById('csvProcessStatus').textContent = 'è¯»å–æ–‡ä»¶å¤±è´¥';
            };
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            reader.readAsText(file, 'utf-8');
        }
        
        // å¤„ç†Excelæ–‡ä»¶
        function processExcel(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    let totalProcessedCount = 0;
                    
                    // å¤„ç†æ¯ä¸ªå·¥ä½œè¡¨
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1:A1');
                        
                        let sheetProcessedCount = 0;
                        
                        // éå†æ‰€æœ‰å•å…ƒæ ¼
                        for (let row = range.s.r; row <= range.e.r; row++) {
                            for (let col = range.s.c; col <= range.e.c; col++) {
                                const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                                const cell = worksheet[cellAddress];
                                
                                if (cell && cell.v && typeof cell.v === 'string') {
                                    const originalValue = cell.v;
                                    let modified = false;
                                    
                                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ å•å¼•å·
                                    // å»é™¤å‰åç©ºæ ¼åå†åˆ¤æ–­
                                    const trimmedValue = originalValue.trim();
                                    if (
                                        (trimmedValue.startsWith('89860') || 
                                        (trimmedValue.startsWith('86') && /^86\d{13}$/.test(trimmedValue)) ||
                                        /^\d{10,}$/.test(trimmedValue)) &&
                                        !originalValue.startsWith("'")
                                    ) {
                                        // åœ¨å€¼å‰æ·»åŠ å•å¼•å·ï¼Œå¹¶è®¾ç½®å•å…ƒæ ¼ç±»å‹ä¸ºæ–‡æœ¬
                                        cell.v = `'${originalValue}`;
                                        cell.t = 's'; // è®¾ç½®ä¸ºå­—ç¬¦ä¸²ç±»å‹
                                        modified = true;
                                        sheetProcessedCount++;
                                    }
                                } else if (cell && typeof cell.v === 'number') {
                                    // å¤„ç†æ•°å­—ç±»å‹å€¼
                                    const originalValue = cell.v.toString();
                                    
                                    // æ£€æŸ¥æ˜¯å¦æ˜¯é•¿æ•°å­—ï¼ˆå¯èƒ½è¢«Excelè½¬ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼‰
                                    if (originalValue.length >= 10 && !originalValue.includes('.')) {
                                        // è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ·»åŠ å•å¼•å·
                                        cell.v = `'${originalValue}`;
                                        cell.t = 's'; // è®¾ç½®ä¸ºå­—ç¬¦ä¸²ç±»å‹
                                        modified = true;
                                        sheetProcessedCount++;
                                    }
                                }
                            }
                        }
                        
                        totalProcessedCount += sheetProcessedCount;
                        console.log(`å·¥ä½œè¡¨ ${sheetName} å¤„ç†äº† ${sheetProcessedCount} ä¸ªå•å…ƒæ ¼`);
                    });
                    
                    // ç”Ÿæˆå¤„ç†åçš„æ–‡ä»¶
                    const originalName = file.name;
                    const extension = originalName.lastIndexOf('.') >= 0 ? originalName.slice(originalName.lastIndexOf('.')) : '.xlsx';
                    const baseName = originalName.lastIndexOf('.') >= 0 ? originalName.slice(0, originalName.lastIndexOf('.')) : originalName;
                    const downloadName = `${baseName}_å·²å¤„ç†${extension}`;
                    
                    // ä¸‹è½½æ–‡ä»¶
                    XLSX.writeFile(workbook, downloadName);
                    
                    document.getElementById('csvProcessStatus').textContent = `å¤„ç†å®Œæˆï¼å…±å¤„ç†äº† ${totalProcessedCount} ä¸ªå•å…ƒæ ¼ï¼Œæ–‡ä»¶å·²ä¸‹è½½`;
                    
                    // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
                    document.getElementById('csvFileInput').value = '';
                    document.querySelector('#csv89860Tool button').disabled = true;
                } catch (error) {
                    document.getElementById('csvProcessStatus').textContent = `å¤„ç†å¤±è´¥: ${error.message}`;
                    console.error('Excelå¤„ç†é”™è¯¯:', error);
                }
            };
            
            reader.onerror = function() {
                document.getElementById('csvProcessStatus').textContent = 'è¯»å–æ–‡ä»¶å¤±è´¥';
            };
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            reader.readAsArrayBuffer(file);
        }
        
        // åè¿›åˆ¶è½¬åå…­è¿›åˆ¶å‡½æ•°
        function convertDecToHex() {
            const decimalValue = document.getElementById('decimalInput').value;
            // æ­£åˆ™éªŒè¯åè¿›åˆ¶æ ¼å¼
            if (/^\d+$/.test(decimalValue)) {
                const hex = parseInt(decimalValue)
                          .toString(16)
                          .toUpperCase();
                document.getElementById('hexInput').value = hex;
            } else {
                document.getElementById('hexInput').value = '';
            }
        }
        
        // åå…­è¿›åˆ¶è½¬åè¿›åˆ¶å‡½æ•°
        function convertHexToDec() {
            const hexValue = document.getElementById('hexInput').value;
            // æ­£åˆ™éªŒè¯åå…­è¿›åˆ¶æ ¼å¼ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
            if (/^[0-9A-Fa-f]+$/.test(hexValue)) {
                const decimal = parseInt(hexValue, 16);
                document.getElementById('decimalInput').value = decimal;
            } else {
                document.getElementById('decimalInput').value = '';
            }
        }
        
        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            // è„‰å†²è®¡ç®—å™¨äº‹ä»¶
            document.getElementById('systemPulses').addEventListener('input', calculateActualPulses);
            document.getElementById('systemWater').addEventListener('input', calculateActualPulses);
            document.getElementById('actualWater').addEventListener('input', calculateActualPulses);
            
            // è¿›åˆ¶è½¬æ¢äº‹ä»¶
            document.getElementById('decimalInput').addEventListener('input', convertDecToHex);
            document.getElementById('hexInput').addEventListener('input', convertHexToDec);
        
            // å‚æ•°è§£æå™¨å›è½¦äº‹ä»¶
            document.getElementById('paramInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    parseParams();
                    this.blur();
                }
            });

            
            // Excelæ–‡ä»¶ä¸Šä¼ äº‹ä»¶
            const fileInput = document.getElementById('excelFileInput');
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    readExcelFile(file);
                } else {
                    clearExcelData();
                }
            });
            
            // æ¨¡æ¿é€‰æ‹©äº‹ä»¶
            document.getElementById('templateSelect').addEventListener('change', function(e) {
                if (e.target.value === 'upload') {
                    // è§¦å‘æ¨¡æ¿æ–‡ä»¶ä¸Šä¼ 
                    document.getElementById('templateFileInput').click();
                    // é‡ç½®é€‰æ‹©æ¡†
                    e.target.value = '';
                } else {
                    updateProcessButton();
                }
            });
            
            // åˆå§‹åŒ–ï¼šåŠ è½½è¿œç¨‹æ¨¡æ¿
            loadRemoteTemplate().then(() => {
                console.log('è¿œç¨‹æ¨¡æ¿åˆå§‹åŒ–å®Œæˆ');
                // ç¡®ä¿æŒ‰é’®çŠ¶æ€æ­£ç¡®æ›´æ–°
                updateProcessButton();
            }).catch(error => {
                console.error('è¿œç¨‹æ¨¡æ¿åˆå§‹åŒ–å¤±è´¥:', error);
                // å³ä½¿åŠ è½½å¤±è´¥ä¹Ÿè¦æ›´æ–°æŒ‰é’®çŠ¶æ€
                updateProcessButton();
            });

            // é»˜è®¤æ˜¾ç¤ºICå¡å·å¤„ç†å·¥å…·
            showTool('pulseTool');
        });
    </script>

    <!-- äºŒç»´ç ç”Ÿæˆå™¨å·¥å…·æ¨¡å— -->
    <section id="qrGeneratorTool" class="calculator" style="display: none;">
        <h2>ğŸ”² äºŒç»´ç æ‰¹é‡ç”Ÿæˆå™¨</h2>
        
        <div class="info-box">
            <strong>ğŸ“‹ åŠŸèƒ½è¯´æ˜ï¼š</strong><br>
            1. ä½¿ç”¨ç¨³å®šçš„äºŒç»´ç APIï¼Œæ— è·¨åŸŸé™åˆ¶<br>
            2. è‡ªåŠ¨åœ¨äºŒç»´ç ä¸‹æ–¹æ·»åŠ IMEIæ–‡å­—ï¼Œæ–‡å­—å¤§å°è‡ªé€‚åº”äºŒç»´ç å®½åº¦<br>
            3. è¾“å‡ºä¸º360x360pxæ­£æ–¹å½¢PNGå›¾ç‰‡ï¼Œä¾¿äºæ‰“å°å’Œä½¿ç”¨<br>
            4. æ”¯æŒæ‰¹é‡ç”Ÿæˆå’ŒZIPæ‰“åŒ…ä¸‹è½½ï¼Œç¨³å®šå¯é 
        </div>
        
        <div class="form-group">
            <label for="qrPrefix">äºŒç»´ç å‰ç¼€ï¼š</label>
            <input type="text" id="qrPrefix" placeholder="ä¾‹ï¼šhttp://cloud.yuelongxinxi.com/qr/" value="http://cloud.yuelongxinxi.com/qr/">
        </div>
        
        <div class="form-group">
            <label for="qrImeiList">IMEIåˆ—è¡¨ï¼ˆä¸€è¡Œä¸€ä¸ªï¼‰ï¼š</label>
            <textarea id="qrImeiList" placeholder="è¯·è¾“å…¥IMEIï¼Œä¸€è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;860256072911545&#10;860256072911546&#10;860256072911547"></textarea>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" id="qrGenerateBtn">
                <span id="qrGenerateBtnText">ğŸ”² ç”ŸæˆäºŒç»´ç </span>
                <span id="qrGenerateBtnLoading" class="loading" style="display: none;"></span>
            </button>
            <button class="btn btn-success" id="qrDownloadBtn" disabled>
                ğŸ“¦ æ‰“åŒ…ä¸‹è½½ (PNGæ ¼å¼)
            </button>
        </div>
        
        <div class="api-status" id="qrApiStatus">
            <span class="api-icon">ğŸ“¡</span>
            <span id="qrApiStatusText">å‡†å¤‡ç”ŸæˆäºŒç»´ç ...</span>
        </div>
        
        <div class="progress-container" id="qrProgressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="qrProgressFill"></div>
            </div>
            <div class="progress-text" id="qrProgressText">å‡†å¤‡ç”Ÿæˆ...</div>
        </div>
        
        <div class="error-message" id="qrErrorMessage"></div>
        <div class="success-message" id="qrSuccessMessage"></div>
        
        <div class="qr-grid" id="qrGrid"></div>
    </section>
    <!-- æ—¥å¿—åˆ†æå™¨å·¥å…·æ¨¡å— -->
        <section id="logAnalysisTool" class="calculator" style="display: none;">
            <h2>ğŸ“Š æ—¥å¿—åˆ†æå™¨</h2>
        <div style="font-weight: 600; color: #856404; margin-bottom: 5px;">ğŸ’¡ å¤‡å¿˜å½•ï¼š</div>
                    <div style="color: #856404; font-size: 14px;">
                        â€¢ ä¼˜è¨ç‰¹æ®Šæµé€Ÿ=æœ¬æ¬¡æ¶ˆè´¹æµé‡/å……å€¼æµé‡*60=Xæ¯«å‡/1åˆ†é’Ÿã€‚<br>
        <div class="log-analysis-tool">
            <div class="log-input-section">
                <textarea id="logInput" placeholder="è¯·ç²˜è´´åŸå§‹æ—¥å¿—æ•°æ®ï¼Œæ¯è¡Œä¸€æ¡æ•°æ®...

æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼š
â€¢ ç±»å‹1: 0000011800800100000000001e012c000a000000000002009700000000000000000153588000000000025000000000a80100026a
â€¢ ç±»å‹2: 000035F1 00-80-00 0001 0BB8-000F 0258-0003 004B-0000 0000-0000 0000-2DDD-0000-0324-0332 0000-0000-0000-0000-0001 0000C03C 00 0584
â€¢ ç±»å‹3: 0000000C01440600000000000000000000012CD4C0000001E000000000000000000D0A000000010014070800000001000000141F1F000D030397
â€¢ ç±»å‹4: 00003B13 05-0C-09 0000 00000000-0000 00000000-0000 00005B1B-0146 0000-0000 0000-0000-4125-0000-0000 4E20-4E20-9C40-4E20-4E20 1C1DCF2A 03 0554

æ”¯æŒåŠŸèƒ½ï¼š
1. è‡ªåŠ¨è¯†åˆ«å¤šç§æ•°æ®ç±»å‹å¹¶åº”ç”¨ç›¸åº”çš„è§£æè§„åˆ™
2. æ ¼å¼çµæ´»ï¼šæ”¯æŒå¸¦æˆ–ä¸å¸¦"-"åˆ†éš”ç¬¦çš„æ•°æ®æ ¼å¼
3. è¡¨æ ¼å±•ç¤ºï¼šä½¿ç”¨è¡¨æ ¼æ¸…æ™°å±•ç¤ºæ¯ä¸ªå­—æ®µçš„å€¼å’Œä½ç½®
4. ç»Ÿè®¡ä¿¡æ¯ï¼šæ˜¾ç¤ºè§£ææˆåŠŸå’Œå¤±è´¥çš„æ¡ç›®æ•°
5. å¿«æ·é”®ï¼šæŒ‰Ctrl+Enterå¯å¿«é€Ÿåˆ†ææ•°æ®

æ•°æ®å­—æ®µè¯´æ˜ï¼š
â€¢ è®¾å¤‡IDã€è®¡è´¹æ¨¡å¼ã€å‘½ä»¤ã€è®¾å¤‡çŠ¶æ€
â€¢ æœ¬æ¬¡æ¶ˆè´¹ã€å……å€¼æµé‡ã€å……å€¼å¤©æ•°ã€å‰©ä½™æµé‡ã€å‰©ä½™å¤©æ•°
â€¢ å·²ç”¨æµé‡ã€å·²ç”¨å¤©æ•°ã€çº¯æ°´TDSã€åŸæ°´TDS
â€¢ å„çº§æ»¤èŠ¯å¯¿å‘½ã€æœ€å¤§æ»¤èŠ¯å¯¿å‘½
â€¢ åŒ—äº¬æ—¶é—´ã€æœºå™¨ç±»å‹ã€æ ¡éªŒç 

ä½¿ç”¨æç¤ºï¼š
- æ¯è¡Œè¾“å…¥ä¸€æ¡æ•°æ®ï¼Œå¯æ‰¹é‡è§£æå¤šæ¡æ—¥å¿—
- å·¥å…·ä¼šè‡ªåŠ¨æ¸…ç†æ•°æ®ä¸­çš„ç©ºæ ¼å’Œåˆ†éš”ç¬¦
- è¡¨æ ¼æ”¯æŒæ°´å¹³æ»šåŠ¨æŸ¥çœ‹å®Œæ•´æ•°æ®
- æ‚¬åœåœ¨è¡¨æ ¼å•å…ƒæ ¼ä¸Šå¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- è§£æé”™è¯¯æ—¶ä¼šæ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå› å’ŒåŸå§‹æ•°æ®
- æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼çš„è‡ªåŠ¨è¯†åˆ«ä¸è§£æ

è¾“å…¥ç¤ºä¾‹ï¼š
0000011800800100000000001e012c000a000000000002009700000000000000000153588000000000025000000000a80100026a
000035F1 00-80-00 0001 0BB8-000F 0258-0003 004B-0000 0000-0000 0000-2DDD-0000-0324-0332 0000-0000-0000-0000-0001 0000C03C 00 0584
0000000C01440600000000000000000000012CD4C0000001E000000000000000000D0A000000010014070800000001000000141F1F000D030397
00003B13 05-0C-09 0000 00000000-0000 00000000-0000 00005B1B-0146 0000-0000 0000-0000-4125-0000-0000 4E20-4E20-9C40-4E20-4E20 1C1DCF2A 03 0554

âš¡ æŒ‰ Ctrl+Enter å¿«é€Ÿåˆ†ææ•°æ® âš¡"></textarea>
                
                <div class="buttons-section">
                    <button id="analyzeBtn" class="analyze-btn">ğŸš€ åˆ†ææ•°æ®</button>
                    <button id="clearLogBtn" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </div>
            
            <div id="statusSection" class="status-section"></div>
            
            <div class="result-section">
                <div class="result-content">
                    <!-- è§£æç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </section>
       <section id="logAnalysisTool2" class="calculator" style="display: none;">
        <h2>ğŸ“Š æ—¥å¿—è§£æå™¨</h2>
        
        <div class="log-analysis-tool">
            <div class="log-input-section">
                <textarea id="logInput2" placeholder="è¯·ç²˜è´´åŸå§‹æ—¥å¿—æ•°æ®ï¼Œæ¯è¡Œä¸€æ¡æ•°æ®...

âš¡ æŒ‰ Ctrl+Enter å¿«é€Ÿåˆ†ææ•°æ® âš¡"></textarea>
                
                <div class="buttons-section">
                    <button id="analyzeBtn2" class="analyze-btn" onclick="analysis2()">ğŸš€ åˆ†ææ•°æ®</button>
                    <button id="clearLogBtn" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </div>
            
            <div id="statusSection" class="status-section"></div>
            
            <div class="result-section">
                <div class="result-content">
                    <!-- è§£æç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </section>
    <script>
        // å…¨å±€å®šä¹‰analysis2å‡½æ•°ï¼Œç¡®ä¿æŒ‰é’®ç‚¹å‡»æ—¶å¯ä»¥è®¿é—®
        function analysis2() {
            // è·å–æœ€æ–°çš„è¾“å…¥å€¼
            const rawInput2 = document.getElementById('logInput2').value.trim();
            
            // æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
            if (!rawInput2) {
                alert('è¯·è¾“å…¥æ—¥å¿—æ•°æ®ï¼');
                return;
            }
            
            try {
                // è°ƒç”¨logDecode.jsä¸­çš„analysiså‡½æ•°å¤„ç†æ—¥å¿—æ•°æ®
                const result = analysis(rawInput2);
                
                // è·å–ç»“æœæ˜¾ç¤ºåŒºåŸŸ
                const resultContent = document.querySelector('#logAnalysisTool2 .result-content');
                
                // æ£€æŸ¥resultæ˜¯å¦å­˜åœ¨å¹¶æ ¼å¼åŒ–æ˜¾ç¤ºç»“æœ
                if (result && typeof result === 'object') {
                    // æŒ‰ç…§å…¥åº“å‚æ•°è§£æå™¨çš„æ ·å¼æ˜¾ç¤ºç»“æœ
                    let html = '<div class="param-results"><div class="param-group"><div class="param-column"><h4>è§£æç»“æœï¼š</h4>';
                    
                    // éå†resultå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œåªæ˜¾ç¤ºéç©ºçš„value
                    for (const [key, value] of Object.entries(result)) {
                        // æ£€æŸ¥valueæ˜¯å¦å­˜åœ¨ä¸”ä¸ä¸ºç©º
                        if (value && value.trim() !== '') {
                            html += `<div>${value}</div>`;
                        }
                    }
                    
                    html += '</div></div></div>';
                    resultContent.innerHTML = html;
                } else if (typeof result === 'string') {
                    // å¦‚æœresultæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥æ˜¾ç¤º
                    resultContent.innerHTML = `<div class="param-results"><div class="param-group"><div class="param-column"><h4>è§£æç»“æœï¼š</h4><div>${result}</div></div></div></div>`;
                } else {
                    // å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„ç»“æœï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    resultContent.innerHTML = '<div class="error-message">æ— æ³•è§£ææ—¥å¿—æ•°æ®ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼ã€‚</div>';
                }
            } catch (error) {
                console.error('æ—¥å¿—è§£æé”™è¯¯:', error);
                const resultContent = document.querySelector('#logAnalysisTool2 .result-content');
                resultContent.innerHTML = `<div class="error-message">è§£æå‡ºé”™ï¼š${error.message}</div>`;
            }
        }
        
        $(document).ready(function() {
            // ä¸ºæ—¥å¿—è§£æå™¨2æ·»åŠ å¿«æ·é”®æ”¯æŒï¼ˆCtrl+Enterï¼‰
            const logInput2Element = document.getElementById('logInput2');
            if (logInput2Element) {
                logInput2Element.addEventListener('keydown', function(event) {
                    if (event.ctrlKey && event.key === 'Enter') {
                        event.preventDefault();
                        analysis2();
                    }
                });
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // ===== æ—¥å¿—è§£æåŠŸèƒ½ logDecode.js =====
        // æ•°æ®ç±»å‹å®šä¹‰
        const dataTypes = {
            type1: {
                name: "æ•°æ®ç±»å‹1 (52å­—èŠ‚)",
                fields: [
                    {name: "è®¾å¤‡ID", start: 0, end: 3},
                    {name: "è®¡è´¹æ¨¡å¼", start: 4, end: 4},
                    {name: "å‘½ä»¤", start: 5, end: 5},
                    {name: "è®¾å¤‡çŠ¶æ€", start: 6, end: 6},
                    {name: "æœ¬æ¬¡æ¶ˆè´¹", start: 7, end: 8},
                    {name: "å……å€¼æµé‡", start: 9, end: 10},
                    {name: "å……å€¼å¤©æ•°", start: 11, end: 12},
                    {name: "å‰©ä½™æµé‡", start: 13, end: 14},
                    {name: "å‰©ä½™å¤©æ•°", start: 15, end: 16},
                    {name: "å·²ç”¨æµé‡", start: 17, end: 18},
                    {name: "å·²ç”¨å¤©æ•°", start: 19, end: 20},
                    {name: "çº¯æ°´TDS", start: 21, end: 22},
                    {name: "åŸæ°´TDS", start: 23, end: 24},
                    {name: "1çº§", start: 25, end: 26},
                    {name: "2çº§", start: 27, end: 28},
                    {name: "3çº§", start: 29, end: 30},
                    {name: "4çº§", start: 31, end: 32},
                    {name: "5çº§", start: 33, end: 34},
                    {name: "å¤§1", start: 35, end: 36},
                    {name: "å¤§2", start: 37, end: 38},
                    {name: "å¤§3", start: 39, end: 40},
                    {name: "å¤§4", start: 41, end: 42},
                    {name: "å¤§5", start: 43, end: 44},
                    {name: "åŒ—äº¬æ—¶é—´", start: 45, end: 48},
                    {name: "æœºå™¨ç±»å‹", start: 49, end: 49},
                    {name: "æ ¡éªŒç ", start: 50, end: 51}
                ]
            },
            type2: {
                name: "æ•°æ®ç±»å‹2 (52å­—èŠ‚)",
                fields: [
                    {name: "è®¾å¤‡ID", start: 0, end: 3},
                    {name: "è®¡è´¹æ¨¡å¼", start: 4, end: 4},
                    {name: "å‘½ä»¤", start: 5, end: 5},
                    {name: "è®¾å¤‡çŠ¶æ€", start: 6, end: 6},
                    {name: "æœ¬æ¬¡æ¶ˆè´¹", start: 7, end: 8},
                    {name: "å……å€¼æµé‡", start: 9, end: 10},
                    {name: "å……å€¼å¤©æ•°", start: 11, end: 12},
                    {name: "å‰©ä½™æµé‡", start: 13, end: 14},
                    {name: "å‰©ä½™å¤©æ•°", start: 15, end: 16},
                    {name: "å·²ç”¨æµé‡", start: 17, end: 18},
                    {name: "å·²ç”¨å¤©æ•°", start: 19, end: 20},
                    {name: "çº¯æ°´TDS", start: 21, end: 22},
                    {name: "åŸæ°´TDS", start: 23, end: 24},
                    {name: "1çº§", start: 25, end: 26},
                    {name: "2çº§", start: 27, end: 28},
                    {name: "3çº§", start: 29, end: 30},
                    {name: "4çº§", start: 31, end: 32},
                    {name: "5çº§", start: 33, end: 34},
                    {name: "å¤§1", start: 35, end: 36},
                    {name: "å¤§2", start: 37, end: 38},
                    {name: "å¤§3", start: 39, end: 40},
                    {name: "å¤§4", start: 41, end: 42},
                    {name: "å¤§5", start: 43, end: 44},
                    {name: "åŒ—äº¬æ—¶é—´", start: 45, end: 48},
                    {name: "æœºå™¨ç±»å‹", start: 49, end: 49},
                    {name: "æ ¡éªŒç ", start: 50, end: 51}
                ]
            },
            type3: {
                name: "æ•°æ®ç±»å‹3 (52å­—èŠ‚)",
                fields: [
                    {name: "è®¾å¤‡ID", start: 0, end: 3},
                    {name: "è®¡è´¹æ¨¡å¼", start: 4, end: 4},
                    {name: "å‘½ä»¤", start: 5, end: 5},
                    {name: "è®¾å¤‡çŠ¶æ€", start: 6, end: 6},
                    {name: "æœ¬æ¬¡æ¶ˆè´¹", start: 7, end: 8},
                    {name: "å……å€¼æµé‡", start: 9, end: 12},
                    {name: "å……å€¼å¤©æ•°", start: 13, end: 14},
                    {name: "å‰©ä½™æµé‡", start: 15, end: 18},
                    {name: "å‰©ä½™å¤©æ•°", start: 19, end: 20},
                    {name: "å·²ç”¨æµé‡", start: 21, end: 24},
                    {name: "å·²ç”¨å¤©æ•°", start: 25, end: 26},
                    {name: "çº¯æ°´TDS", start: 27, end: 28},
                    {name: "åŸæ°´TDS", start: 29, end: 30},
                    {name: "1çº§", start: 31, end: 32},
                    {name: "2çº§", start: 33, end: 34},
                    {name: "3çº§", start: 35, end: 36},
                    {name: "4çº§", start: 37, end: 38},
                    {name: "5çº§", start: 39, end: 40},
                    {name: "å¤§1", start: 41, end: 42},
                    {name: "å¤§2", start: 43, end: 44},
                    {name: "å¤§3", start: 45, end: 46},
                    {name: "å¤§4", start: 47, end: 48},
                    {name: "å¤§5", start: 49, end: 50},
                    {name: "åŒ—äº¬æ—¶é—´", start: 51, end: 54},
                    {name: "æœºå™¨ç±»å‹", start: 55, end: 55},
                    {name: "æ ¡éªŒç ", start: 56, end: 57}
                ]
            },
            type4: {
                name: "æ•°æ®ç±»å‹4 (58å­—èŠ‚)",
                fields: [
                    {name: "è®¾å¤‡ID", start: 0, end: 3},
                    {name: "è®¡è´¹æ¨¡å¼", start: 4, end: 4},
                    {name: "å‘½ä»¤", start: 5, end: 5},
                    {name: "è®¾å¤‡çŠ¶æ€", start: 6, end: 6},
                    {name: "æœ¬æ¬¡æ¶ˆè´¹", start: 7, end: 8},
                    {name: "å……å€¼æµé‡", start: 9, end: 12},
                    {name: "å……å€¼å¤©æ•°", start: 13, end: 14},
                    {name: "å‰©ä½™æµé‡", start: 15, end: 18},
                    {name: "å‰©ä½™å¤©æ•°", start: 19, end: 20},
                    {name: "å·²ç”¨æµé‡", start: 21, end: 24},
                    {name: "å·²ç”¨å¤©æ•°", start: 25, end: 26},
                    {name: "çº¯æ°´TDS", start: 27, end: 28},
                    {name: "åŸæ°´TDS", start: 29, end: 30},
                    {name: "1çº§", start: 31, end: 32},
                    {name: "2çº§", start: 33, end: 34},
                    {name: "3çº§", start: 35, end: 36},
                    {name: "4çº§", start: 37, end: 38},
                    {name: "5çº§", start: 39, end: 40},
                    {name: "å¤§1", start: 41, end: 42},
                    {name: "å¤§2", start: 43, end: 44},
                    {name: "å¤§3", start: 45, end: 46},
                    {name: "å¤§4", start: 47, end: 48},
                    {name: "å¤§5", start: 49, end: 50},
                    {name: "åŒ—äº¬æ—¶é—´", start: 51, end: 54},
                    {name: "æœºå™¨ç±»å‹", start: 55, end: 55},
                    {name: "æ ¡éªŒç ", start: 56, end: 57}
                ]
            }
        };

        // æ¸…ç†åå…­è¿›åˆ¶æ•°æ®
        function cleanHexData(data) {
            return data.replace(/[\s\-\r\n]/g, '').toUpperCase();
        }

        // åå…­è¿›åˆ¶è½¬åè¿›åˆ¶
        function hexToDec(hex) {
            return parseInt(hex, 16);
        }

        // æå–å­—èŠ‚èŒƒå›´
        function extractBytes(data, start, end) {
            const startPos = start * 2;
            const endPos = (end + 1) * 2;
            const hex = data.substring(startPos, endPos);
            // ç›´æ¥è¿”å›ï¼Œä¸æ·»åŠ ç©ºæ ¼
            return hex;
        }

        // åˆ¤æ–­æ•°æ®ç±»å‹
        function detectDataType(cleanData) {
            const byteLength = cleanData.length / 2;
            
            if (byteLength === 52) {
                // æ ¹æ®æ•°æ®ç‰¹å¾è¿›ä¸€æ­¥åˆ¤æ–­æ˜¯type1ã€type2è¿˜æ˜¯type3
                return 'type1'; // é»˜è®¤è¿”å›type1ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥æ ¹æ®æ›´å¤šç‰¹å¾åˆ¤æ–­
            } else if (byteLength === 58) {
                return 'type4';
            }
            
            return 'type1'; // é»˜è®¤ç±»å‹
        }

        // è§£æå•è¡Œæ•°æ®
        function parseData(rawData) {
            const cleanData = cleanHexData(rawData);
            const dataType = detectDataType(cleanData);
            const typeConfig = dataTypes[dataType];
            
            if (!typeConfig) {
                throw new Error('æœªçŸ¥çš„æ•°æ®ç±»å‹');
            }

            const result = {
                type: typeConfig.name,
                originalData: rawData,
                cleanData: cleanData,
                fields: []
            };

            typeConfig.fields.forEach(field => {
                const hexValue = extractBytes(cleanData, field.start, field.end);
                const decValue = hexToDec(hexValue);
                
                // ç®€åŒ–å­—èŠ‚èŒƒå›´æ˜¾ç¤º
                let rangeText;
                if (field.start === field.end) {
                    rangeText = `${field.start + 1}`;
                } else {
                    rangeText = `${field.start + 1}~${field.end + 1}`;
                }
                
                result.fields.push({
                    name: field.name,
                    hexValue: hexValue,
                    decValue: decValue,
                    range: rangeText
                });
            });

            // æ·»åŠ æ ¡éªŒç éªŒè¯
            try {
                // è®¡ç®—æ ¡éªŒå’Œï¼šé™¤å»æœ€å4ä¸ªæ•°å­—(2ä¸ªå­—èŠ‚)å¤–ï¼Œå…¶ä½™æ‰€æœ‰æ•°å­—ï¼Œæ¯2ä¸ªæ•°å­—ç›¸åŠ ç»„æˆçš„å’Œ
                const dataWithoutChecksum = cleanData.substring(0, cleanData.length - 4);
                let checksum = 0;
                
                // æ¯2ä¸ªå­—ç¬¦ï¼ˆ1ä¸ªå­—èŠ‚ï¼‰ç›¸åŠ 
                for (let i = 0; i < dataWithoutChecksum.length; i += 2) {
                    if (i + 1 < dataWithoutChecksum.length) {
                        const byte = dataWithoutChecksum.substring(i, i + 2);
                        checksum += parseInt(byte, 16);
                    }
                }
                
                // å–åä¸¤ä½å­—èŠ‚ï¼ˆæ ¡éªŒç ï¼‰
                const actualChecksumHex = cleanData.substring(cleanData.length - 4);
                const actualChecksum = parseInt(actualChecksumHex, 16);
                
                // å–æ ¡éªŒå’Œçš„ä½16ä½ï¼ˆå› ä¸ºæ ¡éªŒç æ˜¯2å­—èŠ‚ï¼‰
                const calculatedChecksum = checksum & 0xFFFF;
                
                // éªŒè¯ç»“æœ
                const isValid = calculatedChecksum === actualChecksum;
                
                // æ·»åŠ æ ¡éªŒä¿¡æ¯åˆ°ç»“æœ
                result.checksum = {
                    calculated: calculatedChecksum,
                    actual: actualChecksum,
                    isValid: isValid
                };
            } catch (e) {
                // å¦‚æœè®¡ç®—å‡ºé”™ï¼Œæ·»åŠ é”™è¯¯ä¿¡æ¯
                result.checksum = {
                    error: e.message
                };
            }
            
            return result;
        }

        // åˆ†ææ•°æ®
        function analyzeData() {
            const rawInput = document.getElementById('logInput').value.trim();
            const resultSection = document.querySelector('.result-content');
            const statusSection = document.getElementById('statusSection');
            
            if (!rawInput) {
                statusSection.className = 'status-section error';
                statusSection.textContent = 'âŒ è¯·è¾“å…¥åŸå§‹æ•°æ®';
                return;
            }

            const lines = rawInput.split('\n').filter(line => line.trim());
            
            // æ¸…ç©ºç°æœ‰ç»“æœ
            resultSection.innerHTML = '';
            
            if (lines.length === 0) {
                statusSection.className = 'status-section error';
                statusSection.textContent = 'âŒ æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®è¡Œ';
                return;
            }

            let successCount = 0;
            let errorCount = 0;
            
            // ä¸ºæ¯æ¡æ•°æ®åˆ›å»ºç‹¬ç«‹çš„è§£æç»“æœå—
            lines.forEach((line, index) => {
                try {
                    const parsedData = parseData(line.trim());
                    createResultBlock(parsedData, index);
                    successCount++;
                } catch (error) {
                    // åˆ›å»ºé”™è¯¯ç»“æœå—
                    const errorBlock = document.createElement('div');
                    errorBlock.className = 'result-item error';
                    errorBlock.innerHTML = `
                        <div class="result-header">
                            ğŸ“Š è§£æç»“æœ (ç¬¬${index + 1}æ¡) - è§£æå¤±è´¥
                        </div>
                        <div class="status-section error">
                            âŒ è§£æå¤±è´¥: ${error.message}
                        </div>
                        <div class="error-raw-data">
                            <strong>åŸå§‹æ—¥å¿—:</strong> ${line}
                        </div>
                    `;
                    resultSection.appendChild(errorBlock);
                    errorCount++;
                }
            });
            
            // æ›´æ–°çŠ¶æ€åŒºåŸŸæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            statusSection.className = 'status-section info';
            statusSection.innerHTML = `
                ğŸ“Š è§£æå®Œæˆï¼æˆåŠŸè§£æ ${successCount} æ¡æ•°æ®ï¼Œå¤±è´¥ ${errorCount} æ¡æ•°æ®ã€‚
            `;
        }

        // åˆ›å»ºç»“æœå—
        function createResultBlock(parsedData, index) {
            const resultSection = document.querySelector('.result-content');
            
            // åˆ›å»ºç»“æœå®¹å™¨
            const resultBlock = document.createElement('div');
            resultBlock.className = 'result-item';
            resultBlock.style.marginBottom = '20px';
            resultBlock.style.border = '1px solid #e1e5e9';
            resultBlock.style.borderRadius = '10px';
            resultBlock.style.overflow = 'hidden';
            
            // åˆ›å»ºæ ‡é¢˜æ 
            const header = document.createElement('div');
            header.className = 'result-header';
            header.innerHTML = `
                ğŸ“Š è§£æç»“æœ (ç¬¬${index + 1}æ¡) - ${parsedData.type}
            `;
            resultBlock.appendChild(header);
            
            // åˆ›å»ºåŸå§‹æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ
            const rawDataDiv = document.createElement('div');
            rawDataDiv.style.padding = '10px';
            rawDataDiv.style.backgroundColor = '#f8f9fa';
            rawDataDiv.style.borderBottom = '1px solid #e1e5e9';
            rawDataDiv.innerHTML = `<strong>åŸå§‹æ—¥å¿—:</strong> ${parsedData.originalData}`;
            resultBlock.appendChild(rawDataDiv);
            
            // åˆ›å»ºè¡¨æ ¼å®¹å™¨
            const tableContainer = document.createElement('div');
            tableContainer.style.overflowX = 'auto';
            tableContainer.style.width = '100%';
            
            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');
            table.className = 'data-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th class="row-label">æ•°æ®ç±»å‹</th>
                    </tr>
                    <tr>
                        <th class="row-label">èŒƒå›´</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label"><strong>æ•°å€¼</strong></td>
                    </tr>
                </tbody>
            `;
            
            // æ›´æ–°è¡¨æ ¼å†…å®¹
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            const titleRow = thead.children[0];
            const rangeRow = thead.children[1];
            const valueRow = tbody.children[0];
            
            parsedData.fields.forEach(field => {
                // æ·»åŠ å­—æ®µæ ‡é¢˜
                const th = document.createElement('th');
                th.title = field.name;
                th.textContent = field.name;
                titleRow.appendChild(th);
                
                // æ·»åŠ å­—èŠ‚èŒƒå›´
                const rangeTh = document.createElement('th');
                rangeTh.className = 'range-cell';
                rangeTh.textContent = field.range;
                rangeRow.appendChild(rangeTh);
                
                // æ·»åŠ æ•°å€¼
                const td = document.createElement('td');
                td.className = 'data-cell';
                td.title = `åè¿›åˆ¶: ${field.decValue}, åå…­è¿›åˆ¶: ${field.hexValue}`;
                // ä¼˜åŒ–16è¿›åˆ¶æ•°å€¼æ˜¾ç¤ºï¼šæœ€å°‘ä¿ç•™2ä½æ•°ï¼Œ00æ˜¾ç¤ºä¸º00
                let formattedHex;
                if (field.hexValue === '00') {
                    formattedHex = '00'; // å½“æ˜¯00æ—¶ï¼Œä¿æŒæ˜¾ç¤º00
                } else {
                    // å»é™¤å‰å¯¼é›¶
                    const trimmed = field.hexValue.replace(/^0+/, '') || '0';
                    // ç¡®ä¿æœ€å°‘ä¿ç•™2ä½æ•°
                    formattedHex = trimmed.padStart(2, '0');
                }
                td.innerHTML = `<span class="dec-value">${field.decValue}</span><br><span class="hex-value">ã€Œ${formattedHex}ã€</span>`;
                valueRow.appendChild(td);
            });
            
            // æ·»åŠ æ ¡éªŒç éªŒè¯ç»“æœåˆ—
            if (parsedData.checksum && !parsedData.checksum.error) {
                // æ·»åŠ æ ¡éªŒç»“æœæ ‡é¢˜
                const checksumTitleTh = document.createElement('th');
                checksumTitleTh.title = 'æ ¡éªŒç éªŒè¯';
                checksumTitleTh.textContent = 'æ ¡éªŒéªŒè¯';
                titleRow.appendChild(checksumTitleTh);
                
                // æ·»åŠ ç©ºçš„èŒƒå›´å•å…ƒæ ¼
                const checksumRangeTh = document.createElement('th');
                checksumRangeTh.className = 'range-cell';
                checksumRangeTh.textContent = '-';
                rangeRow.appendChild(checksumRangeTh);
                
                // æ·»åŠ æ ¡éªŒç»“æœ
                const checksumTd = document.createElement('td');
                checksumTd.className = 'data-cell';
                checksumTd.style.fontWeight = 'bold';
                checksumTd.style.color = parsedData.checksum.isValid ? '#28a745' : '#dc3545';
                
                // æ ¼å¼åŒ–è®¡ç®—å‡ºçš„æ ¡éªŒå’Œä¸º16è¿›åˆ¶ï¼Œç¡®ä¿4ä½
                const calculatedHex = parsedData.checksum.calculated.toString(16).toUpperCase().padStart(4, '0');
                checksumTd.innerHTML = `${calculatedHex}ã€Œ${parsedData.checksum.isValid ? 'âœ…' : 'âŒ'}ã€`;
                valueRow.appendChild(checksumTd);
            }
            
            tableContainer.appendChild(table);
            resultBlock.appendChild(tableContainer);
            
            // æ·»åŠ åˆ°ç»“æœåŒºåŸŸ
            resultSection.appendChild(resultBlock);
        }

        // æ¸…ç©ºæ•°æ®
        function clearLogData() {
            document.getElementById('logInput').value = '';
            document.getElementById('statusSection').innerHTML = '';
            document.querySelector('.result-content').innerHTML = '';
        }

        // ç»‘å®šäº‹ä»¶
        document.getElementById('analyzeBtn').addEventListener('click', analyzeData);
        document.getElementById('clearLogBtn').addEventListener('click', clearLogData);

        // å›è½¦é”®å¿«æ·åˆ†æ
        document.getElementById('logInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeData();
            }
        });
        
        // æ—¥å¿—è§£æç•Œé¢åŠŸèƒ½
        function analyzeLog() {
            const logInput = document.getElementById('logInput').value.trim();
            const logResult = document.getElementById('logResult');
            
            if (!logInput) {
                logResult.textContent = 'è¯·è¾“å…¥æ—¥å¿—æ•°æ®';
                return;
            }
            
            try {
                console.log('å¼€å§‹è§£ææ—¥å¿—:', logInput); // è°ƒè¯•ä¿¡æ¯
                
                const result = analysis(logInput);
                
                if (result && result.error) {
                    logResult.textContent = 'è§£æå¤±è´¥ï¼š' + result.error;
                    return;
                }
                
                if (result) {
                    let output = 'ğŸ“Š æ—¥å¿—è§£æç»“æœï¼š\n';
                    output += 'â•'.repeat(50) + '\n\n';
                    
                    // æ ¼å¼åŒ–è¾“å‡ºç»“æœ
                    for (const [key, value] of Object.entries(result)) {
                        if (value && value.toString().trim()) {
                            output += `${value}\n`;
                        }
                    }
                    
                    output += '\n' + 'â•'.repeat(50);
                    output += '\nè§£æå®Œæˆ âœ“';
                    
                    logResult.textContent = output;
                    console.log('è§£ææˆåŠŸ:', result); // è°ƒè¯•ä¿¡æ¯
                } else {
                    logResult.textContent = 'è§£æå¤±è´¥ï¼šæ— æ³•è¯†åˆ«çš„æ•°æ®æ ¼å¼';
                }
            } catch (error) {
                logResult.textContent = 'è§£æå‡ºé”™ï¼š' + error.message;
                console.error('æ—¥å¿—è§£æé”™è¯¯:', error);
            }
        }
        
        function clearLogData() {
            document.getElementById('logInput').value = '';
            document.getElementById('logResult').textContent = 'ç­‰å¾…è¾“å…¥æ—¥å¿—æ•°æ®...';
        }
        
        // å¤„ç†å›è½¦é”®è‡ªåŠ¨è§£æ
        function handleLogInputKeydown(event) {
            // æ£€æµ‹å›è½¦é”®ï¼ˆEnteré”®ï¼ŒkeyCodeä¸º13ï¼‰
            if (event.key === 'Enter' || event.keyCode === 13) {
                // é˜»æ­¢é»˜è®¤çš„æ¢è¡Œè¡Œä¸º
                event.preventDefault();
                
                // è·å–è¾“å…¥æ¡†çš„å€¼
                const logInput = document.getElementById('logInput').value.trim();
                
                // å¦‚æœæœ‰å†…å®¹åˆ™è‡ªåŠ¨å¼€å§‹è§£æ
                if (logInput) {
                    console.log('ğŸ” æ£€æµ‹åˆ°å›è½¦é”®ï¼Œè‡ªåŠ¨å¼€å§‹è§£ææ—¥å¿—');
                    analyzeLog();
                } else {
                    console.log('âš ï¸ è¾“å…¥æ¡†ä¸ºç©ºï¼Œæ— æ³•è§£æ');
                }
            }
        }
        class QRGenerator {
            constructor() {
                this.generatedBlobs = []; // å­˜å‚¨ç”Ÿæˆçš„blobå¯¹è±¡
                this.initEventListeners();
            }

            initEventListeners() {
                document.getElementById('qrGenerateBtn').addEventListener('click', () => this.generateQRCodes());
                document.getElementById('qrDownloadBtn').addEventListener('click', () => this.downloadZip());
            }

            showError(message) {
                const errorDiv = document.getElementById('qrErrorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }

            showSuccess(message) {
                const successDiv = document.getElementById('qrSuccessMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            }

            updateProgress(current, total, text) {
                const progressContainer = document.getElementById('qrProgressContainer');
                const progressFill = document.getElementById('qrProgressFill');
                const progressText = document.getElementById('qrProgressText');
                
                progressContainer.style.display = 'block';
                const percentage = (current / total) * 100;
                progressFill.style.width = percentage + '%';
                progressText.textContent = text || `æ­£åœ¨ç”Ÿæˆ ${current}/${total} (${Math.round(percentage)}%)`;
            }

            hideProgress() {
                document.getElementById('qrProgressContainer').style.display = 'none';
            }

            updateApiStatus(message, show = true) {
                const apiStatus = document.getElementById('qrApiStatus');
                const apiStatusText = document.getElementById('qrApiStatusText');
                
                if (show) {
                    apiStatus.style.display = 'block';
                    apiStatusText.textContent = message;
                } else {
                    apiStatus.style.display = 'none';
                }
            }

            setGenerateButtonState(loading) {
                const btn = document.getElementById('qrGenerateBtn');
                const btnText = document.getElementById('qrGenerateBtnText');
                const btnLoading = document.getElementById('qrGenerateBtnLoading');
                
                btn.disabled = loading;
                btnText.style.display = loading ? 'none' : 'inline';
                btnLoading.style.display = loading ? 'inline-block' : 'none';
            }

            // ç”Ÿæˆå¸¦è‡ªé€‚åº”IMEIæ–‡å­—çš„äºŒç»´ç ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
            async generateQRCode(text, imei, retryCount = 0) {
                const encodedText = encodeURIComponent(text);
                const maxRetries = 2;
                
                // å¤šä¸ªå¤‡é€‰APIï¼Œæé«˜æˆåŠŸç‡
                const apis = [
                    `https://api.qrserver.com/v1/create-qr-code/?size=280x280&format=png&data=${encodedText}`,
                    `https://chart.googleapis.com/chart?chs=280x280&cht=qr&chl=${encodedText}`,
                    `https://quickchart.io/qr?text=${encodedText}&size=280`
                ];
                
                const currentApi = apis[retryCount % apis.length];
                console.log(`ğŸ”„ ${imei} å°è¯•API ${retryCount + 1}/${maxRetries + 1}:`, currentApi);
                
                try {
                    // åˆ›å»ºå¸¦è‡ªé€‚åº”IMEIæ–‡å­—çš„äºŒç»´ç å›¾ç‰‡
                    return await this.addTextToQRCode(currentApi, imei);
                } catch (error) {
                    console.log(`âŒ ${imei} APIå¤±è´¥ (${retryCount + 1}/${maxRetries + 1}):`, error.message);
                    
                    if (retryCount < maxRetries) {
                        console.log(`ğŸ”„ ${imei} é‡è¯•ä¸­...`);
                        await new Promise(resolve => setTimeout(resolve, 200)); // çŸ­æš‚å»¶è¿Ÿ
                        return await this.generateQRCode(text, imei, retryCount + 1);
                    } else {
                        throw new Error(`æ‰€æœ‰APIéƒ½å¤±è´¥: ${error.message}`);
                    }
                }
            }

            // åœ¨äºŒç»´ç å›¾ç‰‡ä¸Šæ·»åŠ è‡ªé€‚åº”IMEIæ–‡å­—
            async addTextToQRCode(qrUrl, imei) {
                console.log(`ğŸ–¼ï¸ å¼€å§‹å¤„ç†: ${imei}`);
                
                // å°è¯•å¤šç§æ–¹æ³•è·å–å›¾ç‰‡
                const methods = [
                    // æ–¹æ³•1: ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
                    async () => {
                        const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(qrUrl)}`);
                        if (!response.ok) throw new Error(`ä»£ç†æœåŠ¡å™¨é”™è¯¯: ${response.status}`);
                        return await response.blob();
                    },
                    // æ–¹æ³•2: ä½¿ç”¨å¦ä¸€ä¸ªä»£ç†
                    async () => {
                        const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(qrUrl)}`);
                        if (!response.ok) throw new Error(`ä»£ç†æœåŠ¡å™¨é”™è¯¯: ${response.status}`);
                        return await response.blob();
                    },
                    // æ–¹æ³•3: ç›´æ¥å°è¯•ï¼ˆå¯èƒ½ä¼šæœ‰è·¨åŸŸé—®é¢˜ï¼Œä½†æœ‰äº›æµè§ˆå™¨å…è®¸ï¼‰
                    async () => {
                        const response = await fetch(qrUrl);
                        if (!response.ok) throw new Error(`ç›´æ¥è¯·æ±‚é”™è¯¯: ${response.status}`);
                        return await response.blob();
                    }
                ];
                
                let imageBlob = null;
                let lastError = null;
                
                // å°è¯•æ¯ç§æ–¹æ³•
                for (let i = 0; i < methods.length; i++) {
                    try {
                        console.log(`ğŸ”„ ${imei} å°è¯•æ–¹æ³• ${i + 1}/${methods.length}`);
                        imageBlob = await methods[i]();
                        console.log(`âœ… ${imei} æ–¹æ³• ${i + 1} æˆåŠŸè·å–å›¾ç‰‡`);
                        break;
                    } catch (error) {
                        console.log(`âŒ ${imei} æ–¹æ³• ${i + 1} å¤±è´¥:`, error.message);
                        lastError = error;
                        continue;
                    }
                }
                
                if (!imageBlob) {
                    throw new Error(`æ‰€æœ‰è·å–å›¾ç‰‡çš„æ–¹æ³•éƒ½å¤±è´¥: ${lastError?.message}`);
                }
                
                const imageUrl = URL.createObjectURL(imageBlob);
                
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    
                    const timeout = setTimeout(() => {
                        console.log(`â° ${imei} å¤„ç†è¶…æ—¶`);
                        URL.revokeObjectURL(imageUrl);
                        reject(new Error('å¤„ç†è¶…æ—¶'));
                    }, 10000);
                    
                    img.onload = () => {
                        clearTimeout(timeout);
                        console.log(`âœ… ${imei} å›¾ç‰‡åŠ è½½æˆåŠŸ`);
                        
                        try {
                            // åˆ›å»ºcanvas
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            if (!ctx) {
                                throw new Error('æ— æ³•åˆ›å»ºCanvasä¸Šä¸‹æ–‡');
                            }
                            
                            // è®¾ç½®ç”»å¸ƒå°ºå¯¸ä¸ºæ­£æ–¹å½¢
                            const qrSize = 280;
                            const textHeight = 80;
                            const totalSize = qrSize + textHeight;
                            
                            canvas.width = totalSize;
                            canvas.height = totalSize;
                            
                            // å¡«å……ç™½è‰²èƒŒæ™¯
                            ctx.fillStyle = '#ffffff';
                            ctx.fillRect(0, 0, totalSize, totalSize);
                            
                            // ç»˜åˆ¶äºŒç»´ç ï¼ˆå±…ä¸­ä¸Šæ–¹ï¼‰
                            const qrX = (totalSize - qrSize) / 2;
                            const qrY = 10;
                            ctx.drawImage(img, qrX, qrY, qrSize, qrSize);
                            
                            // è‡ªé€‚åº”æ–‡å­—å¤§å°åˆ°äºŒç»´ç å®½åº¦
                            const maxWidth = qrSize - 20;
                            let fontSize = 50;
                            const minFontSize = 24;
                            
                            // è®¾ç½®æ–‡å­—æ ·å¼
                            ctx.fillStyle = '#333333';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            
                            // åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°
                            do {
                                ctx.font = `bold ${fontSize}px Arial, sans-serif`;
                                const textWidth = ctx.measureText(imei).width;
                                
                                if (textWidth <= maxWidth || fontSize <= minFontSize) {
                                    break;
                                }
                                fontSize -= 1;
                            } while (fontSize > minFontSize);
                            
                            fontSize = Math.max(fontSize, minFontSize);
                            ctx.font = `bold ${fontSize}px Arial, sans-serif`;
                            
                            // ç»˜åˆ¶IMEIæ–‡å­—
                            const textY = qrY + qrSize + textHeight / 2;
                            ctx.fillText(imei, totalSize / 2, textY);
                            
                            console.log(`ğŸ“ ${imei} å­—ä½“: ${fontSize}px`);
                            
                            // è½¬æ¢ä¸ºblob
                            canvas.toBlob((resultBlob) => {
                                if (resultBlob) {
                                    const url = URL.createObjectURL(resultBlob);
                                    this.generatedBlobs.push({ blob: resultBlob, filename: `${imei}.png` });
                                    console.log(`ğŸ‰ ${imei} å¤„ç†å®Œæˆ`);
                                    
                                    // æ¸…ç†ä¸´æ—¶URL
                                    URL.revokeObjectURL(imageUrl);
                                    resolve(url);
                                } else {
                                    URL.revokeObjectURL(imageUrl);
                                    reject(new Error('Canvasè½¬æ¢å¤±è´¥'));
                                }
                            }, 'image/png');
                            
                        } catch (error) {
                            console.error(`âŒ ${imei} Canvaså¤„ç†å¤±è´¥:`, error);
                            URL.revokeObjectURL(imageUrl);
                            reject(error);
                        }
                    };
                    
                    img.onerror = (error) => {
                        clearTimeout(timeout);
                        console.error(`âŒ ${imei} å›¾ç‰‡åŠ è½½å¤±è´¥:`, error);
                        URL.revokeObjectURL(imageUrl);
                        reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                    };
                    
                    img.src = imageUrl;
                });
            }

            async generateQRCodes() {
                const prefix = document.getElementById('qrPrefix').value.trim();
                const imeiText = document.getElementById('qrImeiList').value.trim();
                
                if (!prefix) {
                    this.showError('è¯·è¾“å…¥äºŒç»´ç å‰ç¼€');
                    return;
                }
                
                if (!imeiText) {
                    this.showError('è¯·è¾“å…¥IMEIåˆ—è¡¨');
                    return;
                }

                const imeiList = imeiText.split('\n').filter(imei => imei.trim()).map(imei => imei.trim());
                
                if (imeiList.length === 0) {
                    this.showError('è¯·è¾“å…¥æœ‰æ•ˆçš„IMEIåˆ—è¡¨');
                    return;
                }

                this.setGenerateButtonState(true);
                this.generatedBlobs = [];
                document.getElementById('qrGrid').innerHTML = '';
                document.getElementById('qrDownloadBtn').disabled = true;
                this.updateApiStatus('ä½¿ç”¨QR-Server.com APIç”ŸæˆäºŒç»´ç ...');

                let successCount = 0;
                let failCount = 0;

                for (let i = 0; i < imeiList.length; i++) {
                    const imei = imeiList[i];
                    const qrText = prefix + imei;
                    
                    this.updateProgress(i + 1, imeiList.length, `æ­£åœ¨ç”Ÿæˆ ${i + 1}/${imeiList.length}: ${imei}`);
                    
                    try {
                        const qrUrl = await this.generateQRCode(qrText, imei);
                        await this.displayQRCode(qrUrl, imei, qrText);
                        successCount++;
                        
                        // å‡å°‘å»¶è¿Ÿæ—¶é—´ï¼Œæé«˜ç”Ÿæˆé€Ÿåº¦
                        if (i < imeiList.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    } catch (error) {
                        console.error(`ç”Ÿæˆ ${imei} çš„äºŒç»´ç å¤±è´¥:`, error);
                        failCount++;
                        this.displayErrorQR(imei, error.message);
                    }
                }

                this.hideProgress();
                this.setGenerateButtonState(false);
                
                if (successCount > 0) {
                    document.getElementById('qrDownloadBtn').disabled = false;
                    this.updateApiStatus(`âœ… æˆåŠŸç”Ÿæˆ ${successCount} ä¸ªäºŒç»´ç ${failCount > 0 ? `ï¼Œå¤±è´¥ ${failCount} ä¸ª` : ''}`);
                    this.showSuccess(`æˆåŠŸç”Ÿæˆ ${successCount} ä¸ªäºŒç»´ç ${failCount > 0 ? `ï¼Œå¤±è´¥ ${failCount} ä¸ª` : ''}`);
                } else {
                    this.updateApiStatus('âŒ æ‰€æœ‰äºŒç»´ç ç”Ÿæˆå¤±è´¥');
                    this.showError('æ‰€æœ‰äºŒç»´ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•');
                }
            }

            async displayQRCode(qrUrl, imei, qrText) {
                return new Promise((resolve, reject) => {
                    const qrItem = document.createElement('div');
                    qrItem.className = 'qr-item';
                    
                    // åˆ›å»ºå›¾ç‰‡å…ƒç´ å¹¶ç­‰å¾…åŠ è½½
                    const img = new Image();
                    img.onload = () => {
                        qrItem.innerHTML = `
                            <img src="${qrUrl}" alt="QR Code for ${imei}">
                            <div class="qr-label">${imei}</div>
                            <div class="qr-label" style="font-size: 0.7em; color: #999; margin-top: 5px;">${qrText}</div>
                            <div class="qr-label" style="font-size: 0.6em; color: #4facfe; margin-top: 3px;">API: QR-Server.com</div>
                        `;
                        
                        document.getElementById('qrGrid').appendChild(qrItem);
                        resolve();
                    };
                    
                    img.onerror = () => {
                        reject(new Error('äºŒç»´ç å›¾ç‰‡åŠ è½½å¤±è´¥'));
                    };
                    
                    img.src = qrUrl;
                });
            }

            displayErrorQR(imei, errorMsg) {
                const qrItem = document.createElement('div');
                qrItem.className = 'qr-item';
                qrItem.style.background = '#ffe6e6';
                qrItem.innerHTML = `
                    <div style="padding: 20px; color: #d63031;">
                        <div style="font-size: 2em; margin-bottom: 10px;">âŒ</div>
                        <div class="qr-label">${imei}</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">${errorMsg}</div>
                    </div>
                `;
                
                document.getElementById('qrGrid').appendChild(qrItem);
            }

            async downloadZip() {
                if (this.generatedBlobs.length === 0) {
                    this.showError('æ²¡æœ‰å¯ä¸‹è½½çš„äºŒç»´ç ');
                    return;
                }

                const zip = new JSZip();
                const downloadBtn = document.getElementById('qrDownloadBtn');
                const originalText = downloadBtn.textContent;
                
                downloadBtn.disabled = true;
                downloadBtn.innerHTML = '<span class="loading"></span> æ­£åœ¨æ‰“åŒ…...';

                try {
                    // å¤„ç†ç”Ÿæˆçš„å›¾ç‰‡
                    for (let i = 0; i < this.generatedBlobs.length; i++) {
                        const item = this.generatedBlobs[i];
                        zip.file(item.filename, item.blob);
                        downloadBtn.textContent = `æ­£åœ¨æ‰“åŒ… ${i + 1}/${this.generatedBlobs.length}`;
                    }

                    downloadBtn.textContent = 'æ­£åœ¨ç”Ÿæˆå‹ç¼©åŒ…...';
                    const content = await zip.generateAsync({type: 'blob'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(content);
                    link.download = `äºŒç»´ç _${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.zip`;
                    link.click();
                    
                    URL.revokeObjectURL(link.href);
                    this.showSuccess('äºŒç»´ç æ‰“åŒ…ä¸‹è½½æˆåŠŸï¼');
                    
                } catch (error) {
                    console.error('æ‰“åŒ…ä¸‹è½½å¤±è´¥:', error);
                    this.showError('æ‰“åŒ…ä¸‹è½½å¤±è´¥: ' + error.message);
                } finally {
                    downloadBtn.disabled = false;
                    downloadBtn.textContent = originalText;
                }
            }
        }

        // åˆå§‹åŒ–äºŒç»´ç ç”Ÿæˆå™¨
        let qrGenerator = null;
        function initQRGenerator() {
            if (!qrGenerator) {
                qrGenerator = new QRGenerator();
            }
        }

        // ç”Ÿæˆå½“æ—¥æ—¥æœŸ+001çš„é»˜è®¤å€¼
        function getDefaultSerialNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}${month}${day}001`;
        }
        
        // åˆå§‹åŒ–ç”Ÿæˆæµæ°´å·å·¥å…·
        function initSerialNumberTool() {
            document.getElementById('startSerialNumber').value = getDefaultSerialNumber();
            document.getElementById('serialNumberCount').value = 10;// è®¾ç½®é»˜è®¤æ•°é‡ä¸º10
        }
        
        // å½“å‰æ¿€æ´»çš„å·¥å…·ID
        let currentActiveTool = null;
        
        // åœ¨æ˜¾ç¤ºå·¥å…·æ—¶åˆå§‹åŒ–
        function showTool(toolId) {
            // éšè—æ‰€æœ‰å·¥å…·
            document.querySelectorAll('.calculator').forEach(tool => {
                tool.style.display = 'none';
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å·¥å…·
            const selectedTool = document.getElementById(toolId);
            if (selectedTool) {
                selectedTool.style.display = 'block';
                currentActiveTool = toolId; // è®°å½•å½“å‰æ¿€æ´»çš„å·¥å…·ID
                
                // å¦‚æœæ˜¯äºŒç»´ç ç”Ÿæˆå™¨ï¼Œåˆå§‹åŒ–å®ƒ
                if (toolId === 'qrGeneratorTool') {
                    initQRGenerator();
                }
                
                // å¦‚æœæ˜¯ç”Ÿæˆæµæ°´å·å·¥å…·ï¼Œåˆå§‹åŒ–å®ƒ
                if (toolId === 'serialNumberTool') {
                    initSerialNumberTool();
                }
                
                // å¦‚æœæ˜¯æ—¥å¿—åˆ†æå™¨ï¼Œå¯ä»¥åšä¸€äº›åˆå§‹åŒ–
            if (toolId === 'logAnalysisTool') {
                // è¿™é‡Œå¯ä»¥æ·»åŠ æ—¥å¿—åˆ†æå™¨çš„åˆå§‹åŒ–é€»è¾‘
                console.log('æ—¥å¿—åˆ†æå™¨å·²æ¿€æ´»');
            }
            }
            
            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tool-switcher button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tool-switcher button[onclick="showTool('${toolId}')"]`).classList.add('active');
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯æç¤ºå‡½æ•°
        function showMessage(message, type = 'info') {
            // æŸ¥æ‰¾æˆ–åˆ›å»ºå½“å‰æ¿€æ´»å·¥å…·é¡µé¢ä¸­çš„æç¤ºå…ƒç´ 
            let messageElement;
            
            // å¦‚æœæœ‰å½“å‰æ¿€æ´»çš„å·¥å…·
            if (currentActiveTool) {
                const activeToolElement = document.getElementById(currentActiveTool);
                if (activeToolElement) {
                    // å…ˆåœ¨å½“å‰å·¥å…·é¡µé¢ä¸­æŸ¥æ‰¾ç°æœ‰çš„æç¤ºå…ƒç´ 
                    messageElement = activeToolElement.querySelector('.toolMessage');
                    
                    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æç¤ºå…ƒç´ 
                    if (!messageElement) {
                        messageElement = document.createElement('div');
                        messageElement.className = 'toolMessage';
                        messageElement.style.padding = '10px';
                        messageElement.style.marginBottom = '10px';
                        messageElement.style.borderRadius = '5px';
                        messageElement.style.backgroundColor = '#f8f9fa';
                        messageElement.style.display = 'none';
                        
                        // å°†æ–°å…ƒç´ æ’å…¥åˆ°å·¥å…·é¡µé¢çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ä¹‹å‰
                        if (activeToolElement.firstChild) {
                            activeToolElement.insertBefore(messageElement, activeToolElement.firstChild);
                        } else {
                            activeToolElement.appendChild(messageElement);
                        }
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–åˆ›å»ºæˆåŠŸï¼Œå›é€€åˆ°å…¨å±€çš„æç¤ºå…ƒç´ 
            if (!messageElement) {
                messageElement = document.getElementById('toolMessage') || document.querySelector('.toolMessage');
                
                // å¦‚æœä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å±€çš„æç¤ºå…ƒç´ 
                if (!messageElement) {
                    messageElement = document.createElement('div');
                    messageElement.className = 'toolMessage';
                    messageElement.id = 'toolMessage';
                    messageElement.style.padding = '10px';
                    messageElement.style.marginBottom = '10px';
                    messageElement.style.borderRadius = '5px';
                    messageElement.style.backgroundColor = '#f8f9fa';
                    messageElement.style.display = 'none';
                    
                    // å°†å…¨å±€æç¤ºå…ƒç´ æ·»åŠ åˆ°body
                    document.body.appendChild(messageElement);
                }
            }
            
            // è®¾ç½®æ¶ˆæ¯å†…å®¹å’Œæ ·å¼
            messageElement.textContent = message;
            
            // è®¾ç½®ä¸åŒç±»å‹æ¶ˆæ¯çš„æ ·å¼
            if (type === 'success') {
                messageElement.style.backgroundColor = '#d4edda';
                messageElement.style.color = '#155724';
                messageElement.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                messageElement.style.backgroundColor = '#f8d7da';
                messageElement.style.color = '#721c24';
                messageElement.style.border = '1px solid #f5c6cb';
            } else {
                messageElement.style.backgroundColor = '#d1ecf1';
                messageElement.style.color = '#0c5460';
                messageElement.style.border = '1px solid #bee5eb';
            }
            
            messageElement.style.display = 'block';
            
            // 10ç§’åè‡ªåŠ¨éšè—æ¶ˆæ¯
            setTimeout(() => {
                if (messageElement && messageElement.style.display === 'block') {
                    messageElement.style.display = 'none';
                }
            }, 10000);
        }
        
        // ç”Ÿæˆæµæ°´å·å‡½æ•°
        function generateSerialNumbers() {
            const startSerial = document.getElementById('startSerialNumber').value.trim();
            const count = parseInt(document.getElementById('serialNumberCount').value.trim()) || 0;
            const endSerial = document.getElementById('endSerialNumber').value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!startSerial) {
                showMessage('è¯·è¾“å…¥èµ·å§‹æµæ°´å·', 'error');
                return;
            }
            
            if (count === 0 && !endSerial) {
                showMessage('è¯·è¾“å…¥æ•°é‡æˆ–ç»“æŸæµæ°´å·', 'error');
                return;
            }
            
            if (count > 0 && endSerial) {
                showMessage('æ•°é‡å’Œç»“æŸæµæ°´å·åªèƒ½é€‰æ‹©ä¸€ä¸ªè¾“å…¥', 'error');
                return;
            }
            
            const results = [];
            
            try {
                // å°è¯•æå–èµ·å§‹æµæ°´å·ä¸­çš„æ•°å­—åç¼€
                const numericMatch = startSerial.match(/(\d+)$/);
                const prefix = startSerial.replace(/\d+$/, '');
                const startNumber = numericMatch ? parseInt(numericMatch[1]) : 1;
                
                // æ ¹æ®æ•°é‡ç”Ÿæˆ
                if (count > 0) {
                    for (let i = 0; i < count; i++) {
                        const numberPart = String(startNumber + i).padStart(numericMatch ? numericMatch[1].length : 3, '0');
                        results.push(prefix + numberPart);
                    }
                } 
                // æ ¹æ®ç»“æŸæµæ°´å·ç”Ÿæˆ
                else if (endSerial) {
                    const endNumericMatch = endSerial.match(/(\d+)$/);
                    if (!endNumericMatch) {
                        showMessage('ç»“æŸæµæ°´å·æ ¼å¼ä¸æ­£ç¡®', 'error');
                        return;
                    }
                    
                    const endNumber = parseInt(endNumericMatch[1]);
                    if (endNumber < startNumber) {
                        showMessage('ç»“æŸæµæ°´å·å¿…é¡»å¤§äºèµ·å§‹æµæ°´å·', 'error');
                        return;
                    }
                    
                    for (let i = 0; i <= endNumber - startNumber; i++) {
                        const numberPart = String(startNumber + i).padStart(numericMatch ? numericMatch[1].length : 3, '0');
                        results.push(prefix + numberPart);
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('serialNumberResult').value = results.join('\n');
                showMessage('æµæ°´å·ç”ŸæˆæˆåŠŸï¼Œå…±ç”Ÿæˆ ' + results.length + ' ä¸ªæµæ°´å·', 'success');
                
            } catch (error) {
                console.error('ç”Ÿæˆæµæ°´å·å¤±è´¥:', error);
                showMessage('ç”Ÿæˆæµæ°´å·å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // å¤åˆ¶æµæ°´å·ç»“æœ
        function copySerialNumbers() {
            const resultText = document.getElementById('serialNumberResult').value;
            if (!resultText.trim()) {
                showMessage('è¯·å…ˆç”Ÿæˆæµæ°´å·', 'error');
                return;
            }
            
            navigator.clipboard.writeText(resultText).then(() => {
                showMessage('å¤åˆ¶æˆåŠŸ', 'success');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
            });
        }
        
        // ä¿®æ”¹ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼
        function formatSerialNumbers() {
            const resultText = document.getElementById('serialNumberResult').value;
            if (!resultText.trim()) {
                showMessage('è¯·å…ˆç”Ÿæˆæµæ°´å·', 'error');
                return;
            }
            
            // å°†æ¢è¡Œåˆ†éš”çš„æµæ°´å·è½¬æ¢ä¸ºé€—å·åˆ†éš”
            const serialNumbers = resultText.split('\n').filter(line => line.trim());
            document.getElementById('serialNumberResult').value = serialNumbers.join(',');
            showMessage('å·²è½¬æ¢ä¸ºåå°æ‰¹é‡æŸ¥è¯¢æ ¼å¼', 'success');
        }
        
        // é˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼
        function addQuotesToSerialNumbers() {
            const resultText = document.getElementById('serialNumberResult').value;
            if (!resultText.trim()) {
                showMessage('è¯·å…ˆç”Ÿæˆæµæ°´å·', 'error');
                return;
            }
            
            // å¤„ç†ä¸åŒæ ¼å¼çš„æµæ°´å·
            let serialNumbers;
            if (resultText.includes(',')) {
                // é€—å·åˆ†éš”çš„æ ¼å¼
                serialNumbers = resultText.split(',').filter(item => item.trim());
                // æ·»åŠ å•å¼•å·å¹¶é‡æ–°ç”¨é€—å·è¿æ¥
                document.getElementById('serialNumberResult').value = serialNumbers.map(serial => 
                    serial.trim().endsWith("'") ? serial.trim() : serial.trim() + "'"
                ).join(',');
            } else {
                // æ¢è¡Œåˆ†éš”çš„æ ¼å¼
                serialNumbers = resultText.split('\n').filter(line => line.trim());
                // æ·»åŠ å•å¼•å·å¹¶ä¿æŒæ¢è¡Œæ ¼å¼
                document.getElementById('serialNumberResult').value = serialNumbers.map(serial => 
                    serial.trim().endsWith("'") ? serial.trim() : serial.trim() + "'"
                ).join('\n');
            }
            showMessage('å·²æ·»åŠ å•å¼•å·é˜²æ­¢ç§‘å­¦è®¡æ•°æ ¼å¼', 'success');
        }
        
    </script>
</body>
</html>
